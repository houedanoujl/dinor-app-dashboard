import{u as e,d as r}from"./index.C2Y7xW-Y.js";import{r as o}from"./vendor.DPtJZQQS.js";function t(){const t=e(),n=r(),a=o([]),s=o(!1),l=o(null),u=o(null),m=o(null);return{comments:a,loading:s,error:l,loadComments:async(e=null,r=null)=>{if(s.value=!0,l.value=null,e&&r&&(u.value=e,m.value=r),!u.value||!m.value)return console.error("❌ [Comments] Type ou ID manquant pour charger les commentaires"),l.value="Paramètres manquants pour charger les commentaires",void(s.value=!1);try{console.log(`💬 [Comments] Chargement des commentaires pour ${u.value}:${m.value}`);const e=await t.get("/comments",{commentable_type:`App\\Models\\${u.value}`,commentable_id:m.value});e.success?(a.value=e.data||[],console.log(`✅ [Comments] ${a.value.length} commentaires chargés`)):a.value=[]}catch(o){console.error("❌ [Comments] Erreur lors du chargement:",o),l.value=o.message,a.value=[]}finally{s.value=!1}},loadCommentsFresh:async(e=null,r=null)=>{if(s.value=!0,l.value=null,e&&r&&(u.value=e,m.value=r),!u.value||!m.value)return console.error("❌ [Comments] Type ou ID manquant pour charger les commentaires"),l.value="Paramètres manquants pour charger les commentaires",void(s.value=!1);try{console.log(`💬 [Comments] Chargement frais des commentaires pour ${u.value}:${m.value}`);const e=await t.getFresh("/comments",{commentable_type:`App\\Models\\${u.value}`,commentable_id:m.value});e.success?(a.value=e.data||[],console.log(`✅ [Comments] ${a.value.length} commentaires chargés (frais)`)):a.value=[]}catch(o){console.error("❌ [Comments] Erreur lors du chargement frais:",o),l.value=o.message,a.value=[]}finally{s.value=!1}},addComment:async(e,r,o)=>{var s;if(!(null==o?void 0:o.trim()))throw new Error("Le contenu du commentaire ne peut pas être vide");if(!n.isAuthenticated)throw new Error("Vous devez être connecté pour commenter");try{console.log(`💬 [Comments] Ajout d'un commentaire pour ${e}:${r}`);const l={commentable_type:`App\\Models\\${e}`,commentable_id:parseInt(r),content:o.trim()},u=await t.post("/comments",l);if(u.success){console.log("✅ [Comments] Commentaire ajouté avec succès");const e={id:(null==(s=u.data)?void 0:s.id)||Date.now(),content:o.trim(),author_name:n.userName||"Utilisateur",created_at:(new Date).toISOString(),...u.data};return a.value.unshift(e),e}throw new Error(u.message||"Erreur lors de l'ajout du commentaire")}catch(l){if(console.error("❌ [Comments] Erreur lors de l'ajout:",l),l.message.includes("401")||l.message.includes("Unauthorized"))throw new Error("Votre session a expiré. Veuillez vous reconnecter.");throw l}},deleteComment:async e=>{if(!n.isAuthenticated)throw new Error("Vous devez être connecté pour supprimer un commentaire");try{console.log(`💬 [Comments] Suppression du commentaire ${e}`);const r=await t.del(`/comments/${e}`);if(r.success){console.log("✅ [Comments] Commentaire supprimé avec succès");const r=a.value.findIndex(r=>r.id===e);return r>-1&&a.value.splice(r,1),!0}throw new Error(r.message||"Erreur lors de la suppression du commentaire")}catch(r){throw console.error("❌ [Comments] Erreur lors de la suppression:",r),r}},formatCommentDate:e=>{if(!e)return"";try{const r=new Date(e),o=new Date,t=Math.floor((o-r)/6e4);if(t<1)return"À l'instant";if(t<60)return`Il y a ${t}mn`;const n=Math.floor(t/60);if(n<24)return`Il y a ${n}h`;const a=Math.floor(n/24);return a<7?`Il y a ${a}j`:r.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:r.getFullYear()!==o.getFullYear()?"numeric":void 0})}catch{return"Date invalide"}},canEditComment:e=>{var r,o;return!(!n.isAuthenticated||!e)&&(e.user_id===(null==(r=n.user)?void 0:r.id)||"admin"===(null==(o=n.user)?void 0:o.role))},canDeleteComment:e=>{var r,o;return!(!n.isAuthenticated||!e)&&(e.user_id===(null==(r=n.user)?void 0:r.id)||"admin"===(null==(o=n.user)?void 0:o.role))},setContext:(e,r)=>{u.value=e,m.value=r,console.log(`💬 [Comments] Contexte défini: ${e}:${r}`)}}}export{t as u};
