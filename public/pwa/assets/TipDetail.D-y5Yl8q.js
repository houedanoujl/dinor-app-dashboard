import{h as e,i as t,k as a,j as s,e as i,l as o,t as r,F as l,E as n,B as c,D as d,r as m,b as u,g as p,p as v,u as g,o as y}from"./vendor.Bvrl98ec.js";import{_ as h,D as f,A as b,S as k,u as C,d as w,e as _}from"./index.Bsia8KuI.js";import{u as x}from"./useComments.783SSx2G.js";import{B as D}from"./Badge.DyXEPUhr.js";const A={class:"tip-detail"},S={class:"md3-main-content"},E={key:0,class:"loading-container"},M={key:1,class:"tip-content"},j={key:0,class:"tip-hero"},z=["src","alt"],I={class:"tip-overlay dinor-gradient-primary"},L={class:"tip-badges"},T={class:"tip-info"},$={class:"tip-stats"},B={class:"stat-item"},F={class:"md3-body-medium"},V={class:"stat-item"},H={class:"md3-body-medium"},U={class:"stat-item"},R={class:"md3-body-medium"},q={key:0,class:"tip-summary-video"},P={class:"video-container"},G=["src","title"],N={class:"tip-content-text"},O=["innerHTML"],J={key:1,class:"tip-tags"},K={class:"tags-container"},Q={class:"comments-section"},W={class:"md3-title-medium dinor-text-primary"},X={class:"add-comment-form"},Y={key:0,class:"auth-prompt"},Z={key:1},ee={class:"authenticated-user"},te={class:"user-info"},ae=["disabled"],se={key:0,class:"comments-list"},ie={class:"comment-header"},oe={class:"comment-meta"},re={class:"comment-author md3-body-medium"},le={class:"comment-date md3-body-small dinor-text-gray"},ne={key:0,class:"comment-actions"},ce=["onClick"],de={class:"comment-content md3-body-medium"},me={key:1,class:"empty-comments"},ue={key:2,class:"error-state"},pe={class:"error-icon"},ve={class:"error-actions"};const ge=h({name:"TipDetail",emits:["update-header"],components:{Badge:D,ShareModal:k,AuthModal:b,DinorIcon:f},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=v();g();const s=C(),i=w(),{showShareModal:o,updateOpenGraphTags:r}=_(),{comments:l,loadComments:n,canDeleteComment:c,deleteComment:d,setContext:y,addComment:h}=x(),f=m(null),b=m(!0),k=m(!1),D=m(!1),A=m(""),S=m(!1),E=u(()=>f.value?{title:f.value.title,text:`Découvrez cette astuce pratique : ${f.value.title}`,url:window.location.href,image:f.value.image,type:"tip",id:f.value.id}:{}),M=async()=>{try{const t=await s.get("/likes/check",{type:"tip",id:e.id});k.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la vérification du like:",t)}},j=async()=>{try{const t=await s.get("/favorites/check",{type:"tip",id:e.id});D.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la vérification du favori:",t)}};return p(()=>{(async()=>{try{const a=await s.get(`/tips/${e.id}`);a.success&&(f.value=a.data,y("Tip",e.id),await n(),await M(),await j(),r(E.value),t("update-header",{title:f.value.title||"Astuce",showShare:!0,showFavorite:!0,favoriteType:"tip",favoriteItemId:parseInt(e.id),isContentFavorited:D.value,backPath:"/tips"}))}catch(a){console.error("Erreur lors du chargement de l'astuce:",a)}finally{b.value=!1}})()}),{tip:f,comments:l,loading:b,userLiked:k,userFavorited:D,newComment:A,toggleLike:async()=>{try{const a=await s.post("/likes/toggle",{likeable_type:"tip",likeable_id:e.id});a.success&&(k.value=!k.value,f.value&&(f.value.likes_count=a.data.total_likes),t("update-header",{isLiked:k.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await s.post("/favorites/toggle",{favoritable_type:"tip",favoritable_id:e.id});a.success&&(D.value=!D.value,f.value&&(f.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:D.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(A.value.trim())if(i.isAuthenticated)try{console.log("📝 [Comments] Envoi du commentaire pour Tip:",e.id),await h("Tip",e.id,A.value),console.log("✅ [Comments] Commentaire ajouté avec succès"),A.value=""}catch(t){console.error("❌ [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connecté"))&&(S.value=!0)}else S.value=!0},canDeleteComment:c,deleteComment:d,goBack:()=>{a.push("/tips")},goHome:()=>{a.push("/")},getDifficultyLabel:e=>({beginner:"Débutant",intermediate:"Intermédiaire",advanced:"Avancé"}[e]||"Débutant"),formatDate:e=>new Date(e).toLocaleDateString("fr-FR"),handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",getEmbedUrl:e=>{if(!e||!e.trim())return"";const t=e.trim(),a=t.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);if(a)return`https://www.youtube.com/embed/${a[1]}?rel=0&modestbranding=1`;const s=t.match(/vimeo\.com\/(\d+)/);return s?`https://player.vimeo.com/video/${s[1]}`:t},showShareModal:o,shareData:E,authStore:i,showAuthModal:S}}},[["render",function(m,u,p,v,g,h){const f=o("Badge"),b=o("DinorIcon"),k=o("ShareModal"),C=o("AuthModal");return y(),e("div",A,[t("main",S,[v.loading?(y(),e("div",E,u[9]||(u[9]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'astuce...",-1)]))):v.tip?(y(),e("div",M,[v.tip.image_url?(y(),e("div",j,[t("img",{src:v.tip.image_url||"/images/default-recipe.jpg",alt:v.tip.title,class:"tip-hero-image",onError:u[0]||(u[0]=(...e)=>v.handleImageError&&v.handleImageError(...e))},null,40,z),t("div",I,[t("div",L,[v.tip.difficulty_level?(y(),i(f,{key:0,text:v.getDifficultyLabel(v.tip.difficulty_level),icon:"lightbulb",variant:"secondary",size:"medium"},null,8,["text"])):s("",!0),v.tip.category?(y(),i(f,{key:1,text:v.tip.category.name,icon:"tag",variant:"neutral",size:"medium"},null,8,["text"])):s("",!0)])])])):s("",!0),t("div",T,[t("div",$,[t("div",B,[a(b,{name:"schedule",size:18,class:"dinor-text-secondary"}),t("span",F,r(v.tip.estimated_time)+"min",1)]),t("div",V,[a(b,{name:"favorite",size:18,class:"dinor-text-secondary"}),t("span",H,r(v.tip.likes_count||0),1)]),t("div",U,[a(b,{name:"comment",size:18,class:"dinor-text-secondary"}),t("span",R,r(v.tip.comments_count||0),1)])]),v.tip.summary_video_url&&v.tip.summary_video_url.trim()?(y(),e("div",q,[u[10]||(u[10]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Résumé en vidéo",-1)),t("div",P,[t("iframe",{src:v.getEmbedUrl(v.tip.summary_video_url),title:`Résumé vidéo : ${v.tip.title}`,frameborder:"0",allowfullscreen:"",class:"summary-video-iframe"},null,8,G)])])):s("",!0),t("div",N,[u[11]||(u[11]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Astuce",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:v.formatContent(v.tip.content)},null,8,O)]),v.tip.tags&&v.tip.tags.length?(y(),e("div",J,[u[12]||(u[12]=t("h3",{class:"md3-title-small dinor-text-primary"},"Tags",-1)),t("div",K,[(y(!0),e(l,null,n(v.tip.tags,t=>(y(),e("span",{key:t,class:"md3-chip"},r(t),1))),128))])])):s("",!0),t("div",Q,[t("h2",W,"Commentaires ("+r(v.comments.length)+")",1),t("div",X,[v.authStore.isAuthenticated?(y(),e("div",Z,[t("div",ee,[t("span",te,"Connecté en tant que "+r(v.authStore.userName),1),t("button",{onClick:u[2]||(u[2]=e=>v.authStore.logout()),class:"btn-logout"},"Déconnexion")]),c(t("textarea",{"onUpdate:modelValue":u[3]||(u[3]=e=>v.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[d,v.newComment]]),t("button",{onClick:u[4]||(u[4]=(...e)=>v.addComment&&v.addComment(...e)),class:"btn-primary",disabled:!v.newComment.trim()}," Publier ",8,ae)])):(y(),e("div",Y,[u[13]||(u[13]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:u[1]||(u[1]=e=>v.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),v.comments.length?(y(),e("div",se,[(y(!0),e(l,null,n(v.comments,i=>(y(),e("div",{key:i.id,class:"comment-item"},[t("div",ie,[t("div",oe,[t("span",re,r(i.author_name),1),t("span",le,r(v.formatDate(i.created_at)),1)]),v.canDeleteComment(i)?(y(),e("div",ne,[t("button",{onClick:e=>v.deleteComment(i.id),class:"btn-delete",title:"Supprimer le commentaire"},[a(b,{name:"delete",size:18})],8,ce)])):s("",!0)]),t("p",de,r(i.content),1)]))),128))])):(y(),e("div",me,u[14]||(u[14]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(y(),e("div",ue,[t("div",pe,[a(b,{name:"error",size:48})]),u[15]||(u[15]=t("h2",{class:"md3-title-large"},"Astuce introuvable",-1)),u[16]||(u[16]=t("p",{class:"md3-body-large dinor-text-gray"},"L'astuce demandée n'existe pas ou a été supprimée.",-1)),t("div",ve,[t("button",{onClick:u[5]||(u[5]=(...e)=>v.goBack&&v.goBack(...e)),class:"btn-secondary"},"Retour aux astuces"),t("button",{onClick:u[6]||(u[6]=(...e)=>v.goHome&&v.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(k,{modelValue:v.showShareModal,"onUpdate:modelValue":u[7]||(u[7]=e=>v.showShareModal=e),"share-data":v.shareData},null,8,["modelValue","share-data"]),a(C,{modelValue:v.showAuthModal,"onUpdate:modelValue":u[8]||(u[8]=e=>v.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-46fdff32"]]);export{ge as default};
