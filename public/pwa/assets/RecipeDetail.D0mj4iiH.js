import{r as e,e as t,f as a,v as i,i as r,g as s,l as o,t as n,F as c,m as l,B as d,D as m,n as u,b as p,h,k as v,o as g}from"./vendor.CgTKjNNK.js";import{_ as y,A as f,S as b,a as k,u as w,d as C}from"./index.DJpaKxkf.js";import{u as x}from"./useComments.Bp6N9YRo.js";import{B as R}from"./Badge.DafUQRlF.js";import{F as A}from"./FavoriteButton.DeF1KCrM.js";import{L as D}from"./LikeButton.CUeMSxan.js";const S={class:"recipe-detail"},$={class:"md3-main-content"},_={key:0,class:"loading-container"},I={key:1,class:"recipe-content"},L={class:"recipe-hero"},U=["src","alt"],j={class:"recipe-overlay dinor-gradient-primary"},E={class:"recipe-badges"},M={class:"recipe-info"},F={class:"recipe-stats"},B={class:"stat-item"},T={class:"md3-body-medium"},V={class:"stat-item"},q={class:"md3-body-medium"},z={class:"stat-item"},H={class:"md3-body-medium"},P={class:"stat-item"},N={class:"md3-body-medium"},G={key:0,class:"recipe-summary-video"},O={class:"video-container"},J=["src","title"],K={key:1,class:"recipe-description"},Q=["innerHTML"],W={key:2,class:"recipe-ingredients"},X={class:"ingredients-list"},Y={class:"md3-body-medium"},Z={key:3,class:"recipe-instructions"},ee=["innerHTML"],te={class:"comments-section"},ae={class:"md3-title-medium dinor-text-primary"},ie={class:"add-comment-form"},re={key:0,class:"auth-prompt"},se={key:1},oe={class:"authenticated-user"},ne={class:"user-info"},ce=["disabled"],le={key:0,class:"comments-list"},de={class:"comment-header"},me={class:"comment-meta"},ue={class:"comment-author md3-body-medium"},pe={class:"comment-date md3-body-small dinor-text-gray"},he={key:0,class:"comment-actions"},ve=["onClick"],ge={class:"comment-content md3-body-medium"},ye={key:1,class:"empty-comments"},fe={class:"recipe-header-actions"},be=["disabled"],ke={key:2,class:"error-state"};const we=y({name:"RecipeDetail",emits:["update-header"],components:{Badge:R,ShareModal:b,AuthModal:f,FavoriteButton:A,LikeButton:D},props:{id:{type:String,required:!0}},setup(t,{emit:a}){const i=v(),r=k(),s=w(),{showShareModal:o,updateOpenGraphTags:n}=C(),{share:c}=function(){const t=e(!1),a=e(null),i=()=>"share"in navigator;return{isSharing:t,shareError:a,canShare:i,share:async e=>{if(!i())return a.value="Le partage n'est pas supporté sur cet appareil",!1;try{return t.value=!0,a.value=null,await navigator.share({title:e.title||document.title,text:e.text||e.description||"",url:e.url||window.location.href}),!0}catch(r){return"AbortError"!==r.name&&(console.error("Erreur lors du partage:",r),a.value="Erreur lors du partage"),!1}finally{t.value=!1}},copyToClipboard:async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){return console.error("Erreur lors de la copie:",t),a.value="Impossible de copier le lien",!1}},shareViaUrl:(e,t)=>{const{url:i=window.location.href,title:r=document.title,text:s=""}=t;let o="";switch(e){case"facebook":o=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}`;break;case"twitter":o=`https://twitter.com/intent/tweet?url=${encodeURIComponent(i)}&text=${encodeURIComponent(s||r)}`;break;case"whatsapp":o=`https://wa.me/?text=${encodeURIComponent((s||r)+" "+i)}`;break;case"telegram":o=`https://t.me/share/url?url=${encodeURIComponent(i)}&text=${encodeURIComponent(s||r)}`;break;default:return a.value="Plateforme non supportée",!1}return!!o&&(window.open(o,"_blank","width=600,height=400"),!0)}}}(),{comments:l,loadComments:d,canDeleteComment:m,deleteComment:u,setContext:g,addComment:y}=x(),f=e(null),b=e(!0),R=e(!1),A=e(!1),D=e(""),S=e(!1),$=p(()=>f.value?{title:f.value.title,text:f.value.description||`Découvrez cette délicieuse recette : ${f.value.title}`,url:window.location.href,image:f.value.featured_image_url,type:"recipe",id:f.value.id}:{}),_=async(e=!1)=>{try{console.log("🔄 [RecipeDetail] Chargement recette ID:",t.id,"ForceRefresh:",e);const i=e?await r.request(`/recipes/${t.id}`,{forceRefresh:!0}):await r.get(`/recipes/${t.id}`);i.success&&(f.value=i.data,g("Recipe",t.id),await d(),await I(),await L(),n($.value),a("update-header",{title:f.value.title||"Recette",showShare:!0,showFavorite:!0,favoriteType:"recipe",favoriteItemId:parseInt(t.id),isContentFavorited:A.value,backPath:"/recipes"}))}catch(i){console.error("Erreur lors du chargement de la recette:",i)}finally{b.value=!1}},I=async()=>{try{const e=await r.get("/likes/check",{type:"recipe",id:t.id});R.value=e.success&&e.is_liked}catch(e){console.error("Erreur lors de la vérification du like:",e)}},L=async()=>{try{const e=await r.get("/favorites/check",{type:"recipe",id:t.id});A.value=e.success&&e.is_favorited}catch(e){console.error("Erreur lors de la vérification du favori:",e)}},U=async()=>{if(D.value.trim())if(s.isAuthenticated)try{console.log("📝 [Comments] Envoi du commentaire pour Recipe:",t.id),await y("Recipe",t.id,D.value),console.log("✅ [Comments] Commentaire ajouté avec succès"),D.value=""}catch(e){console.error("❌ [Comments] Erreur lors de l'ajout du commentaire:",e),(e.message.includes("401")||e.message.includes("connecté"))&&(S.value=!0)}else S.value=!0};h(()=>{_()});return{recipe:f,loading:b,showAuthModal:S,comments:l,newComment:D,authStore:s,userLiked:R,userFavorited:A,shareData:$,goBack:()=>{i.push("/recipes")},goHome:()=>{i.push("/")},forceRefresh:async()=>{console.log("🔄 [RecipeDetail] Rechargement forcé demandé"),b.value=!0;try{await _(!0),console.log("✅ [RecipeDetail] Rechargement forcé terminé")}catch(e){console.error("❌ [RecipeDetail] Erreur lors du rechargement forcé:",e)}},addComment:U,canDeleteComment:m,deleteComment:u,callShare:()=>{c($.value)},handleLikeUpdate:e=>{R.value=e,console.log("❤️ [RecipeDetail] Like mis à jour:",e)},handleLikeCountUpdate:e=>{f.value&&(f.value.likes_count=e),console.log("🔢 [RecipeDetail] Compteur likes mis à jour:",e)},handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatIngredients:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.name?`<div class="ingredient-item">\n              <span class="md3-body-medium">${e.quantity||""} ${e.unit||""} ${e.name}</span>\n            </div>`:"string"==typeof e?`<div class="ingredient-item">\n              <span class="md3-body-medium">${e}</span>\n            </div>`:`<div class="ingredient-item"><span class="md3-body-medium">${e}</span></div>`).join(""):e.toString():"",formatInstructions:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="instruction-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="instruction-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e}</p>\n            </div>`:`<div class="instruction-step"><p>${e}</p></div>`).join(""):e.toString():"",getDifficultyColor:e=>({beginner:"#4CAF50",intermediate:"#FF9800",advanced:"#F44336"}[e]||"#4CAF50"),formatDate:e=>new Date(e).toLocaleDateString("fr-FR"),formatCookingTime:e=>e?`${e} min`:"N/A",getDifficultyLabel:e=>({beginner:"Débutant",intermediate:"Intermédiaire",advanced:"Avancé"}[e]||"Débutant"),getEmbedUrl:e=>{if(!e)return"";const t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);if(t)return`https://www.youtube.com/embed/${t[1]}?rel=0&modestbranding=1`;const a=e.match(/vimeo\.com\/(\d+)/);return a?`https://player.vimeo.com/video/${a[1]}`:e},showShareModal:o,handleAuthenticated:()=>{S.value=!1,D.value.trim()&&U()}}}},[["render",function(e,p,h,v,y,f){const b=o("Badge"),k=o("LikeButton"),w=o("ShareModal"),C=o("AuthModal");return g(),t("div",S,[a("main",$,[v.loading?(g(),t("div",_,p[11]||(p[11]=[a("div",{class:"md3-circular-progress"},null,-1),a("p",{class:"md3-body-large"},"Chargement de la recette...",-1)]))):v.recipe?(g(),t("div",I,[a("div",L,[a("img",{src:v.recipe.featured_image_url||"/images/default-recipe.jpg",alt:v.recipe.title,class:"recipe-hero-image",onError:p[0]||(p[0]=(...e)=>v.handleImageError&&v.handleImageError(...e))},null,40,U),a("div",j,[a("div",E,[v.recipe.difficulty?(g(),r(b,{key:0,text:v.getDifficultyLabel(v.recipe.difficulty),icon:"restaurant",variant:"secondary",size:"medium"},null,8,["text"])):s("",!0),v.recipe.category?(g(),r(b,{key:1,text:v.recipe.category.name,icon:"tag",variant:"neutral",size:"medium"},null,8,["text"])):s("",!0)])])]),a("div",M,[a("div",F,[a("div",B,[p[12]||(p[12]=a("i",{class:"material-icons dinor-text-secondary"},"schedule",-1)),a("span",T,n(v.recipe.cooking_time)+"min",1)]),a("div",V,[p[13]||(p[13]=a("i",{class:"material-icons dinor-text-secondary"},"people",-1)),a("span",q,n(v.recipe.servings)+" pers.",1)]),a("div",z,[p[14]||(p[14]=a("i",{class:"material-icons dinor-text-secondary"},"favorite",-1)),a("span",H,n(v.recipe.likes_count||0),1)]),a("div",P,[p[15]||(p[15]=a("i",{class:"material-icons dinor-text-secondary"},"comment",-1)),a("span",N,n(v.recipe.comments_count||0),1)])]),v.recipe.summary_video_url?(g(),t("div",G,[p[16]||(p[16]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Résumé en vidéo",-1)),a("div",O,[a("iframe",{src:v.getEmbedUrl(v.recipe.summary_video_url),title:`Résumé vidéo : ${v.recipe.title}`,frameborder:"0",allowfullscreen:"",class:"summary-video-iframe"},null,8,J)])])):s("",!0),v.recipe.description?(g(),t("div",K,[p[17]||(p[17]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),a("p",{class:"md3-body-large dinor-text-gray",innerHTML:v.recipe.description},null,8,Q)])):s("",!0),v.recipe.ingredients&&v.recipe.ingredients.length?(g(),t("div",W,[p[18]||(p[18]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Ingrédients",-1)),a("ul",X,[(g(!0),t(c,null,l(v.recipe.ingredients,e=>(g(),t("li",{key:e.id,class:"ingredient-item"},[a("span",Y,n(e.quantity)+" "+n(e.unit)+" "+n(e.name),1)]))),128))])])):s("",!0),v.recipe.instructions?(g(),t("div",Z,[p[19]||(p[19]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Instructions",-1)),a("div",{class:"md3-body-large dinor-text-gray",innerHTML:v.formatInstructions(v.recipe.instructions)},null,8,ee)])):s("",!0),a("div",te,[a("h2",ae,"Commentaires ("+n(v.comments.length)+")",1),a("div",ie,[v.authStore.isAuthenticated?(g(),t("div",se,[a("div",oe,[a("span",ne,"Connecté en tant que "+n(v.authStore.userName),1),a("button",{onClick:p[2]||(p[2]=e=>v.authStore.logout()),class:"btn-logout"},"Déconnexion")]),d(a("textarea",{"onUpdate:modelValue":p[3]||(p[3]=e=>v.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[m,v.newComment]]),a("button",{onClick:p[4]||(p[4]=(...e)=>v.addComment&&v.addComment(...e)),class:"btn-primary",disabled:!v.newComment.trim()}," Publier ",8,ce)])):(g(),t("div",re,[p[20]||(p[20]=a("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),a("button",{onClick:p[1]||(p[1]=e=>v.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),v.comments.length?(g(),t("div",le,[(g(!0),t(c,null,l(v.comments,e=>(g(),t("div",{key:e.id,class:"comment-item"},[a("div",de,[a("div",me,[a("span",ue,n(e.author_name),1),a("span",pe,n(v.formatDate(e.created_at)),1)]),v.canDeleteComment(e)?(g(),t("div",he,[a("button",{onClick:t=>v.deleteComment(e.id),class:"btn-delete",title:"Supprimer le commentaire"},p[21]||(p[21]=[a("i",{class:"material-icons"},"delete",-1)]),8,ve)])):s("",!0)]),a("p",ge,n(e.content),1)]))),128))])):(g(),t("div",ye,p[22]||(p[22]=[a("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))]),a("div",fe,[i(k,{type:"recipe","item-id":v.recipe.id,"initial-liked":v.userLiked,"initial-count":v.recipe.likes_count||0,"show-count":!0,size:"medium",onAuthRequired:p[5]||(p[5]=e=>v.showAuthModal=!0),"onUpdate:liked":v.handleLikeUpdate,"onUpdate:count":v.handleLikeCountUpdate},null,8,["item-id","initial-liked","initial-count","onUpdate:liked","onUpdate:count"]),a("button",{onClick:p[6]||(p[6]=(...e)=>v.forceRefresh&&v.forceRefresh(...e)),class:"refresh-button",title:"Actualiser les données",disabled:v.loading},[a("i",{class:u(["material-icons",{spinning:v.loading}])},"refresh",2)],8,be),a("button",{onClick:p[7]||(p[7]=(...e)=>v.callShare&&v.callShare(...e)),class:"share-button",title:"Partager cette recette"},p[23]||(p[23]=[a("i",{class:"material-icons"},"share",-1)]))])])])):(g(),t("div",ke,[p[24]||(p[24]=a("div",{class:"error-icon"},[a("i",{class:"material-icons"},"error_outline")],-1)),p[25]||(p[25]=a("h2",{class:"md3-title-large"},"Recette introuvable",-1)),p[26]||(p[26]=a("p",{class:"md3-body-large dinor-text-gray"},"La recette demandée n'existe pas ou a été supprimée.",-1)),a("button",{onClick:p[8]||(p[8]=(...e)=>v.goBack&&v.goBack(...e)),class:"btn-primary"},"Retour")]))]),i(w,{modelValue:v.showShareModal,"onUpdate:modelValue":p[9]||(p[9]=e=>v.showShareModal=e),"share-data":v.shareData},null,8,["modelValue","share-data"]),i(C,{modelValue:v.showAuthModal,"onUpdate:modelValue":p[10]||(p[10]=e=>v.showAuthModal=e),onAuthenticated:v.handleAuthenticated},null,8,["modelValue","onAuthenticated"])])}],["__scopeId","data-v-2de6f489"]]);export{we as default};
