import{d as e,r as s,b as t,e as a,p as l,f as i,y as r,l as c,t as n,n as o,I as u,g as d,x as p,F as f,B as h,v as g,h as m,C as v,w as y,k,o as b}from"./vendor.DPtJZQQS.js";import{b as R,_ as w,A as _,c as C}from"./index.C2Y7xW-Y.js";import{B as F,u as L}from"./BannerSection.DExf2B_4.js";import{S as A}from"./SearchAndFilters.CLRYPsGA.js";import{L as E}from"./LikeButton.DqtAGWeZ.js";import"./useApi.C08YzUxl.js";const S=e("recipes",()=>{const e=s([]),a=s(null),l=s(!1),i=s(null),r=s(""),c=s(null),n=s({current_page:1,last_page:1,per_page:12,total:0}),o=t(()=>{let s=e.value;if(r.value){const e=r.value.toLowerCase();s=s.filter(s=>{var t,a;return s.title.toLowerCase().includes(e)||(null==(t=s.short_description)?void 0:t.toLowerCase().includes(e))||(null==(a=s.tags)?void 0:a.some(s=>s.toLowerCase().includes(e)))})}return c.value&&(s=s.filter(e=>e.category_id===c.value)),s}),u=t(()=>e.value.filter(e=>e.is_featured));return{recipes:e,currentRecipe:a,loading:l,error:i,searchQuery:r,selectedCategory:c,pagination:n,filteredRecipes:o,featuredRecipes:u,fetchRecipes:async function(s={}){l.value=!0,i.value=null;try{const t=await R.getRecipes(s);if(!t.success)throw new Error(t.message||"Failed to fetch recipes");e.value=t.data,t.meta&&(n.value=t.meta)}catch(t){i.value=t.message,console.error("Error fetching recipes:",t)}finally{l.value=!1}},fetchRecipesFresh:async function(s={}){l.value=!0,i.value=null;try{console.log("üîÑ [RecipesStore] Rafra√Æchissement forc√© des recettes (cache d√©sactiv√©)");const t=await R.getRecipes(s);if(!t.success)throw new Error(t.message||"Failed to fetch recipes");e.value=t.data,t.meta&&(n.value=t.meta),console.log("‚úÖ [RecipesStore] Recettes rafra√Æchies:",t.data.length)}catch(t){i.value=t.message,console.error("Error fetching recipes:",t)}finally{l.value=!1}},fetchRecipe:async function(e){l.value=!0,i.value=null;try{const s=await R.getRecipe(e);if(!s.success)throw new Error(s.message||"Failed to fetch recipe");a.value=s.data}catch(s){i.value=s.message,console.error("Error fetching recipe:",s)}finally{l.value=!1}},fetchRecipeFresh:async function(e){l.value=!0,i.value=null;try{console.log("üîÑ [RecipesStore] Rafra√Æchissement forc√© de la recette:",e,"(cache d√©sactiv√©)");const s=await R.getRecipe(e);if(!s.success)throw new Error(s.message||"Failed to fetch recipe");a.value=s.data,console.log("‚úÖ [RecipesStore] Recette rafra√Æchie:",s.data.title)}catch(s){i.value=s.message,console.error("Error fetching recipe:",s)}finally{l.value=!1}},toggleLike:async function(s){try{const t=await R.toggleLike("recipes",s);if(t.success){const l=e.value.find(e=>e.id===s);return l&&(l.is_liked=t.data.is_liked,l.likes_count=t.data.likes_count),a.value&&a.value.id===s&&(a.value.is_liked=t.data.is_liked,a.value.likes_count=t.data.likes_count),t.data}}catch(t){return console.error("Error toggling like:",t),{success:!1}}},setSearchQuery:function(e){r.value=e},setSelectedCategory:function(e){c.value=e},clearFilters:function(){r.value="",c.value=null},clearCurrentRecipe:function(){a.value=null},clearError:function(){i.value=null}}}),Q={class:"recipes-list"},T={class:"filters-toggle"},j={class:"material-symbols-outlined"},q=["disabled"],B={class:"filters-container"},M={key:0,class:"loading-state"},x={key:1,class:"error-state"},z={key:2,class:"content"},D={key:0,class:"results-info"},U={key:0},V={key:1,class:"empty-state"},I={key:0},P={key:1},N={key:2,class:"recipes-grid"},O=["onClick"],W={class:"recipe-image"},$=["src","alt"],G={class:"recipe-overlay"},H={class:"recipe-meta"},J={key:0,class:"time"},K={key:1,class:"difficulty"},X={class:"recipe-content"},Y={class:"recipe-title"},Z={key:0,class:"recipe-description"},ee={class:"recipe-stats"},se={class:"stat"},te={class:"stat"},ae={key:0,class:"stat"},le={key:1,class:"stat equipment"};const ie=w({name:"RecipesList",components:{BannerSection:F,SearchAndFilters:A,LikeButton:E,AuthModal:_},setup(){const e=k(),a=S(),l=C(),{banners:i,loadBannersForContentType:r}=L(),c=t(()=>i.value),n=s(!1),o=s(!1),u=s([]),d=t({get:()=>a.searchQuery,set:e=>a.setSearchQuery(e)}),p=t({get:()=>a.selectedCategory,set:e=>a.setSelectedCategory(e)}),f=t(()=>a.loading),h=t(()=>a.error),g=s({}),b=t(()=>{var e;let s=a.recipes;if(null==(e=d.value)?void 0:e.trim()){const e=d.value.toLowerCase();s=s.filter(s=>{var t,a,l;return(null==(t=s.title)?void 0:t.toLowerCase().includes(e))||(null==(a=s.short_description)?void 0:a.toLowerCase().includes(e))||(null==(l=s.tags)?void 0:l.some(s=>s.toLowerCase().includes(e)))})}if(p.value&&(s=s.filter(e=>e.category_id===p.value)),g.value.difficulty&&(s=s.filter(e=>e.difficulty===g.value.difficulty)),g.value.prep_time){const e=g.value.prep_time;s=s.filter(s=>{const t=s.preparation_time||0;return"quick"===e?t<30:"medium"===e?t>=30&&t<=60:"long"!==e||t>60})}return s}),w=t(()=>Object.values(g.value).some(e=>null!==e)),_=async(e=!1)=>{e&&(console.log("üîÑ [RecipesList] Rechargement forc√© des recettes"),a.clearCache(),await R.clearCache()),await a.fetchRecipesFresh()},F=e=>{const{type:s,id:t,liked:a,count:l}=e.detail;if("recipe"===s){const e=b.value.find(e=>e.id==t);e&&(e.is_liked=a,e.likes_count=l)}};return m(()=>{_(),(async()=>{try{console.log("üç≥ [RecipesList] Chargement banni√®res pour type: recipes"),await r("recipes",!0)}catch(e){console.error("Error loading banners:",e)}})(),(async()=>{try{const e=await R.getRecipeCategories();e.success&&(u.value=e.data)}catch(e){console.error("Error loading categories:",e)}})(),l.initializePWAListeners(),l.initializeNetworkListeners(),window.addEventListener("like-updated",F)}),v(()=>{window.removeEventListener("like-updated",F)}),y(d,e=>{}),{searchQuery:d,selectedCategory:p,loading:f,error:h,filteredRecipes:b,categories:u,bannersByType:c,selectedFilters:g,recipeFilters:[{key:"difficulty",label:"Difficult√©",icon:"star",allLabel:"Tous niveaux",options:[{value:"easy",label:"Facile"},{value:"medium",label:"Moyen"},{value:"hard",label:"Difficile"}]},{key:"prep_time",label:"Temps de pr√©paration",icon:"schedule",allLabel:"Tous temps",options:[{value:"quick",label:"< 30 min"},{value:"medium",label:"30-60 min"},{value:"long",label:"> 60 min"}]}],hasActiveFilters:w,showFilters:n,goToRecipe:s=>{e.push(`/recipe/${s}`)},clearSearch:()=>{d.value=""},setSelectedCategory:e=>{p.value=e},updateAdditionalFilter:({key:e,value:s})=>{g.value[e]=s},clearAllFilters:()=>{d.value="",p.value=null,g.value={}},retry:()=>{a.clearError(),_()},forceRefresh:async()=>{console.log("üîÑ [RecipesList] Rechargement forc√© demand√©");try{await R.clearCache(),a.clearCache(),await a.fetchRecipesFresh(),console.log("‚úÖ [RecipesList] Rechargement forc√© termin√©")}catch(e){console.error("‚ùå [RecipesList] Erreur lors du rechargement forc√©:",e)}},getDifficultyLabel:e=>({easy:"Facile",medium:"Moyen",hard:"Difficile"}[e]||e),getPreparationTime:e=>e.preparation_time||0,getTotalTime:e=>(e.preparation_time||0)+(e.cooking_time||0)+(e.resting_time||0),showAuthModal:o}}},[["render",function(e,s,t,m,v,y){const k=c("BannerSection"),R=c("SearchAndFilters"),w=c("LikeButton"),_=c("AuthModal");return b(),a("div",Q,[l(k,{type:"recipes",section:"hero",banners:m.bannersByType},null,8,["banners"]),i("div",T,[i("button",{onClick:s[0]||(s[0]=e=>m.showFilters=!m.showFilters),class:"toggle-btn"},[i("span",j,n(m.showFilters?"expand_less":"expand_more"),1),i("span",null,n(m.showFilters?"Masquer les filtres":"Afficher les filtres"),1)]),i("button",{onClick:s[1]||(s[1]=(...e)=>m.forceRefresh&&m.forceRefresh(...e)),class:"refresh-btn",title:"Actualiser les donn√©es",disabled:m.loading},[i("span",{class:o(["material-symbols-outlined",{spinning:m.loading}])},"refresh",2),s[9]||(s[9]=i("span",null,"Actualiser",-1))],8,q)]),r(i("div",B,[l(R,{searchQuery:m.searchQuery,"onUpdate:searchQuery":s[2]||(s[2]=e=>m.searchQuery=e),selectedCategory:m.selectedCategory,"onUpdate:selectedCategory":s[3]||(s[3]=e=>m.selectedCategory=e),"search-placeholder":"Rechercher une recette...",categories:m.categories,"additional-filters":m.recipeFilters,"selected-filters":m.selectedFilters,"results-count":m.filteredRecipes.length,"item-type":"recette","onUpdate:additionalFilter":m.updateAdditionalFilter},null,8,["searchQuery","selectedCategory","categories","additional-filters","selected-filters","results-count","onUpdate:additionalFilter"])],512),[[u,m.showFilters]]),m.loading?(b(),a("div",M,s[10]||(s[10]=[i("div",{class:"loading-spinner"},null,-1),i("p",null,"Chargement des recettes...",-1)]))):m.error?(b(),a("div",x,[s[11]||(s[11]=i("div",{class:"error-icon"},[i("span",{class:"material-symbols-outlined"},"error"),i("span",{class:"emoji-fallback"},"‚ùå")],-1)),i("p",null,n(m.error),1),i("button",{onClick:s[4]||(s[4]=(...e)=>m.retry&&m.retry(...e)),class:"retry-btn"}," R√©essayer ")])):(b(),a("div",z,[m.filteredRecipes.length?(b(),a("div",D,[p(n(m.filteredRecipes.length)+" recette"+n(m.filteredRecipes.length>1?"s":"")+" ",1),m.searchQuery?(b(),a("span",U,' pour "'+n(m.searchQuery)+'"',1)):d("",!0)])):d("",!0),m.filteredRecipes.length||m.loading?(b(),a("div",N,[(b(!0),a(f,null,h(m.filteredRecipes,e=>{var t;return b(),a("article",{key:e.id,onClick:s=>m.goToRecipe(e.id),class:"recipe-card"},[i("div",W,[i("img",{src:e.featured_image_url||"/images/default-recipe.jpg",alt:e.title,loading:"lazy"},null,8,$),i("div",G,[i("div",H,[m.getTotalTime(e)?(b(),a("span",J,[s[13]||(s[13]=i("span",{class:"material-symbols-outlined"},"schedule",-1)),s[14]||(s[14]=i("span",{class:"emoji-fallback"},"‚è±Ô∏è",-1)),p(" "+n(m.getTotalTime(e))+"min ",1)])):d("",!0),e.difficulty?(b(),a("span",K,n(m.getDifficultyLabel(e.difficulty)),1)):d("",!0)])])]),i("div",X,[i("h3",Y,n(e.title),1),e.short_description?(b(),a("p",Z,n(e.short_description),1)):d("",!0),i("div",ee,[i("div",se,[l(w,{type:"recipe","item-id":e.id,"initial-liked":e.is_liked||!1,"initial-count":e.likes_count||0,"show-count":!0,size:"small",variant:"minimal",onAuthRequired:s[6]||(s[6]=e=>m.showAuthModal=!0),onClick:s[7]||(s[7]=g(()=>{},["stop"]))},null,8,["item-id","initial-liked","initial-count"])]),i("div",te,[s[15]||(s[15]=i("span",{class:"material-symbols-outlined"},"comment",-1)),s[16]||(s[16]=i("span",{class:"emoji-fallback"},"üí¨",-1)),i("span",null,n(e.comments_count||0),1)]),e.servings?(b(),a("div",ae,[s[17]||(s[17]=i("span",{class:"material-symbols-outlined"},"group",-1)),s[18]||(s[18]=i("span",{class:"emoji-fallback"},"üë•",-1)),i("span",null,n(e.servings),1)])):d("",!0),(null==(t=e.required_equipment)?void 0:t.length)?(b(),a("div",le,[s[19]||(s[19]=i("span",{class:"material-symbols-outlined"},"kitchen",-1)),s[20]||(s[20]=i("span",{class:"emoji-fallback"},"üç≥",-1)),i("span",null,n(e.required_equipment.length)+" √©quipement"+n(e.required_equipment.length>1?"s":""),1)])):d("",!0)])])],8,O)}),128))])):(b(),a("div",V,[s[12]||(s[12]=i("div",{class:"empty-icon"},[i("span",{class:"material-symbols-outlined"},"restaurant"),i("span",{class:"emoji-fallback"},"üçΩÔ∏è")],-1)),i("h3",null,n(m.searchQuery||m.selectedCategory||m.hasActiveFilters?"Aucune recette trouv√©e":"Aucune recette disponible"),1),m.searchQuery||m.selectedCategory||m.hasActiveFilters?(b(),a("p",I," Essayez de modifier vos crit√®res de recherche. ")):(b(),a("p",P," Les recettes seront bient√¥t disponibles. ")),m.searchQuery||m.selectedCategory||m.hasActiveFilters?(b(),a("button",{key:2,onClick:s[5]||(s[5]=(...e)=>m.clearAllFilters&&m.clearAllFilters(...e)),class:"clear-filters-btn"}," Effacer tous les filtres ")):d("",!0)]))])),l(_,{modelValue:m.showAuthModal,"onUpdate:modelValue":s[8]||(s[8]=e=>m.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-ecfd5f86"]]);export{ie as default};
