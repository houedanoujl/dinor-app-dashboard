import{h as e,k as i,j as a,l as t,i as s,t as l,A as o,F as d,E as r,z as n,b as c,r as u,g as v,o as m}from"./vendor.Bvrl98ec.js";import{_ as p,D as y,A as h,b as g}from"./index.CsDJUcBR.js";import{B as f,u as b}from"./BannerSection.BIM1sVFf.js";import{F as V}from"./FavoriteButton.BvxifCY-.js";import"./useApi.Cm5RO5Cj.js";const w={class:"dinor-tv"},k={key:0,class:"loading-state"},_={key:1,class:"error-state"},E={class:"error-icon"},j={class:"md3-body-large dinor-text-gray"},z={key:2,class:"content"},A={key:0,class:"live-section"},D={class:"live-grid"},C=["onClick"],T={class:"video-thumbnail"},B=["src","alt"],M={class:"video-overlay"},F={class:"play-button"},I={class:"video-info"},S={class:"video-title"},x={key:0,class:"video-description"},R={class:"video-meta"},$={key:0,class:"viewers"},L={key:1,class:"scheduled"},U={class:"videos-section"},q={key:0,class:"empty-state"},P={class:"empty-icon"},G={key:1,class:"videos-grid"},H={key:0,class:"featured-video md3-card"},J=["src","alt"],K={class:"play-overlay"},N={class:"play-button"},O={class:"video-info"},Q={class:"video-title md3-title-medium"},W={key:0,class:"video-description md3-body-medium dinor-text-gray"},X={class:"video-meta"},Y={class:"views-count"},Z={class:"video-date"},ee={class:"regular-videos"},ie=["onClick"],ae={class:"video-thumbnail"},te=["src","alt"],se={class:"play-overlay"},le={class:"play-button"},oe={class:"video-info"},de={class:"video-title md3-title-small"},re={class:"video-meta"},ne={class:"views-count"},ce={class:"video-date"},ue={class:"video-player"},ve=["src","title"],me={class:"video-details"},pe={key:0};const ye=p({name:"DinorTV",components:{FavoriteButton:V,AuthModal:h,BannerSection:f,DinorIcon:y},setup(){const{banners:e,loadBannersForContentType:i}=b(),a=c(()=>e.value),t=u([]),s=u(null),l=u(!1),o=u(null),d=u(!1),r=c(()=>t.value.filter(e=>e.is_live)),n=c(()=>t.value.find(e=>e.is_featured)||t.value[0]||null),m=c(()=>{const e=n.value;return e?t.value.filter(i=>i.id!==e.id):t.value}),p=async()=>{l.value=!0,o.value=null;try{const e=await g.getVideos();if(!e.success)throw new Error(e.message||"Failed to fetch videos");t.value=e.data}catch(e){o.value=e.message,console.error("Error fetching videos:",e)}finally{l.value=!1}};return v(async()=>{await i("videos",!0),p()}),{videos:t,liveVideos:r,featuredVideo:n,regularVideos:m,selectedVideo:s,loading:l,error:o,showAuthModal:d,bannersByType:a,retry:()=>{o.value=null,p()},playVideo:e=>{s.value=e,document.body.style.overflow="hidden"},closeVideo:()=>{s.value=null,document.body.style.overflow="auto"},getVideoThumbnail:e=>{if(!e)return"/images/default-video.jpg";const i=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);return i?`https://img.youtube.com/vi/${i[1]}/maxresdefault.jpg`:"/images/default-video.jpg"},getEmbedUrl:e=>{if(!e)return"";const i=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);return i?`https://www.youtube.com/embed/${i[1]}?autoplay=1`:e},getShortDescription:e=>{if(!e)return"";const i=e.replace(/<[^>]*>/g,"");return i.length>100?i.substring(0,100)+"...":i},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}):"",formatTime:e=>e?new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"",formatViews:e=>e&&0!==e?1===e?"1 vue":e<1e3?`${e} vues`:e<1e6?`${Math.floor(e/1e3)}k vues`:`${Math.floor(e/1e6)}M vues`:"0 vue",handleImageError:e=>{e.target.src="/images/default-video-thumbnail.jpg"}}}},[["render",function(c,u,v,p,y,h){const g=t("BannerSection"),f=t("DinorIcon"),b=t("FavoriteButton"),V=t("AuthModal");return m(),e("div",w,[i(g,{type:"videos",section:"hero",banners:p.bannersByType},null,8,["banners"]),p.loading?(m(),e("div",k,u[11]||(u[11]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"Chargement des vidéos...",-1)]))):p.error?(m(),e("div",_,[s("div",E,[i(f,{name:"error",size:32})]),u[12]||(u[12]=s("h2",{class:"md3-title-large"},"Erreur de chargement",-1)),s("p",j,l(p.error),1),s("button",{onClick:u[0]||(u[0]=(...e)=>p.retry&&p.retry(...e)),class:"btn-secondary"},"Réessayer")])):(m(),e("div",z,[p.liveVideos.length?(m(),e("section",A,[u[14]||(u[14]=s("h2",{class:"section-title"},[s("span",{class:"live-indicator"}),o(" En Direct ")],-1)),s("div",D,[(m(!0),e(d,null,r(p.liveVideos,t=>(m(),e("article",{key:t.id,onClick:e=>p.playVideo(t),class:"video-card live-card"},[s("div",T,[s("img",{src:p.getVideoThumbnail(t.video_url),alt:t.title,loading:"lazy"},null,8,B),s("div",M,[s("div",F,[i(f,{name:"play_circle",size:48})]),u[13]||(u[13]=s("div",{class:"live-badge"},[s("span",{class:"live-dot"}),o(" LIVE ")],-1))])]),s("div",I,[s("h3",S,l(t.title),1),t.description?(m(),e("p",x,l(p.getShortDescription(t.description)),1)):a("",!0),s("div",R,[t.viewers_count?(m(),e("span",$,[i(f,{name:"visibility",size:16}),o(" "+l(t.viewers_count)+" spectateurs ",1)])):a("",!0),t.scheduled_at?(m(),e("span",L," Programmé à "+l(p.formatTime(t.scheduled_at)),1)):a("",!0)])])],8,C))),128))])])):a("",!0),s("section",U,[u[19]||(u[19]=s("h2",{class:"section-title"},"Toutes les vidéos",-1)),p.videos.length||p.loading?(m(),e("div",G,[p.featuredVideo?(m(),e("div",H,[s("div",{class:"video-thumbnail",onClick:u[2]||(u[2]=e=>p.playVideo(p.featuredVideo))},[s("img",{src:p.getVideoThumbnail(p.featuredVideo.video_url)||"/images/default-video-thumbnail.jpg",alt:p.featuredVideo.title,onError:u[1]||(u[1]=(...e)=>p.handleImageError&&p.handleImageError(...e))},null,40,J),s("div",K,[s("div",N,[i(f,{name:"play_circle",size:48})])]),u[17]||(u[17]=s("div",{class:"video-badge featured-badge"},[s("span",null,"À la une")],-1))]),s("div",O,[s("h2",Q,l(p.featuredVideo.title),1),p.featuredVideo.description?(m(),e("p",W,l(p.featuredVideo.description),1)):a("",!0),s("div",X,[s("div",Y,[i(f,{name:"visibility",size:16}),s("span",null,l(p.formatViews(p.featuredVideo.view_count)),1)]),s("div",Z,[s("span",null,l(p.formatDate(p.featuredVideo.created_at)),1)]),i(b,{type:"dinor_tv","item-id":p.featuredVideo.id,"initial-favorited":!1,"initial-count":p.featuredVideo.favorites_count||0,"show-count":!0,size:"medium",onAuthRequired:u[3]||(u[3]=e=>p.showAuthModal=!0)},null,8,["item-id","initial-count"])])])])):a("",!0),s("div",ee,[(m(!0),e(d,null,r(p.regularVideos,a=>(m(),e("div",{key:a.id,class:"video-card md3-card md3-ripple",onClick:e=>p.playVideo(a)},[s("div",ae,[s("img",{src:p.getVideoThumbnail(a.video_url)||"/images/default-video-thumbnail.jpg",alt:a.title,onError:u[4]||(u[4]=(...e)=>p.handleImageError&&p.handleImageError(...e))},null,40,te),s("div",se,[s("div",le,[i(f,{name:"play_circle",size:48}),u[18]||(u[18]=s("span",{class:"emoji-fallback"},"▶️",-1))])])]),s("div",oe,[s("h3",de,l(a.title),1),s("div",re,[s("div",ne,[i(f,{name:"visibility",size:16}),s("span",null,l(p.formatViews(a.view_count)),1)]),s("div",ce,[s("span",null,l(p.formatDate(a.created_at)),1)]),i(b,{type:"dinor_tv","item-id":a.id,"initial-favorited":!1,"initial-count":a.favorites_count||0,"show-count":!0,size:"small",variant:"minimal",onAuthRequired:u[5]||(u[5]=e=>p.showAuthModal=!0),onClick:u[6]||(u[6]=n(()=>{},["stop"]))},null,8,["item-id","initial-count"])])])],8,ie))),128))])])):(m(),e("div",q,[s("div",P,[i(f,{name:"play_circle",size:48})]),u[15]||(u[15]=s("h3",null,"Aucune vidéo disponible",-1)),u[16]||(u[16]=s("p",null,"Les vidéos culinaires seront bientôt disponibles.",-1))]))])])),p.selectedVideo?(m(),e("div",{key:3,class:"video-modal",onClick:u[9]||(u[9]=(...e)=>p.closeVideo&&p.closeVideo(...e))},[s("div",{class:"modal-content",onClick:u[8]||(u[8]=n(()=>{},["stop"]))},[s("button",{onClick:u[7]||(u[7]=(...e)=>p.closeVideo&&p.closeVideo(...e)),class:"close-button"},[i(f,{name:"close",size:24})]),s("div",ue,[s("iframe",{src:p.getEmbedUrl(p.selectedVideo.video_url),title:p.selectedVideo.title,frameborder:"0",allowfullscreen:""},null,8,ve)]),s("div",me,[s("h3",null,l(p.selectedVideo.title),1),p.selectedVideo.description?(m(),e("p",pe,l(p.selectedVideo.description),1)):a("",!0)])])])):a("",!0),i(V,{modelValue:p.showAuthModal,"onUpdate:modelValue":u[10]||(u[10]=e=>p.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-11e6a8ca"]]);export{ye as default};
