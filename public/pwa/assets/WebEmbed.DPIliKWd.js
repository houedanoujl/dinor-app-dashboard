import{h as e,i as o,k as a,l as r,t as l,j as n,r as t,g as s,u,K as c,s as d,p as m,o as i}from"./vendor.Bvrl98ec.js";import{a as b}from"./useApi.CD5SC-zH.js";import{_ as g,D as v}from"./index.Bsia8KuI.js";const p={class:"web-embed"},f={class:"md3-main-content"},E={key:0,class:"error-state"},W={class:"error-icon"},L={class:"md3-body-large dinor-text-gray"},y={class:"error-actions"},h={key:1,class:"iframe-container"},I={key:0,class:"loading-overlay"},R=["src"],U={key:2,class:"placeholder-container"};const w=g({name:"WebEmbed",components:{DinorIcon:v},setup(){const e=m(),o=u(),{request:a}=b(),r=t(null),l=t(!0),n=t(!1),i=t(""),g=t("Page Web"),v=t(null),p=t("");let f=null;const E=async()=>{try{console.log("üîÑ [WebEmbed] D√©but du chargement de la derni√®re page..."),l.value=!0,n.value=!1,console.log("üì° [WebEmbed] Appel API vers /pages/latest");const e=await a("/pages/latest");if(console.log("üìã [WebEmbed] R√©ponse API re√ßue:",e),!e.success||!e.data)throw console.error("‚ùå [WebEmbed] R√©ponse API invalide:",e),new Error(e.message||"Aucune page disponible");{v.value=e.data,g.value=e.data.title||"Page Web",console.log("üìÑ [WebEmbed] Page trouv√©e:",{title:e.data.title,url:e.data.url,embed_url:e.data.embed_url});let o=e.data.embed_url||e.data.url;if(console.log("üîó [WebEmbed] URL √† charger:",o),!o)throw console.error("‚ùå [WebEmbed] Aucune URL disponible dans les donn√©es"),new Error("Aucune URL disponible pour cette page");if(!h(o))return console.warn("‚ö†Ô∏è [WebEmbed] URL d√©tect√©e comme non-compatible iframe:",o),n.value=!0,l.value=!1,void(i.value='Cette page ne peut pas √™tre affich√©e en iframe. Cliquez sur "Ouvrir dans un nouvel onglet" pour l\'afficher.');p.value=o,console.log("üöÄ [WebEmbed] URL finale d√©finie:",p.value),await c(),l.value=!1,console.log("‚úÖ [WebEmbed] Loading arr√™t√© - iframe peut maintenant se rendre"),L()}}catch(e){console.error("üí• [WebEmbed] Erreur lors du chargement:",e),n.value=!0,i.value=e.message||"Erreur lors du chargement de la page",l.value=!1}},W=()=>{console.log("üîç [WebEmbed] V√©rification des query parameters...");const e=o.query.url;if(console.log("üìã [WebEmbed] URL du query parameter:",e),!e)return console.log("‚ùå [WebEmbed] Aucune URL dans les query parameters"),"";try{let o=decodeURIComponent(e);return console.log("üîì [WebEmbed] URL d√©cod√©e:",o),new URL(o),console.log("‚úÖ [WebEmbed] URL valide, pr√™te √† √™tre charg√©e"),console.log("üöÄ [WebEmbed] URL finale du query parameter:",o),o}catch(a){return console.error("üí• [WebEmbed] Erreur de validation URL:",a),n.value=!0,i.value="URL invalide fournie",""}},L=()=>{f&&(clearTimeout(f),console.log("‚è∞ [WebEmbed] Ancien timeout annul√©")),console.log("‚è±Ô∏è [WebEmbed] D√©marrage du timeout de 30 secondes"),f=setTimeout(()=>{!n.value&&p.value&&(console.error("‚è∞ [WebEmbed] Timeout atteint - iframe non charg√©e"),console.error("‚è∞ [WebEmbed] URL qui posait probl√®me:",p.value),l.value=!1,n.value=!0,i.value="D√©lai de chargement d√©pass√©. La page met trop de temps √† r√©pondre.")},3e4)},y=()=>{console.log("üîÑ [WebEmbed] Rafra√Æchissement de la page..."),r.value&&p.value?(console.log("üîÅ [WebEmbed] Rechargement de l'iframe avec URL:",p.value),l.value=!0,n.value=!1,L(),r.value.src=p.value):(console.log("üîÑ [WebEmbed] Rechargement via API"),E())};s(async()=>{console.log("üöÄ [WebEmbed] Composant mont√©, initialisation..."),console.log("üìç [WebEmbed] Route actuelle:",o.path),console.log("üîç [WebEmbed] Query parameters:",o.query);const e=W();if(e){if(!h(e))return console.warn("‚ö†Ô∏è [WebEmbed] URL du query parameter non-compatible iframe:",e),n.value=!0,l.value=!1,void(i.value='Cette page ne peut pas √™tre affich√©e en iframe. Cliquez sur "Ouvrir dans un nouvel onglet" pour l\'afficher.');p.value=e,g.value="Page Web",await c(),l.value=!1,console.log("‚úÖ [WebEmbed] Loading arr√™t√© - iframe peut se rendre"),L()}else console.log("üì° [WebEmbed] Aucune URL en query parameter, chargement via API..."),await E();setTimeout(async()=>{await c(),console.log("üîç [WebEmbed] √âtat final apr√®s nextTick:"),console.log("  - embedUrl:",p.value),console.log("  - loading:",l.value),console.log("  - error:",n.value),console.log("  - webFrame pr√©sent:",!!r.value),r.value&&console.log("  - iframe src:",r.value.src)},100)}),d(()=>{f&&(clearTimeout(f),console.log("üßπ [WebEmbed] Composant d√©mont√©, timeout nettoy√©"))});const h=e=>{const o=["youtube.com","youtu.be","facebook.com","instagram.com","twitter.com","x.com","tiktok.com"];try{const a=new URL(e),r=o.some(e=>a.hostname.includes(e));return r?console.warn("üö´ [WebEmbed] Domaine connu pour bloquer les iframes:",a.hostname):console.log("‚úÖ [WebEmbed] Domaine autoris√© pour iframe:",a.hostname),!r}catch{return!1}};return{webFrame:r,loading:l,error:n,errorMessage:i,pageTitle:g,embedUrl:p,currentPage:v,onIframeLoad:()=>{console.log("‚úÖ [WebEmbed] Iframe charg√©e avec succ√®s pour:",p.value),n.value=!1,f&&(clearTimeout(f),f=null,console.log("‚è∞ [WebEmbed] Timeout annul√© - iframe charg√©e"));try{if(r.value&&r.value.contentDocument){const e=r.value.contentDocument.title;e&&(console.log("üìñ [WebEmbed] Titre de la page r√©cup√©r√©:",e),g.value=e)}}catch(e){console.log("‚ö†Ô∏è [WebEmbed] Impossible de r√©cup√©rer le titre (politique CORS):",e.message)}},onIframeError:e=>{console.error("üí• [WebEmbed] Erreur de chargement de l'iframe pour:",p.value),console.error("üí• [WebEmbed] D√©tails de l'√©v√©nement:",e),console.log("üîç [WebEmbed] Causes possibles :"),console.log("   ‚Ä¢ Le site a X-Frame-Options: DENY/SAMEORIGIN"),console.log("   ‚Ä¢ URL inaccessible ou inexistante"),console.log("   ‚Ä¢ Probl√®me de r√©seau ou timeout"),console.log("   ‚Ä¢ Site n√©cessitant HTTPS"),console.log("   ‚Ä¢ Politique Content-Security-Policy restrictive"),f&&(clearTimeout(f),f=null,console.log("‚è∞ [WebEmbed] Timeout annul√© - erreur d√©tect√©e")),n.value=!0,i.value="Ce site bloque l'affichage en iframe. Utilisez \"Ouvrir dans un nouvel onglet\" pour l'afficher."},onIframeLoadStart:()=>{console.log("üöÄ [WebEmbed] D√©but du chargement de l'iframe")},onIframeLoadEnd:()=>{console.log("‚úÖ [WebEmbed] Fin du chargement de l'iframe")},refreshPage:y,retryLoad:()=>{y()},openInNewTab:()=>{const e=p.value||v.value&&(v.value.embed_url||v.value.url);e?(console.log("üîó [WebEmbed] Ouverture dans un nouvel onglet:",e),window.open(e,"_blank","noopener,noreferrer")):console.warn("‚ö†Ô∏è [WebEmbed] Aucune URL disponible pour ouvrir dans un nouvel onglet")},goBack:()=>{e.go(-1)},loadLatestPage:E,getUrlFromQuery:W,canLoadInIframe:h}}},[["render",function(t,s,u,c,d,m){const b=r("DinorIcon");return i(),e("div",p,[o("main",f,[c.error?(i(),e("div",E,[o("div",W,[a(b,{name:"error",size:64})]),s[7]||(s[7]=o("h2",{class:"md3-title-large"},"Erreur de chargement",-1)),o("p",L,l(c.errorMessage),1),o("div",y,[o("button",{onClick:s[0]||(s[0]=(...e)=>c.retryLoad&&c.retryLoad(...e)),class:"btn-primary"},"R√©essayer"),c.embedUrl||c.currentPage&&(c.currentPage.embed_url||c.currentPage.url)?(i(),e("button",{key:0,onClick:s[1]||(s[1]=(...e)=>c.openInNewTab&&c.openInNewTab(...e)),class:"btn-secondary"},"Ouvrir dans un nouvel onglet")):n("",!0),o("button",{onClick:s[2]||(s[2]=(...e)=>c.goBack&&c.goBack(...e)),class:"btn-secondary"},"Retour")])])):(i(),e("div",h,[c.loading?(i(),e("div",I,s[8]||(s[8]=[o("div",{class:"loading-content"},[o("div",{class:"md3-circular-progress"}),o("p",{class:"md3-body-large"},"Chargement de la page...")],-1)]))):n("",!0),c.embedUrl?(i(),e("iframe",{key:1,ref:"webFrame",src:c.embedUrl,class:"web-iframe",title:"Page Web Int√©gr√©e",frameborder:"0",allowfullscreen:"",onLoad:s[3]||(s[3]=(...e)=>c.onIframeLoad&&c.onIframeLoad(...e)),onError:s[4]||(s[4]=(...e)=>c.onIframeError&&c.onIframeError(...e)),onLoadstart:s[5]||(s[5]=(...e)=>c.onIframeLoadStart&&c.onIframeLoadStart(...e)),onLoadend:s[6]||(s[6]=(...e)=>c.onIframeLoadEnd&&c.onIframeLoadEnd(...e))},null,40,R)):(i(),e("div",U,s[9]||(s[9]=[o("div",{class:"md3-circular-progress"},null,-1),o("p",{class:"md3-body-large"},"Pr√©paration de la page...",-1)])))]))])])}],["__scopeId","data-v-dc2f9869"]]);export{w as default};
