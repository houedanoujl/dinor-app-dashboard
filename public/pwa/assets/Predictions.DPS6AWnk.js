import{h as e,i as a,j as s,k as t,F as n,E as o,q as i,t as l,l as c,A as r,N as d,B as u,D as m,z as v,r as p,g as h,o as y}from"./vendor.Bvrl98ec.js";import{_,D as g,A as f,u as k,d as b}from"./index.CsDJUcBR.js";const w={class:"predictions"},M={class:"md3-main-content"},z={key:0,class:"loading-container"},A={class:"skeleton-loader"},S={class:"skeleton-tournaments"},T={key:1,class:"predictions-content"},D={class:"tournaments-section"},x={key:0,class:"tournaments-loading"},P={class:"skeleton-tournaments"},I={key:1,class:"tournaments-grid"},V=["onClick"],F={class:"tournament-header"},C={class:"tournament-name"},j={class:"tournament-description"},q={class:"tournament-info"},E={class:"info-item"},U={key:0,class:"info-item"},R={class:"info-item"},B={class:"tournament-actions"},L={class:"view-matches-btn"},N={key:2,class:"no-tournaments"},$={class:"no-tournaments-icon"},O={class:"rules-footer"},X={class:"rules-card"},G={class:"rules-title"},H={class:"modal-header"},J={class:"modal-title"},K={class:"modal-content"},Q={key:0,class:"matches-loading"},W={class:"skeleton-matches"},Y={key:1,class:"matches-list"},Z={class:"match-header"},ee={class:"match-teams"},ae={class:"team home-team"},se=["src","alt"],te={class:"team away-team"},ne=["src","alt"],oe={class:"match-info"},ie={class:"match-date"},le={key:0,class:"prediction-form"},ce={class:"score-inputs"},re={class:"score-input"},de=["onUpdate:modelValue","onInput"],ue={class:"score-input"},me=["onUpdate:modelValue","onInput"],ve={class:"prediction-status"},pe={key:0,class:"status-saving"},he={key:1,class:"status-saved"},ye={key:1,class:"prediction-auth-required"},_e={key:2,class:"existing-prediction"},ge={class:"prediction-score"},fe={key:2,class:"no-matches"};const ke=_({name:"Predictions",emits:["update-header"],components:{AuthModal:f,DinorIcon:g},setup(e,{emit:a}){const s=k(),t=b(),n=p([]),o=p(!0),i=p(!0),l=p(!1),c=p(null),r=p([]),d=p(!1),u=p({}),m=p([]),v=p([]),y=p({}),_=async e=>{c.value=e,d.value=!0;try{const a=await s.get(`/tournaments/${e.id}/matches`);a.success&&(r.value=a.data,a.data.forEach(e=>{var a,s;u.value[e.id]={homeScore:(null==(a=e.user_prediction)?void 0:a.predicted_home_score)||0,awayScore:(null==(s=e.user_prediction)?void 0:s.predicted_away_score)||0}}))}catch(a){console.error("Erreur lors du chargement des matchs:",a)}finally{d.value=!1}},g=async e=>{if(!t.isAuthenticated)return;const a=u.value[e];if(a&&null!==a.homeScore&&null!==a.awayScore){m.value.push(e);try{(await s.patch("/predictions/upsert",{football_match_id:e,predicted_home_score:a.homeScore,predicted_away_score:a.awayScore})).success&&(v.value.push(e),setTimeout(()=>{v.value=v.value.filter(a=>a!==e)},3e3))}catch(n){console.error("Erreur lors de la sauvegarde:",n)}finally{m.value=m.value.filter(a=>a!==e)}}};return h(()=>{(async()=>{i.value=!0;try{const e=await s.get("/tournaments/featured?limit=20");e.success&&(n.value=e.data)}catch(e){console.error("Erreur lors du chargement des tournois:",e)}finally{i.value=!1,o.value=!1}})(),a("update-header",{title:"Pronostics",showBack:!1})}),{tournaments:n,loading:o,loadingTournaments:i,showAuthModal:l,selectedTournament:c,tournamentMatches:r,loadingMatches:d,predictions:u,savingMatches:m,savedMatches:v,authStore:t,openTournamentMatches:_,closeTournamentModal:()=>{c.value=null,r.value=[],u.value={},m.value=[],v.value=[]},handlePredictionInput:e=>{y.value[e]&&clearTimeout(y.value[e]),v.value=v.value.filter(a=>a!==e),y.value[e]=setTimeout(()=>{g(e)},1e3)},formatTournamentDate:e=>{const a=new Date(e),s=new Date,t=Math.ceil((a-s)/864e5);return t<0?"Terminé":0===t?"Aujourd'hui":1===t?"Demain":t<7?`Dans ${t} jours`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},formatMatchDate:e=>new Date(e).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),formatPrize:(e,a)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:a||"XOF",minimumFractionDigits:0}).format(e),handleAuthenticated:()=>{l.value=!1,c.value&&_(c.value)}}}},[["render",function(p,h,_,g,f,k){const b=c("DinorIcon"),ke=c("AuthModal");return y(),e("div",w,[a("main",M,[g.loading?(y(),e("div",z,[a("div",A,[h[5]||(h[5]=a("div",{class:"skeleton-header"},null,-1)),a("div",S,[(y(),e(n,null,o(3,e=>a("div",{key:e,class:"skeleton-tournament"})),64))])])])):(y(),e("div",T,[h[11]||(h[11]=a("div",{class:"predictions-header"},[a("h1",{class:"md3-title-large dinor-text-primary"},"Pronostics"),a("p",{class:"md3-body-medium dinor-text-gray"}," Participez aux tournois et gagnez des points en prédisant les résultats ! ")],-1)),a("div",D,[g.loadingTournaments?(y(),e("div",x,[a("div",P,[(y(),e(n,null,o(4,e=>a("div",{key:e,class:"skeleton-tournament"})),64))])])):g.tournaments.length>0?(y(),e("div",I,[(y(!0),e(n,null,o(g.tournaments,n=>(y(),e("div",{key:n.id,class:"tournament-card",onClick:e=>g.openTournamentMatches(n)},[a("div",{class:i(["tournament-status",n.status])},l(n.status_label),3),a("div",F,[a("h3",C,l(n.name),1),a("p",j,l(n.description),1)]),a("div",q,[a("div",E,[t(b,{name:"group",size:16}),a("span",null,l(n.participants_count)+" participants",1)]),n.prize_pool?(y(),e("div",U,[t(b,{name:"trophy",size:16}),a("span",null,l(g.formatPrize(n.prize_pool,n.currency)),1)])):s("",!0),a("div",R,[t(b,{name:"schedule",size:16}),a("span",null,l(g.formatTournamentDate(n.start_date)),1)])]),a("div",B,[a("span",L,[t(b,{name:"target",size:16}),h[6]||(h[6]=r(" Voir les matchs "))])])],8,V))),128))])):(y(),e("div",N,[a("div",$,[t(b,{name:"trophy",size:64})]),h[7]||(h[7]=a("h3",{class:"md3-title-medium"},"Aucun tournoi disponible",-1)),h[8]||(h[8]=a("p",{class:"md3-body-medium dinor-text-gray"}," Les nouveaux tournois apparaîtront ici dès qu'ils seront disponibles. ",-1))]))]),a("div",O,[a("div",X,[a("h3",G,[t(b,{name:"info",size:20}),h[9]||(h[9]=r(" Règles des pronostics "))]),h[10]||(h[10]=d('<div class="rules-content" data-v-b912fc25><div class="rule-item" data-v-b912fc25><span class="points" data-v-b912fc25>3 pts</span><span class="rule-text" data-v-b912fc25>Score exact</span></div><div class="rule-item" data-v-b912fc25><span class="points" data-v-b912fc25>1 pt</span><span class="rule-text" data-v-b912fc25>Bon vainqueur</span></div><div class="rule-item" data-v-b912fc25><span class="points" data-v-b912fc25>0 pt</span><span class="rule-text" data-v-b912fc25>Pronostic incorrect</span></div></div>',1))])])]))]),g.selectedTournament?(y(),e("div",{key:0,class:"tournament-modal-overlay",onClick:h[3]||(h[3]=(...e)=>g.closeTournamentModal&&g.closeTournamentModal(...e))},[a("div",{class:"tournament-modal",onClick:h[2]||(h[2]=v(()=>{},["stop"]))},[a("div",H,[a("h2",J,l(g.selectedTournament.name),1),a("button",{onClick:h[0]||(h[0]=(...e)=>g.closeTournamentModal&&g.closeTournamentModal(...e)),class:"close-btn"},[t(b,{name:"close",size:20})])]),a("div",K,[g.loadingMatches?(y(),e("div",Q,[a("div",W,[(y(),e(n,null,o(3,e=>a("div",{key:e,class:"skeleton-match"})),64))])])):g.tournamentMatches.length>0?(y(),e("div",Y,[(y(!0),e(n,null,o(g.tournamentMatches,n=>(y(),e("div",{key:n.id,class:i(["match-card",{"match-saved":g.savedMatches.includes(n.id)}])},[a("div",Z,[a("div",ee,[a("div",ae,[n.home_team.logo_url?(y(),e("img",{key:0,src:n.home_team.logo_url,alt:n.home_team.name},null,8,se)):s("",!0),a("span",null,l(n.home_team.short_name||n.home_team.name),1)]),h[12]||(h[12]=a("div",{class:"vs"},"vs",-1)),a("div",te,[n.away_team.logo_url?(y(),e("img",{key:0,src:n.away_team.logo_url,alt:n.away_team.name},null,8,ne)):s("",!0),a("span",null,l(n.away_team.short_name||n.away_team.name),1)])]),a("div",oe,[a("span",ie,l(g.formatMatchDate(n.match_date)),1),a("span",{class:i(["match-status",n.can_predict?"open":"closed"])},l(n.can_predict?"Pronostics ouverts":"Fermé"),3)])]),g.authStore.isAuthenticated&&n.can_predict?(y(),e("div",le,[a("div",ce,[a("div",re,[a("label",null,l(n.home_team.short_name||n.home_team.name),1),u(a("input",{"onUpdate:modelValue":e=>g.predictions[n.id].homeScore=e,onInput:e=>g.handlePredictionInput(n.id),type:"number",min:"0",max:"20",class:i(["score-field",{saving:g.savingMatches.includes(n.id),saved:g.savedMatches.includes(n.id)}])},null,42,de),[[m,g.predictions[n.id].homeScore,void 0,{number:!0}]])]),h[13]||(h[13]=a("div",{class:"score-separator"},"-",-1)),a("div",ue,[a("label",null,l(n.away_team.short_name||n.away_team.name),1),u(a("input",{"onUpdate:modelValue":e=>g.predictions[n.id].awayScore=e,onInput:e=>g.handlePredictionInput(n.id),type:"number",min:"0",max:"20",class:i(["score-field",{saving:g.savingMatches.includes(n.id),saved:g.savedMatches.includes(n.id)}])},null,42,me),[[m,g.predictions[n.id].awayScore,void 0,{number:!0}]])])]),a("div",ve,[g.savingMatches.includes(n.id)?(y(),e("span",pe,[t(b,{name:"loading",size:16}),h[14]||(h[14]=r(" Sauvegarde... "))])):g.savedMatches.includes(n.id)?(y(),e("span",he,[t(b,{name:"check_circle",size:16}),h[15]||(h[15]=r(" Sauvegardé "))])):s("",!0)])])):!g.authStore.isAuthenticated&&n.can_predict?(y(),e("div",ye,[a("button",{onClick:h[1]||(h[1]=e=>g.showAuthModal=!0),class:"btn-predict"},[t(b,{name:"person",size:16}),h[16]||(h[16]=r(" Pronostiquer "))])])):s("",!0),n.user_prediction?(y(),e("div",_e,[h[17]||(h[17]=a("span",{class:"prediction-label"},"Votre pronostic :",-1)),a("span",ge,l(n.user_prediction.predicted_home_score)+" - "+l(n.user_prediction.predicted_away_score),1)])):s("",!0)],2))),128))])):(y(),e("div",fe,[t(b,{name:"target",size:48}),h[18]||(h[18]=a("p",null,"Aucun match disponible pour ce tournoi",-1))]))])])])):s("",!0),t(ke,{modelValue:g.showAuthModal,"onUpdate:modelValue":h[4]||(h[4]=e=>g.showAuthModal=e),onAuthenticated:g.handleAuthenticated},null,8,["modelValue","onAuthenticated"])])}],["__scopeId","data-v-b912fc25"]]);export{ke as default};
