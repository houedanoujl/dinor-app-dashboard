import{d as e,r as t,b as s,h as a,k as i,i as l,B as r,l as c,t as n,q as o,L as u,j as d,A as p,F as f,E as h,z as g,g as v,s as y,w as m,p as k,o as R}from"./vendor.Bvrl98ec.js";import{b as w,_,D as C,A as F,c as b}from"./index.Bsia8KuI.js";import{B as L,u as A}from"./BannerSection.B2oN4XQD.js";import{S as E}from"./SearchAndFilters.DPYZdhhF.js";import{L as S}from"./LikeButton.BaS3FP9-.js";import"./useApi.CD5SC-zH.js";const Q=e("recipes",()=>{const e=t([]),a=t(null),i=t(!1),l=t(null),r=t(""),c=t(null),n=t({current_page:1,last_page:1,per_page:12,total:0}),o=s(()=>{let t=e.value;if(r.value){const e=r.value.toLowerCase();t=t.filter(t=>{var s,a;return t.title.toLowerCase().includes(e)||(null==(s=t.short_description)?void 0:s.toLowerCase().includes(e))||(null==(a=t.tags)?void 0:a.some(t=>t.toLowerCase().includes(e)))})}return c.value&&(t=t.filter(e=>e.category_id===c.value)),t}),u=s(()=>e.value.filter(e=>e.is_featured));return{recipes:e,currentRecipe:a,loading:i,error:l,searchQuery:r,selectedCategory:c,pagination:n,filteredRecipes:o,featuredRecipes:u,fetchRecipes:async function(t={}){i.value=!0,l.value=null;try{const s=await w.getRecipes(t);if(!s.success)throw new Error(s.message||"Failed to fetch recipes");e.value=s.data,s.meta&&(n.value=s.meta)}catch(s){l.value=s.message,console.error("Error fetching recipes:",s)}finally{i.value=!1}},fetchRecipesFresh:async function(t={}){i.value=!0,l.value=null;try{console.log("üîÑ [RecipesStore] Rafra√Æchissement forc√© des recettes (cache d√©sactiv√©)");const s=await w.getRecipes(t);if(!s.success)throw new Error(s.message||"Failed to fetch recipes");e.value=s.data,s.meta&&(n.value=s.meta),console.log("‚úÖ [RecipesStore] Recettes rafra√Æchies:",s.data.length)}catch(s){l.value=s.message,console.error("Error fetching recipes:",s)}finally{i.value=!1}},fetchRecipe:async function(e){i.value=!0,l.value=null;try{const t=await w.getRecipe(e);if(!t.success)throw new Error(t.message||"Failed to fetch recipe");a.value=t.data}catch(t){l.value=t.message,console.error("Error fetching recipe:",t)}finally{i.value=!1}},fetchRecipeFresh:async function(e){i.value=!0,l.value=null;try{console.log("üîÑ [RecipesStore] Rafra√Æchissement forc√© de la recette:",e,"(cache d√©sactiv√©)");const t=await w.getRecipe(e);if(!t.success)throw new Error(t.message||"Failed to fetch recipe");a.value=t.data,console.log("‚úÖ [RecipesStore] Recette rafra√Æchie:",t.data.title)}catch(t){l.value=t.message,console.error("Error fetching recipe:",t)}finally{i.value=!1}},toggleLike:async function(t){try{const s=await w.toggleLike("recipes",t);if(s.success){const i=e.value.find(e=>e.id===t);return i&&(i.is_liked=s.data.is_liked,i.likes_count=s.data.likes_count),a.value&&a.value.id===t&&(a.value.is_liked=s.data.is_liked,a.value.likes_count=s.data.likes_count),s.data}}catch(s){return console.error("Error toggling like:",s),{success:!1}}},setSearchQuery:function(e){r.value=e},setSelectedCategory:function(e){c.value=e},clearFilters:function(){r.value="",c.value=null},clearCurrentRecipe:function(){a.value=null},clearError:function(){l.value=null}}}),T={class:"recipes-list"},q={class:"filters-toggle"},z=["disabled"],B={class:"filters-container"},j={key:0,class:"loading-state"},M={key:1,class:"error-state"},D={class:"error-icon"},x={key:2,class:"content"},U={key:0,class:"results-info"},I={key:0},V={key:1,class:"empty-state"},P={class:"empty-icon"},N={key:0},O={key:1},W={key:2,class:"recipes-grid"},$=["onClick"],G={class:"recipe-image"},H=["src","alt"],J={class:"recipe-overlay"},K={class:"recipe-meta"},X={key:0,class:"time"},Y={key:1,class:"difficulty"},Z={class:"recipe-content"},ee={class:"recipe-title"},te={key:0,class:"recipe-description"},se={class:"recipe-stats"},ae={class:"stat"},ie={class:"stat"},le={key:0,class:"stat"},re={key:1,class:"stat equipment"};const ce=_({name:"RecipesList",components:{BannerSection:L,SearchAndFilters:E,LikeButton:S,AuthModal:F,DinorIcon:C},setup(){const e=k(),a=Q(),i=b(),{banners:l,loadBannersForContentType:r}=A(),c=s(()=>l.value),n=t(!1),o=t(!1),u=t([]),d=s({get:()=>a.searchQuery,set:e=>a.setSearchQuery(e)}),p=s({get:()=>a.selectedCategory,set:e=>a.setSelectedCategory(e)}),f=s(()=>a.loading),h=s(()=>a.error),g=t({}),R=s(()=>{var e;let t=a.recipes;if(null==(e=d.value)?void 0:e.trim()){const e=d.value.toLowerCase();t=t.filter(t=>{var s,a,i;return(null==(s=t.title)?void 0:s.toLowerCase().includes(e))||(null==(a=t.short_description)?void 0:a.toLowerCase().includes(e))||(null==(i=t.tags)?void 0:i.some(t=>t.toLowerCase().includes(e)))})}if(p.value&&(t=t.filter(e=>e.category_id===p.value)),g.value.difficulty&&(t=t.filter(e=>e.difficulty===g.value.difficulty)),g.value.prep_time){const e=g.value.prep_time;t=t.filter(t=>{const s=t.preparation_time||0;return"quick"===e?s<30:"medium"===e?s>=30&&s<=60:"long"!==e||s>60})}return t}),_=s(()=>Object.values(g.value).some(e=>null!==e)),C=async(e=!1)=>{e&&(console.log("üîÑ [RecipesList] Rechargement forc√© des recettes"),a.clearCache(),await w.clearCache()),await a.fetchRecipesFresh()},F=e=>{const{type:t,id:s,liked:a,count:i}=e.detail;if("recipe"===t){const e=R.value.find(e=>e.id==s);e&&(e.is_liked=a,e.likes_count=i)}};return v(()=>{C(),(async()=>{try{console.log("üç≥ [RecipesList] Chargement banni√®res pour type: recipes"),await r("recipes",!0)}catch(e){console.error("Error loading banners:",e)}})(),(async()=>{try{const e=await w.getRecipeCategories();e.success&&(u.value=e.data)}catch(e){console.error("Error loading categories:",e)}})(),i.initializePWAListeners(),i.initializeNetworkListeners(),window.addEventListener("like-updated",F)}),y(()=>{window.removeEventListener("like-updated",F)}),m(d,e=>{}),{searchQuery:d,selectedCategory:p,loading:f,error:h,filteredRecipes:R,categories:u,bannersByType:c,selectedFilters:g,recipeFilters:[{key:"difficulty",label:"Difficult√©",icon:"star",allLabel:"Tous niveaux",options:[{value:"easy",label:"Facile"},{value:"medium",label:"Moyen"},{value:"hard",label:"Difficile"}]},{key:"prep_time",label:"Temps de pr√©paration",icon:"schedule",allLabel:"Tous temps",options:[{value:"quick",label:"< 30 min"},{value:"medium",label:"30-60 min"},{value:"long",label:"> 60 min"}]}],hasActiveFilters:_,showFilters:n,goToRecipe:t=>{e.push(`/recipe/${t}`)},clearSearch:()=>{d.value=""},setSelectedCategory:e=>{p.value=e},updateAdditionalFilter:({key:e,value:t})=>{g.value[e]=t},clearAllFilters:()=>{d.value="",p.value=null,g.value={}},retry:()=>{a.clearError(),C()},forceRefresh:async()=>{console.log("üîÑ [RecipesList] Rechargement forc√© demand√©");try{await w.clearCache(),a.clearCache(),await a.fetchRecipesFresh(),console.log("‚úÖ [RecipesList] Rechargement forc√© termin√©")}catch(e){console.error("‚ùå [RecipesList] Erreur lors du rechargement forc√©:",e)}},getDifficultyLabel:e=>({easy:"Facile",medium:"Moyen",hard:"Difficile"}[e]||e),getPreparationTime:e=>e.preparation_time||0,getTotalTime:e=>(e.preparation_time||0)+(e.cooking_time||0)+(e.resting_time||0),showAuthModal:o}}},[["render",function(e,t,s,v,y,m){const k=c("BannerSection"),w=c("DinorIcon"),_=c("SearchAndFilters"),C=c("LikeButton"),F=c("AuthModal");return R(),a("div",T,[i(k,{type:"recipes",section:"hero",banners:v.bannersByType},null,8,["banners"]),l("div",q,[l("button",{onClick:t[0]||(t[0]=e=>v.showFilters=!v.showFilters),class:"toggle-btn"},[i(w,{name:v.showFilters?"expand_less":"expand_more",size:20},null,8,["name"]),l("span",null,n(v.showFilters?"Masquer les filtres":"Afficher les filtres"),1)]),l("button",{onClick:t[1]||(t[1]=(...e)=>v.forceRefresh&&v.forceRefresh(...e)),class:"refresh-btn",title:"Actualiser les donn√©es",disabled:v.loading},[i(w,{name:"refresh",size:20,class:o({spinning:v.loading})},null,8,["class"]),t[9]||(t[9]=l("span",null,"Actualiser",-1))],8,z)]),r(l("div",B,[i(_,{searchQuery:v.searchQuery,"onUpdate:searchQuery":t[2]||(t[2]=e=>v.searchQuery=e),selectedCategory:v.selectedCategory,"onUpdate:selectedCategory":t[3]||(t[3]=e=>v.selectedCategory=e),"search-placeholder":"Rechercher une recette...",categories:v.categories,"additional-filters":v.recipeFilters,"selected-filters":v.selectedFilters,"results-count":v.filteredRecipes.length,"item-type":"recette","onUpdate:additionalFilter":v.updateAdditionalFilter},null,8,["searchQuery","selectedCategory","categories","additional-filters","selected-filters","results-count","onUpdate:additionalFilter"])],512),[[u,v.showFilters]]),v.loading?(R(),a("div",j,t[10]||(t[10]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Chargement des recettes...",-1)]))):v.error?(R(),a("div",M,[l("div",D,[i(w,{name:"error",size:32})]),l("p",null,n(v.error),1),l("button",{onClick:t[4]||(t[4]=(...e)=>v.retry&&v.retry(...e)),class:"retry-btn"}," R√©essayer ")])):(R(),a("div",x,[v.filteredRecipes.length?(R(),a("div",U,[p(n(v.filteredRecipes.length)+" recette"+n(v.filteredRecipes.length>1?"s":"")+" ",1),v.searchQuery?(R(),a("span",I,' pour "'+n(v.searchQuery)+'"',1)):d("",!0)])):d("",!0),v.filteredRecipes.length||v.loading?(R(),a("div",W,[(R(!0),a(f,null,h(v.filteredRecipes,e=>{var s;return R(),a("article",{key:e.id,onClick:t=>v.goToRecipe(e.id),class:"recipe-card"},[l("div",G,[l("img",{src:e.featured_image_url||"/images/default-recipe.jpg",alt:e.title,loading:"lazy"},null,8,H),l("div",J,[l("div",K,[v.getTotalTime(e)?(R(),a("span",X,[i(w,{name:"schedule",size:18}),p(" "+n(v.getTotalTime(e))+"min ",1)])):d("",!0),e.difficulty?(R(),a("span",Y,n(v.getDifficultyLabel(e.difficulty)),1)):d("",!0)])])]),l("div",Z,[l("h3",ee,n(e.title),1),e.short_description?(R(),a("p",te,n(e.short_description),1)):d("",!0),l("div",se,[l("div",ae,[i(C,{type:"recipe","item-id":e.id,"initial-liked":e.is_liked||!1,"initial-count":e.likes_count||0,"show-count":!0,size:"small",variant:"minimal",onAuthRequired:t[6]||(t[6]=e=>v.showAuthModal=!0),onClick:t[7]||(t[7]=g(()=>{},["stop"]))},null,8,["item-id","initial-liked","initial-count"])]),l("div",ie,[i(w,{name:"comment",size:18}),l("span",null,n(e.comments_count||0),1)]),e.servings?(R(),a("div",le,[i(w,{name:"group",size:18}),l("span",null,n(e.servings),1)])):d("",!0),(null==(s=e.required_equipment)?void 0:s.length)?(R(),a("div",re,[i(w,{name:"kitchen",size:18}),l("span",null,n(e.required_equipment.length)+" √©quipement"+n(e.required_equipment.length>1?"s":""),1)])):d("",!0)])])],8,$)}),128))])):(R(),a("div",V,[l("div",P,[i(w,{name:"restaurant",size:32})]),l("h3",null,n(v.searchQuery||v.selectedCategory||v.hasActiveFilters?"Aucune recette trouv√©e":"Aucune recette disponible"),1),v.searchQuery||v.selectedCategory||v.hasActiveFilters?(R(),a("p",N," Essayez de modifier vos crit√®res de recherche. ")):(R(),a("p",O," Les recettes seront bient√¥t disponibles. ")),v.searchQuery||v.selectedCategory||v.hasActiveFilters?(R(),a("button",{key:2,onClick:t[5]||(t[5]=(...e)=>v.clearAllFilters&&v.clearAllFilters(...e)),class:"clear-filters-btn"}," Effacer tous les filtres ")):d("",!0)]))])),i(F,{modelValue:v.showAuthModal,"onUpdate:modelValue":t[8]||(t[8]=e=>v.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-cc8f718b"]]);export{ce as default};
