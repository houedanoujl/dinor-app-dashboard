import{h as a,i as e,j as s,k as t,F as n,D as o,M as l,q as i,t as c,z as r,A as d,C as u,y as m,l as p,r as v,g as h,o as y}from"./vendor.h2smxeay.js";import{_,A as g,u as k,d as f}from"./index.BRBqb7Zw.js";const b={class:"predictions"},M={class:"md3-main-content"},w={key:0,class:"loading-container"},A={class:"skeleton-loader"},S={class:"skeleton-tournaments"},T={key:1,class:"predictions-content"},x={class:"tournaments-section"},D={key:0,class:"tournaments-loading"},P={class:"skeleton-tournaments"},I={key:1,class:"tournaments-grid"},V=["onClick"],F={class:"tournament-header"},j={class:"tournament-name"},z={class:"tournament-description"},C={class:"tournament-info"},q={class:"info-item"},U={key:0,class:"info-item"},E={class:"info-item"},R={key:2,class:"no-tournaments"},L={class:"modal-header"},B={class:"modal-title"},$={class:"modal-content"},N={key:0,class:"matches-loading"},O={class:"skeleton-matches"},X={key:1,class:"matches-list"},G={class:"match-header"},H={class:"match-teams"},J={class:"team home-team"},K=["src","alt"],Q={class:"team away-team"},W=["src","alt"],Y={class:"match-info"},Z={class:"match-date"},aa={key:0,class:"prediction-form"},ea={class:"score-inputs"},sa={class:"score-input"},ta=["onUpdate:modelValue","onInput"],na={class:"score-input"},oa=["onUpdate:modelValue","onInput"],la={class:"prediction-status"},ia={key:0,class:"status-saving"},ca={key:1,class:"status-saved"},ra={key:1,class:"prediction-auth-required"},da={key:2,class:"existing-prediction"},ua={class:"prediction-score"},ma={key:2,class:"no-matches"};const pa=_({name:"Predictions",emits:["update-header"],components:{AuthModal:g},setup(a,{emit:e}){const s=k(),t=f(),n=v([]),o=v(!0),l=v(!0),i=v(!1),c=v(null),r=v([]),d=v(!1),u=v({}),m=v([]),p=v([]),y=v({}),_=async a=>{c.value=a,d.value=!0;try{const e=await s.get(`/tournaments/${a.id}/matches`);e.success&&(r.value=e.data,e.data.forEach(a=>{var e,s;u.value[a.id]={homeScore:(null==(e=a.user_prediction)?void 0:e.predicted_home_score)||0,awayScore:(null==(s=a.user_prediction)?void 0:s.predicted_away_score)||0}}))}catch(e){console.error("Erreur lors du chargement des matchs:",e)}finally{d.value=!1}},g=async a=>{if(!t.isAuthenticated)return;const e=u.value[a];if(e&&null!==e.homeScore&&null!==e.awayScore){m.value.push(a);try{(await s.patch("/predictions/upsert",{football_match_id:a,predicted_home_score:e.homeScore,predicted_away_score:e.awayScore})).success&&(p.value.push(a),setTimeout(()=>{p.value=p.value.filter(e=>e!==a)},3e3))}catch(n){console.error("Erreur lors de la sauvegarde:",n)}finally{m.value=m.value.filter(e=>e!==a)}}};return h(()=>{(async()=>{l.value=!0;try{const a=await s.get("/tournaments/featured?limit=20");a.success&&(n.value=a.data)}catch(a){console.error("Erreur lors du chargement des tournois:",a)}finally{l.value=!1,o.value=!1}})(),e("update-header",{title:"Pronostics",showBack:!1})}),{tournaments:n,loading:o,loadingTournaments:l,showAuthModal:i,selectedTournament:c,tournamentMatches:r,loadingMatches:d,predictions:u,savingMatches:m,savedMatches:p,authStore:t,openTournamentMatches:_,closeTournamentModal:()=>{c.value=null,r.value=[],u.value={},m.value=[],p.value=[]},handlePredictionInput:a=>{y.value[a]&&clearTimeout(y.value[a]),p.value=p.value.filter(e=>e!==a),y.value[a]=setTimeout(()=>{g(a)},1e3)},formatTournamentDate:a=>{const e=new Date(a),s=new Date,t=Math.ceil((e-s)/864e5);return t<0?"Terminé":0===t?"Aujourd'hui":1===t?"Demain":t<7?`Dans ${t} jours`:e.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},formatMatchDate:a=>new Date(a).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),formatPrize:(a,e)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:e||"XOF",minimumFractionDigits:0}).format(a),handleAuthenticated:()=>{i.value=!1,c.value&&_(c.value)}}}},[["render",function(v,h,_,g,k,f){const pa=p("AuthModal");return y(),a("div",b,[e("main",M,[g.loading?(y(),a("div",w,[e("div",A,[h[5]||(h[5]=e("div",{class:"skeleton-header"},null,-1)),e("div",S,[(y(),a(n,null,o(3,a=>e("div",{key:a,class:"skeleton-tournament"})),64))])])])):(y(),a("div",T,[h[11]||(h[11]=e("div",{class:"predictions-header"},[e("h1",{class:"md3-title-large dinor-text-primary"},"Pronostics"),e("p",{class:"md3-body-medium dinor-text-gray"}," Participez aux tournois et gagnez des points en prédisant les résultats ! ")],-1)),e("div",x,[g.loadingTournaments?(y(),a("div",D,[e("div",P,[(y(),a(n,null,o(4,a=>e("div",{key:a,class:"skeleton-tournament"})),64))])])):g.tournaments.length>0?(y(),a("div",I,[(y(!0),a(n,null,o(g.tournaments,t=>(y(),a("div",{key:t.id,class:"tournament-card",onClick:a=>g.openTournamentMatches(t)},[e("div",{class:i(["tournament-status",t.status])},c(t.status_label),3),e("div",F,[e("h3",j,c(t.name),1),e("p",z,c(t.description),1)]),e("div",C,[e("div",q,[h[6]||(h[6]=e("span",{class:"material-symbols-outlined"},"groups",-1)),e("span",null,c(t.participants_count)+" participants",1)]),t.prize_pool?(y(),a("div",U,[h[7]||(h[7]=e("span",{class:"material-symbols-outlined"},"emoji_events",-1)),e("span",null,c(g.formatPrize(t.prize_pool,t.currency)),1)])):s("",!0),e("div",E,[h[8]||(h[8]=e("span",{class:"material-symbols-outlined"},"schedule",-1)),e("span",null,c(g.formatTournamentDate(t.start_date)),1)])]),h[9]||(h[9]=e("div",{class:"tournament-actions"},[e("span",{class:"view-matches-btn"},[e("span",{class:"material-symbols-outlined"},"sports_soccer"),r(" Voir les matchs ")])],-1))],8,V))),128))])):(y(),a("div",R,h[10]||(h[10]=[e("div",{class:"no-tournaments-icon"},[e("span",{class:"material-symbols-outlined"},"emoji_events")],-1),e("h3",{class:"md3-title-medium"},"Aucun tournoi disponible",-1),e("p",{class:"md3-body-medium dinor-text-gray"}," Les nouveaux tournois apparaîtront ici dès qu'ils seront disponibles. ",-1)])))]),h[12]||(h[12]=l('<div class="rules-footer" data-v-1023441a><div class="rules-card" data-v-1023441a><h3 class="rules-title" data-v-1023441a><span class="material-symbols-outlined" data-v-1023441a>info</span> Règles des pronostics </h3><div class="rules-content" data-v-1023441a><div class="rule-item" data-v-1023441a><span class="points" data-v-1023441a>3 pts</span><span class="rule-text" data-v-1023441a>Score exact</span></div><div class="rule-item" data-v-1023441a><span class="points" data-v-1023441a>1 pt</span><span class="rule-text" data-v-1023441a>Bon vainqueur</span></div><div class="rule-item" data-v-1023441a><span class="points" data-v-1023441a>0 pt</span><span class="rule-text" data-v-1023441a>Pronostic incorrect</span></div></div></div></div>',1))]))]),g.selectedTournament?(y(),a("div",{key:0,class:"tournament-modal-overlay",onClick:h[3]||(h[3]=(...a)=>g.closeTournamentModal&&g.closeTournamentModal(...a))},[e("div",{class:"tournament-modal",onClick:h[2]||(h[2]=m(()=>{},["stop"]))},[e("div",L,[e("h2",B,c(g.selectedTournament.name),1),e("button",{onClick:h[0]||(h[0]=(...a)=>g.closeTournamentModal&&g.closeTournamentModal(...a)),class:"close-btn"},h[13]||(h[13]=[e("span",{class:"material-symbols-outlined"},"close",-1)]))]),e("div",$,[g.loadingMatches?(y(),a("div",N,[e("div",O,[(y(),a(n,null,o(3,a=>e("div",{key:a,class:"skeleton-match"})),64))])])):g.tournamentMatches.length>0?(y(),a("div",X,[(y(!0),a(n,null,o(g.tournamentMatches,t=>(y(),a("div",{key:t.id,class:i(["match-card",{"match-saved":g.savedMatches.includes(t.id)}])},[e("div",G,[e("div",H,[e("div",J,[t.home_team.logo_url?(y(),a("img",{key:0,src:t.home_team.logo_url,alt:t.home_team.name},null,8,K)):s("",!0),e("span",null,c(t.home_team.short_name||t.home_team.name),1)]),h[14]||(h[14]=e("div",{class:"vs"},"vs",-1)),e("div",Q,[t.away_team.logo_url?(y(),a("img",{key:0,src:t.away_team.logo_url,alt:t.away_team.name},null,8,W)):s("",!0),e("span",null,c(t.away_team.short_name||t.away_team.name),1)])]),e("div",Y,[e("span",Z,c(g.formatMatchDate(t.match_date)),1),e("span",{class:i(["match-status",t.can_predict?"open":"closed"])},c(t.can_predict?"Pronostics ouverts":"Fermé"),3)])]),g.authStore.isAuthenticated&&t.can_predict?(y(),a("div",aa,[e("div",ea,[e("div",sa,[e("label",null,c(t.home_team.short_name||t.home_team.name),1),d(e("input",{"onUpdate:modelValue":a=>g.predictions[t.id].homeScore=a,onInput:a=>g.handlePredictionInput(t.id),type:"number",min:"0",max:"20",class:i(["score-field",{saving:g.savingMatches.includes(t.id),saved:g.savedMatches.includes(t.id)}])},null,42,ta),[[u,g.predictions[t.id].homeScore,void 0,{number:!0}]])]),h[15]||(h[15]=e("div",{class:"score-separator"},"-",-1)),e("div",na,[e("label",null,c(t.away_team.short_name||t.away_team.name),1),d(e("input",{"onUpdate:modelValue":a=>g.predictions[t.id].awayScore=a,onInput:a=>g.handlePredictionInput(t.id),type:"number",min:"0",max:"20",class:i(["score-field",{saving:g.savingMatches.includes(t.id),saved:g.savedMatches.includes(t.id)}])},null,42,oa),[[u,g.predictions[t.id].awayScore,void 0,{number:!0}]])])]),e("div",la,[g.savingMatches.includes(t.id)?(y(),a("span",ia,h[16]||(h[16]=[e("span",{class:"material-symbols-outlined"},"sync",-1),r(" Sauvegarde... ")]))):g.savedMatches.includes(t.id)?(y(),a("span",ca,h[17]||(h[17]=[e("span",{class:"material-symbols-outlined"},"check_circle",-1),r(" Sauvegardé ")]))):s("",!0)])])):!g.authStore.isAuthenticated&&t.can_predict?(y(),a("div",ra,[e("button",{onClick:h[1]||(h[1]=a=>g.showAuthModal=!0),class:"btn-predict"},h[18]||(h[18]=[e("span",{class:"material-symbols-outlined"},"person",-1),r(" Pronostiquer ")]))])):s("",!0),t.user_prediction?(y(),a("div",da,[h[19]||(h[19]=e("span",{class:"prediction-label"},"Votre pronostic :",-1)),e("span",ua,c(t.user_prediction.predicted_home_score)+" - "+c(t.user_prediction.predicted_away_score),1)])):s("",!0)],2))),128))])):(y(),a("div",ma,h[20]||(h[20]=[e("span",{class:"material-symbols-outlined"},"sports_soccer",-1),e("p",null,"Aucun match disponible pour ce tournoi",-1)])))])])])):s("",!0),t(pa,{modelValue:g.showAuthModal,"onUpdate:modelValue":h[4]||(h[4]=a=>g.showAuthModal=a),onAuthenticated:g.handleAuthenticated},null,8,["modelValue","onAuthenticated"])])}],["__scopeId","data-v-1023441a"]]);export{pa as default};
