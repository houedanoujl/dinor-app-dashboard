import{e,f as t,v as a,g as s,t as n,z as o,B as i,D as r,F as l,m as d,J as m,l as c,r as u,b as v,h as p,k as y,o as h}from"./vendor.CgTKjNNK.js";import{_ as g,A as f,S as k,a as b,u as _,d as C}from"./index.DJpaKxkf.js";import{u as w}from"./useComments.Bp6N9YRo.js";const D={class:"event-detail"},x={class:"md3-main-content"},S={key:0,class:"loading-container"},E={key:1,class:"event-content"},M={key:0,class:"event-hero"},j=["src","alt"],A={class:"event-overlay dinor-gradient-primary"},F={class:"event-badges"},I={key:0,class:"md3-chip event-location"},L={key:1,class:"md3-chip event-category"},$={class:"event-info"},T={class:"event-stats"},V={key:0,class:"stat-item"},H={class:"md3-body-medium"},R={key:1,class:"stat-item"},q={class:"md3-body-medium"},z={key:2,class:"stat-item"},B={class:"md3-body-medium"},P={class:"stat-item"},U={class:"md3-body-medium"},N={class:"stat-item"},Y={class:"md3-body-medium"},G={class:"event-details"},J={class:"detail-item"},O={class:"md3-body-medium"},K={key:0},Q={key:1},W={key:0},X={key:0,class:"detail-item"},Z={class:"md3-body-medium"},ee={key:0,class:"event-description"},te=["innerHTML"],ae={key:1,class:"event-registration"},se={key:0,class:"registration-info"},ne={class:"md3-body-small dinor-text-gray"},oe={class:"comments-section"},ie={class:"md3-title-medium dinor-text-primary"},re={class:"add-comment-form"},le={key:0,class:"auth-prompt"},de={key:1},me={class:"authenticated-user"},ce={class:"user-info"},ue=["disabled"],ve={key:0,class:"comments-list"},pe={class:"comment-header"},ye={class:"comment-meta"},he={class:"comment-author md3-body-medium"},ge={class:"comment-date md3-body-small dinor-text-gray"},fe={key:0,class:"comment-actions"},ke=["onClick"],be={class:"comment-content md3-body-medium"},_e={key:1,class:"empty-comments"},Ce={key:2,class:"error-state"},we={class:"error-actions"};const De=g({name:"EventDetail",emits:["update-header"],components:{ShareModal:k,AuthModal:f},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=y(),s=b(),n=_(),{showShareModal:o,updateOpenGraphTags:i}=C(),{comments:r,loadComments:l,canDeleteComment:d,deleteComment:m,setContext:c,addComment:h}=w(),g=u(null),f=u(!0),k=u(!1),D=u(!1),x=u(""),S=u(!1),E=v(()=>g.value?{title:g.value.title,text:`Ne manquez pas cet événement : ${g.value.title}`,url:window.location.href,image:g.value.image,type:"event",id:g.value.id}:{}),M=async()=>{try{const t=await s.get("/likes/check",{type:"event",id:e.id});k.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la vérification du like:",t)}},j=async()=>{try{const t=await s.get("/favorites/check",{type:"event",id:e.id});D.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la vérification du favori:",t)}};return p(()=>{(async()=>{try{const a=await s.get(`/events/${e.id}`);a.success&&(g.value=a.data,c("Event",e.id),await l(),await M(),await j(),i(E.value),t("update-header",{title:g.value.title||"Événement",showShare:!0,showFavorite:!0,favoriteType:"event",favoriteItemId:parseInt(e.id),isContentFavorited:D.value,backPath:"/events"}))}catch(a){console.error("Erreur lors du chargement de l'événement:",a)}finally{f.value=!1}})()}),{event:g,comments:r,loading:f,userLiked:k,userFavorited:D,newComment:x,toggleLike:async()=>{try{const a=await s.post("/likes/toggle",{likeable_type:"event",likeable_id:e.id});a.success&&(k.value=!k.value,g.value&&(g.value.likes_count=a.data.total_likes),t("update-header",{isLiked:k.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await s.post("/favorites/toggle",{favoritable_type:"event",favoritable_id:e.id});a.success&&(D.value=!D.value,g.value&&(g.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:D.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(x.value.trim())if(n.isAuthenticated)try{console.log("📝 [Comments] Envoi du commentaire pour Event:",e.id),await h("Event",e.id,x.value),console.log("✅ [Comments] Commentaire ajouté avec succès"),x.value=""}catch(t){console.error("❌ [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connecté"))&&(S.value=!0)}else S.value=!0},canDeleteComment:d,deleteComment:m,goBack:()=>{a.push("/events")},goHome:()=>{a.push("/")},formatEventDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}):"",formatEventDateDetailed:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",formatTime:e=>{if(!e)return"";if(e.match(/^\d{2}:\d{2}$/))return e;try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return e}},formatCommentDate:e=>{if(!e)return"";const t=new Date,a=new Date(e),s=t-a,n=Math.floor(s/864e5),o=Math.floor(s/36e5),i=Math.floor(s/6e4);return i<1?"À l'instant":i<60?`Il y a ${i} min`:o<24?`Il y a ${o} h`:n<7?`Il y a ${n} jour${n>1?"s":""}`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:a.getFullYear()!==t.getFullYear()?"numeric":void 0})},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR"):"",handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",showShareModal:o,shareData:E,authStore:n,showAuthModal:S}}},[["render",function(u,v,p,y,g,f){const k=c("ShareModal"),b=c("AuthModal");return h(),e("div",D,[t("main",x,[y.loading?(h(),e("div",S,v[9]||(v[9]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'événement...",-1)]))):y.event?(h(),e("div",E,[y.event.featured_image_url?(h(),e("div",M,[t("img",{src:y.event.featured_image_url||"/images/default-recipe.jpg",alt:y.event.title,class:"event-hero-image",onError:v[0]||(v[0]=(...e)=>y.handleImageError&&y.handleImageError(...e))},null,40,j),t("div",A,[t("div",F,[y.event.location?(h(),e("div",I,[v[10]||(v[10]=t("span",{class:"material-symbols-outlined"},"location_on",-1)),v[11]||(v[11]=t("span",{class:"emoji-fallback"},"📍",-1)),t("span",null,n(y.event.location),1)])):s("",!0),y.event.category?(h(),e("div",L,[v[12]||(v[12]=t("span",{class:"material-symbols-outlined"},"tag",-1)),v[13]||(v[13]=t("span",{class:"emoji-fallback"},"🏷️",-1)),t("span",null,n(y.event.category.name),1)])):s("",!0)])])])):s("",!0),t("div",$,[t("div",T,[y.event.start_date?(h(),e("div",V,[v[14]||(v[14]=t("i",{class:"material-icons dinor-text-secondary"},"event",-1)),t("span",H,n(y.formatEventDate(y.event.start_date)),1)])):s("",!0),y.event.start_time?(h(),e("div",R,[v[15]||(v[15]=t("i",{class:"material-icons dinor-text-secondary"},"schedule",-1)),t("span",q,n(y.formatTime(y.event.start_time)),1)])):s("",!0),y.event.location?(h(),e("div",z,[v[16]||(v[16]=t("i",{class:"material-icons dinor-text-secondary"},"place",-1)),t("span",B,n(y.event.location),1)])):s("",!0),t("div",P,[v[17]||(v[17]=t("i",{class:"material-icons dinor-text-secondary"},"favorite",-1)),t("span",U,n(y.event.likes_count||0),1)]),t("div",N,[v[18]||(v[18]=t("i",{class:"material-icons dinor-text-secondary"},"comment",-1)),t("span",Y,n(y.event.comments_count||0),1)])]),t("div",G,[t("div",J,[v[19]||(v[19]=t("h3",{class:"md3-title-small dinor-text-primary"},"Date et Heure",-1)),t("p",O,[o(n(y.formatEventDateDetailed(y.event.start_date))+" ",1),y.event.start_time?(h(),e("span",K," à "+n(y.formatTime(y.event.start_time)),1)):s("",!0),y.event.end_date&&y.event.end_date!==y.event.start_date?(h(),e("span",Q,[o(" - "+n(y.formatEventDateDetailed(y.event.end_date))+" ",1),y.event.end_time?(h(),e("span",W," à "+n(y.formatTime(y.event.end_time)),1)):s("",!0)])):s("",!0)])]),y.event.location?(h(),e("div",X,[v[20]||(v[20]=t("h3",{class:"md3-title-small dinor-text-primary"},"Lieu",-1)),t("p",Z,n(y.event.location),1)])):s("",!0)]),y.event.content?(h(),e("div",ee,[v[21]||(v[21]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:y.formatContent(y.event.content)},null,8,te)])):s("",!0),y.event.registration_required?(h(),e("div",ae,[v[22]||(v[22]=t("h3",{class:"md3-title-small dinor-text-primary"},"Inscription",-1)),v[23]||(v[23]=t("p",{class:"md3-body-medium"},[t("span",{class:"material-symbols-outlined dinor-text-secondary"},"info"),t("span",{class:"emoji-fallback dinor-text-secondary"},"ℹ️"),o(" Inscription requise pour cet événement ")],-1)),y.event.max_attendees?(h(),e("div",se,[t("p",ne," Places limitées: "+n(y.event.max_attendees)+" personnes maximum ",1)])):s("",!0)])):s("",!0),t("div",oe,[t("h2",ie,"Commentaires ("+n(y.comments.length)+")",1),t("div",re,[y.authStore.isAuthenticated?(h(),e("div",de,[t("div",me,[t("span",ce,"Connecté en tant que "+n(y.authStore.userName),1),t("button",{onClick:v[2]||(v[2]=e=>y.authStore.logout()),class:"btn-logout"},"Déconnexion")]),i(t("textarea",{"onUpdate:modelValue":v[3]||(v[3]=e=>y.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[r,y.newComment]]),t("button",{onClick:v[4]||(v[4]=(...e)=>y.addComment&&y.addComment(...e)),class:"btn-primary",disabled:!y.newComment.trim()}," Publier ",8,ue)])):(h(),e("div",le,[v[24]||(v[24]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:v[1]||(v[1]=e=>y.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),y.comments.length?(h(),e("div",ve,[(h(!0),e(l,null,d(y.comments,a=>(h(),e("div",{key:a.id,class:"comment-item"},[t("div",pe,[t("div",ye,[t("span",he,n(a.author_name),1),t("span",ge,n(y.formatDate(a.created_at)),1)]),y.canDeleteComment(a)?(h(),e("div",fe,[t("button",{onClick:e=>y.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},v[25]||(v[25]=[t("i",{class:"material-icons"},"delete",-1)]),8,ke)])):s("",!0)]),t("p",be,n(a.content),1)]))),128))])):(h(),e("div",_e,v[26]||(v[26]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(h(),e("div",Ce,[v[27]||(v[27]=m('<div class="error-icon" data-v-4d927e76><span class="material-symbols-outlined" data-v-4d927e76>error_outline</span><span class="emoji-fallback" data-v-4d927e76>⚠️</span></div><h2 class="md3-title-large" data-v-4d927e76>Événement introuvable</h2><p class="md3-body-large dinor-text-gray" data-v-4d927e76>L&#39;événement demandé n&#39;existe pas ou a été supprimé.</p>',3)),t("div",we,[t("button",{onClick:v[5]||(v[5]=(...e)=>y.goBack&&y.goBack(...e)),class:"btn-secondary"},"Retour aux événements"),t("button",{onClick:v[6]||(v[6]=(...e)=>y.goHome&&y.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(k,{modelValue:y.showShareModal,"onUpdate:modelValue":v[7]||(v[7]=e=>y.showShareModal=e),"share-data":y.shareData},null,8,["modelValue","share-data"]),a(b,{modelValue:y.showAuthModal,"onUpdate:modelValue":v[8]||(v[8]=e=>y.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-4d927e76"]]);export{De as default};
