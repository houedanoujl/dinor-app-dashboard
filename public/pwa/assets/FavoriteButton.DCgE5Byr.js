import{r as e,b as t,w as a,g as i,h as o,j as r,z as n,k as s,l,t as u,q as d,o as c}from"./vendor.Bvrl98ec.js";import{_ as v,D as f,d as g,b as m}from"./index.dD73OAp8.js";const p={name:"FavoriteButton",components:{DinorIcon:f},props:{type:{type:String,required:!0,validator:e=>["recipe","tip","event","dinor_tv"].includes(e)},itemId:{type:[Number,String],required:!0},initialFavorited:{type:Boolean,default:!1},initialCount:{type:Number,default:0},showCount:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},variant:{type:String,default:"default",validator:e=>["default","compact","minimal"].includes(e)}},emits:["update:favorited","update:count","auth-required"],setup(o,{emit:r}){const n=g(),s=e(!1),l=e(o.initialFavorited),u=e(o.initialCount),d=t(()=>n.isAuthenticated),c=async()=>{if(n.isAuthenticated)try{const e=await m.checkFavorite(o.type,o.itemId);e.success&&(l.value=e.is_favorited)}catch(e){console.warn("Erreur lors de la vérification du statut favori:",e)}else l.value=!1};return a(()=>n.isAuthenticated,e=>{e?c():l.value=!1}),a(()=>o.initialFavorited,e=>{l.value=e}),a(()=>o.initialCount,e=>{u.value=e}),i(()=>{n.isAuthenticated&&c()}),{loading:s,isFavorited:l,favoritesCount:u,canInteract:d,formatCount:e=>e<1e3?e.toString():e<1e6?`${Math.floor(e/1e3)}k`:`${Math.floor(e/1e6)}M`,handleToggle:async()=>{if(console.log("🌟 [FavoriteButton] Clic détecté sur bouton favori",{type:o.type,itemId:o.itemId,isAuthenticated:n.isAuthenticated}),!n.isAuthenticated)return console.log("🔒 [FavoriteButton] Utilisateur non connecté"),void r("auth-required");if(s.value)return void console.log("⏳ [FavoriteButton] Déjà en cours de chargement");s.value=!0;const e=l.value,t=u.value;l.value=!l.value,u.value+=l.value?1:-1;try{const e=await m.toggleFavorite(o.type,o.itemId);if(!e.success)throw new Error(e.message||"Erreur lors de la mise à jour des favoris");l.value=e.is_favorited,e.data&&"number"==typeof e.data.total_favorites&&(u.value=e.data.total_favorites),r("update:favorited",l.value),r("update:count",u.value),console.log("🌟 [Favorites] Toggle réussi:",{type:o.type,id:o.itemId,favorited:l.value,count:u.value})}catch(a){console.error("❌ [Favorites] Erreur toggle:",a),l.value=e,u.value=t,a.message.includes("401")&&r("auth-required")}finally{s.value=!1}}}}},h=["disabled","title"],y={key:0,class:"loading-spinner"},F={key:2,class:"favorite-count"};const b=v(p,[["render",function(e,t,a,i,v,f){const g=l("DinorIcon");return c(),o("button",{onClick:t[1]||(t[1]=(...e)=>i.handleToggle&&i.handleToggle(...e)),class:d(["favorite-button",{"is-favorited":i.isFavorited,"is-loading":i.loading,"is-disabled":!i.canInteract}]),disabled:i.loading||!i.canInteract,title:i.isFavorited?"Retirer des favoris":"Ajouter aux favoris"},[i.loading?(c(),o("div",y)):(c(),o("div",{key:1,class:"heart-container",onClick:t[0]||(t[0]=n((...e)=>i.handleToggle&&i.handleToggle(...e),["stop"]))},[s(g,{name:i.isFavorited?"favorite":"favorite_border",size:20,class:"heart-icon"},null,8,["name"])])),a.showCount&&i.favoritesCount>0?(c(),o("span",F,u(i.formatCount(i.favoritesCount)),1)):r("",!0)],10,h)}],["__scopeId","data-v-12b3bf4e"]]);export{b as F};
