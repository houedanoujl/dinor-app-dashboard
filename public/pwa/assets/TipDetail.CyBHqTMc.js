import{e,f as t,v as a,g as s,i,l as o,t as r,F as l,m as n,B as c,D as d,r as m,b as u,h as p,k as v,u as g,o as y}from"./vendor.CgTKjNNK.js";import{_ as h,A as f,S as b,a as k,u as C,d as w}from"./index.Dqjl_hq9.js";import{u as _}from"./useComments.BA7jWyX8.js";import{B as x}from"./Badge.BiEFAtVp.js";const A={class:"tip-detail"},D={class:"md3-main-content"},S={key:0,class:"loading-container"},M={key:1,class:"tip-content"},E={key:0,class:"tip-hero"},j=["src","alt"],L={class:"tip-overlay dinor-gradient-primary"},T={class:"tip-badges"},$={class:"tip-info"},B={class:"tip-stats"},I={class:"stat-item"},F={class:"md3-body-medium"},V={class:"stat-item"},z={class:"md3-body-medium"},H={class:"stat-item"},U={class:"md3-body-medium"},R={key:0,class:"tip-summary-video"},q={class:"video-container"},P=["src","title"],G={class:"tip-content-text"},N=["innerHTML"],O={key:1,class:"tip-tags"},J={class:"tags-container"},K={class:"comments-section"},Q={class:"md3-title-medium dinor-text-primary"},W={class:"add-comment-form"},X={key:0,class:"auth-prompt"},Y={key:1},Z={class:"authenticated-user"},ee={class:"user-info"},te=["disabled"],ae={key:0,class:"comments-list"},se={class:"comment-header"},ie={class:"comment-meta"},oe={class:"comment-author md3-body-medium"},re={class:"comment-date md3-body-small dinor-text-gray"},le={key:0,class:"comment-actions"},ne=["onClick"],ce={class:"comment-content md3-body-medium"},de={key:1,class:"empty-comments"},me={key:2,class:"error-state"},ue={class:"error-actions"};const pe=h({name:"TipDetail",emits:["update-header"],components:{Badge:x,ShareModal:b,AuthModal:f},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=v();g();const s=k(),i=C(),{showShareModal:o,updateOpenGraphTags:r}=w(),{comments:l,loadComments:n,canDeleteComment:c,deleteComment:d,setContext:y,addComment:h}=_(),f=m(null),b=m(!0),x=m(!1),A=m(!1),D=m(""),S=m(!1),M=u(()=>f.value?{title:f.value.title,text:`Découvrez cette astuce pratique : ${f.value.title}`,url:window.location.href,image:f.value.image,type:"tip",id:f.value.id}:{}),E=async()=>{try{const t=await s.get("/likes/check",{type:"tip",id:e.id});x.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la vérification du like:",t)}},j=async()=>{try{const t=await s.get("/favorites/check",{type:"tip",id:e.id});A.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la vérification du favori:",t)}};return p(()=>{(async()=>{try{const a=await s.get(`/tips/${e.id}`);a.success&&(f.value=a.data,y("Tip",e.id),await n(),await E(),await j(),r(M.value),t("update-header",{title:f.value.title||"Astuce",showShare:!0,showFavorite:!0,favoriteType:"tip",favoriteItemId:parseInt(e.id),isContentFavorited:A.value,backPath:"/tips"}))}catch(a){console.error("Erreur lors du chargement de l'astuce:",a)}finally{b.value=!1}})()}),{tip:f,comments:l,loading:b,userLiked:x,userFavorited:A,newComment:D,toggleLike:async()=>{try{const a=await s.post("/likes/toggle",{likeable_type:"tip",likeable_id:e.id});a.success&&(x.value=!x.value,f.value&&(f.value.likes_count=a.data.total_likes),t("update-header",{isLiked:x.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await s.post("/favorites/toggle",{favoritable_type:"tip",favoritable_id:e.id});a.success&&(A.value=!A.value,f.value&&(f.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:A.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(D.value.trim())if(i.isAuthenticated)try{console.log("📝 [Comments] Envoi du commentaire pour Tip:",e.id),await h("Tip",e.id,D.value),console.log("✅ [Comments] Commentaire ajouté avec succès"),D.value=""}catch(t){console.error("❌ [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connecté"))&&(S.value=!0)}else S.value=!0},canDeleteComment:c,deleteComment:d,goBack:()=>{a.push("/tips")},goHome:()=>{a.push("/")},getDifficultyLabel:e=>({beginner:"Débutant",intermediate:"Intermédiaire",advanced:"Avancé"}[e]||"Débutant"),formatDate:e=>new Date(e).toLocaleDateString("fr-FR"),handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",getEmbedUrl:e=>{if(!e||!e.trim())return"";const t=e.trim(),a=t.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);if(a)return`https://www.youtube.com/embed/${a[1]}?rel=0&modestbranding=1`;const s=t.match(/vimeo\.com\/(\d+)/);return s?`https://player.vimeo.com/video/${s[1]}`:t},showShareModal:o,shareData:M,authStore:i,showAuthModal:S}}},[["render",function(m,u,p,v,g,h){const f=o("Badge"),b=o("ShareModal"),k=o("AuthModal");return y(),e("div",A,[t("main",D,[v.loading?(y(),e("div",S,u[9]||(u[9]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'astuce...",-1)]))):v.tip?(y(),e("div",M,[v.tip.image_url?(y(),e("div",E,[t("img",{src:v.tip.image_url||"/images/default-recipe.jpg",alt:v.tip.title,class:"tip-hero-image",onError:u[0]||(u[0]=(...e)=>v.handleImageError&&v.handleImageError(...e))},null,40,j),t("div",L,[t("div",T,[v.tip.difficulty_level?(y(),i(f,{key:0,text:v.getDifficultyLabel(v.tip.difficulty_level),icon:"lightbulb",variant:"secondary",size:"medium"},null,8,["text"])):s("",!0),v.tip.category?(y(),i(f,{key:1,text:v.tip.category.name,icon:"tag",variant:"neutral",size:"medium"},null,8,["text"])):s("",!0)])])])):s("",!0),t("div",$,[t("div",B,[t("div",I,[u[10]||(u[10]=t("i",{class:"material-icons dinor-text-secondary"},"schedule",-1)),t("span",F,r(v.tip.estimated_time)+"min",1)]),t("div",V,[u[11]||(u[11]=t("i",{class:"material-icons dinor-text-secondary"},"favorite",-1)),t("span",z,r(v.tip.likes_count||0),1)]),t("div",H,[u[12]||(u[12]=t("i",{class:"material-icons dinor-text-secondary"},"comment",-1)),t("span",U,r(v.tip.comments_count||0),1)])]),v.tip.summary_video_url&&v.tip.summary_video_url.trim()?(y(),e("div",R,[u[13]||(u[13]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Résumé en vidéo",-1)),t("div",q,[t("iframe",{src:v.getEmbedUrl(v.tip.summary_video_url),title:`Résumé vidéo : ${v.tip.title}`,frameborder:"0",allowfullscreen:"",class:"summary-video-iframe"},null,8,P)])])):s("",!0),t("div",G,[u[14]||(u[14]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Astuce",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:v.formatContent(v.tip.content)},null,8,N)]),v.tip.tags&&v.tip.tags.length?(y(),e("div",O,[u[15]||(u[15]=t("h3",{class:"md3-title-small dinor-text-primary"},"Tags",-1)),t("div",J,[(y(!0),e(l,null,n(v.tip.tags,t=>(y(),e("span",{key:t,class:"md3-chip"},r(t),1))),128))])])):s("",!0),t("div",K,[t("h2",Q,"Commentaires ("+r(v.comments.length)+")",1),t("div",W,[v.authStore.isAuthenticated?(y(),e("div",Y,[t("div",Z,[t("span",ee,"Connecté en tant que "+r(v.authStore.userName),1),t("button",{onClick:u[2]||(u[2]=e=>v.authStore.logout()),class:"btn-logout"},"Déconnexion")]),c(t("textarea",{"onUpdate:modelValue":u[3]||(u[3]=e=>v.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[d,v.newComment]]),t("button",{onClick:u[4]||(u[4]=(...e)=>v.addComment&&v.addComment(...e)),class:"btn-primary",disabled:!v.newComment.trim()}," Publier ",8,te)])):(y(),e("div",X,[u[16]||(u[16]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:u[1]||(u[1]=e=>v.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),v.comments.length?(y(),e("div",ae,[(y(!0),e(l,null,n(v.comments,a=>(y(),e("div",{key:a.id,class:"comment-item"},[t("div",se,[t("div",ie,[t("span",oe,r(a.author_name),1),t("span",re,r(v.formatDate(a.created_at)),1)]),v.canDeleteComment(a)?(y(),e("div",le,[t("button",{onClick:e=>v.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},u[17]||(u[17]=[t("i",{class:"material-icons"},"delete",-1)]),8,ne)])):s("",!0)]),t("p",ce,r(a.content),1)]))),128))])):(y(),e("div",de,u[18]||(u[18]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(y(),e("div",me,[u[19]||(u[19]=t("div",{class:"error-icon"},[t("i",{class:"material-icons"},"error_outline")],-1)),u[20]||(u[20]=t("h2",{class:"md3-title-large"},"Astuce introuvable",-1)),u[21]||(u[21]=t("p",{class:"md3-body-large dinor-text-gray"},"L'astuce demandée n'existe pas ou a été supprimée.",-1)),t("div",ue,[t("button",{onClick:u[5]||(u[5]=(...e)=>v.goBack&&v.goBack(...e)),class:"btn-secondary"},"Retour aux astuces"),t("button",{onClick:u[6]||(u[6]=(...e)=>v.goHome&&v.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(b,{modelValue:v.showShareModal,"onUpdate:modelValue":u[7]||(u[7]=e=>v.showShareModal=e),"share-data":v.shareData},null,8,["modelValue","share-data"]),a(k,{modelValue:v.showAuthModal,"onUpdate:modelValue":u[8]||(u[8]=e=>v.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-f70f2eb9"]]);export{pe as default};
