import{r as e,b as t,w as i,g as a,h as o,j as n,z as l,k as s,i as u,l as d,t as r,q as c,o as v}from"./vendor.Bvrl98ec.js";import{_ as k,D as p,d as m,b as f}from"./index.dD73OAp8.js";const g={name:"LikeButton",components:{DinorIcon:p},props:{type:{type:String,required:!0,validator:e=>["recipe","tip","event","dinor_tv"].includes(e)},itemId:{type:[Number,String],required:!0},initialLiked:{type:Boolean,default:!1},initialCount:{type:Number,default:0},showCount:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},variant:{type:String,default:"default",validator:e=>["default","compact","minimal"].includes(e)}},emits:["update:liked","update:count","auth-required"],setup(o,{emit:n}){const l=m(),s=e(!1),u=e(o.initialLiked),d=e(o.initialCount),r=t(()=>l.isAuthenticated),c=async()=>{if(l.isAuthenticated&&o.itemId)try{const e=await f.request(`/likes/check?type=${o.type}&id=${o.itemId}`);e.success&&(u.value=e.is_liked,"number"==typeof e.likes_count&&(d.value=e.likes_count))}catch(e){console.warn("Erreur lors de la vérification du statut like:",e)}else u.value=!1};i(()=>l.isAuthenticated,e=>{e?c():u.value=!1}),i(()=>o.initialLiked,e=>{u.value=e}),i(()=>o.initialCount,e=>{d.value=e});const v=e=>{const{type:t,id:i,liked:a,count:n}=e.detail;t===o.type&&i==o.itemId&&(u.value=a,d.value=n)};return a(()=>{l.isAuthenticated&&c(),window.addEventListener("like-updated",v)}),{loading:s,isLiked:u,likesCount:d,canInteract:r,formatCount:e=>e<1e3?e.toString():e<1e6?`${Math.floor(e/1e3)}k`:`${Math.floor(e/1e6)}M`,handleToggle:async()=>{if(console.log("👍 [LikeButton] Clic détecté sur bouton like",{type:o.type,itemId:o.itemId,isAuthenticated:l.isAuthenticated}),!l.isAuthenticated)return console.log("🔒 [LikeButton] Utilisateur non connecté"),void n("auth-required");if(s.value)return void console.log("⏳ [LikeButton] Déjà en cours de chargement");s.value=!0;const e=u.value,t=d.value;u.value=!u.value,d.value+=u.value?1:-1;try{const e=await f.request("/likes/toggle",{method:"POST",body:{type:o.type,id:o.itemId}});if(!e.success)throw new Error(e.message||"Erreur lors de la mise à jour des likes");u.value="liked"===e.action,"number"==typeof e.likes_count&&(d.value=e.likes_count),n("update:liked",u.value),n("update:count",d.value),window.dispatchEvent(new CustomEvent("like-updated",{detail:{type:o.type,id:o.itemId,liked:u.value,count:d.value,favorited:"favorited"===e.favorite_action,favoritesCount:e.favorites_count||0}})),console.log("👍 [Likes] Toggle réussi:",{type:o.type,id:o.itemId,liked:u.value,count:d.value,favorited:"favorited"===e.favorite_action,favoritesCount:e.favorites_count})}catch(i){console.error("❌ [Likes] Erreur toggle:",i),u.value=e,d.value=t,401!==i.status&&"AUTH_REQUIRED"!==i.type||n("auth-required",{context:"aimer ce contenu",error:i})}finally{s.value=!1}}}}},y=["disabled","title"],h={key:0,class:"loading-spinner"},C={class:"emoji-fallback"},I={key:2,class:"like-count"};const L=k(g,[["render",function(e,t,i,a,k,p){const m=d("DinorIcon");return v(),o("button",{onClick:t[1]||(t[1]=(...e)=>a.handleToggle&&a.handleToggle(...e)),class:c(["like-button",{"is-liked":a.isLiked,"is-loading":a.loading,"is-disabled":!a.canInteract}]),disabled:a.loading||!a.canInteract,title:a.isLiked?"Retirer le like":"Aimer ce contenu"},[a.loading?(v(),o("div",h)):(v(),o("div",{key:1,class:"heart-container",onClick:t[0]||(t[0]=l((...e)=>a.handleToggle&&a.handleToggle(...e),["stop"]))},[s(m,{name:a.isLiked?"favorite":"favorite_border",size:20,class:"heart-icon"},null,8,["name"]),u("span",C,r(a.isLiked?"❤️":"🤍"),1)])),i.showCount&&a.likesCount>0?(v(),o("span",I,r(a.formatCount(a.likesCount)),1)):n("",!0)],10,y)}],["__scopeId","data-v-c2707a45"]]);export{L};
