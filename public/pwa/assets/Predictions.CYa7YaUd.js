import{e as a,f as e,v as t,g as s,J as r,t as n,B as i,D as c,p as o,z as l,l as d,F as u,m,n as p,y as v,r as h,b as y,w as g,h as _,o as b}from"./vendor.CgTKjNNK.js";import{_ as f,A as w,a as k,u as M}from"./index.CcLKvRIv.js";const S={class:"predictions"},P={class:"md3-main-content"},T={key:0,class:"loading-container"},A={key:1,class:"predictions-content"},x={key:0,class:"current-match-section"},D={class:"match-card featured"},E={class:"match-header"},C={class:"match-teams"},I={class:"team home-team"},V=["src","alt"],j={key:1,class:"team-logo-placeholder"},z={class:"team-name"},F={class:"match-vs"},q={class:"match-date"},L={class:"team away-team"},R=["src","alt"],$={key:1,class:"team-logo-placeholder"},B={class:"team-name"},U={key:0,class:"prediction-status can-predict"},G={key:1,class:"prediction-status closed"},O={key:0,class:"prediction-form"},W={class:"score-inputs"},J={class:"score-input"},N={class:"md3-body-small"},X={class:"score-input"},H={class:"md3-body-small"},K=["disabled"],Q={key:0},Y={key:1},Z={key:1,class:"auth-required"},aa={key:2,class:"user-prediction"},ea={class:"prediction-display"},ta={class:"prediction-score"},sa={class:"prediction-winner"},ra={class:"tournaments-section"},na={class:"section-header"},ia={key:0,class:"tournaments-loading"},ca={key:1,class:"tournaments-grid"},oa=["onClick"],la={class:"tournament-header"},da={class:"tournament-name"},ua={class:"tournament-description"},ma={class:"tournament-info"},pa={class:"info-item"},va={key:0,class:"info-item"},ha={class:"info-item"},ya={class:"tournament-actions"},ga=["onClick","disabled"],_a={key:0},ba={key:1},fa=["onClick"],wa={key:2,class:"tournament-closed"},ka={key:2,class:"no-tournaments"},Ma={class:"quick-actions"};const Sa=f({name:"Predictions",emits:["update-header"],components:{AuthModal:w},setup(a,{emit:e}){const t=k(),s=M(),r=h(null),n=h(null),i=h(!0),c=h(!1),o=h(!1),l=h([]),d=h(!0),u=h(null),m=h({homeScore:0,awayScore:0}),p=y(()=>null!==m.value.homeScore&&null!==m.value.awayScore&&m.value.homeScore>=0&&m.value.awayScore>=0),v=async()=>{if(s.isAuthenticated&&r.value)try{const a=await t.get(`/v1/predictions/match/${r.value.id}`);a.success&&a.data&&(n.value=a.data,m.value={homeScore:a.data.predicted_home_score,awayScore:a.data.predicted_away_score})}catch(a){console.error("Erreur lors du chargement de la prédiction:",a)}};g(()=>s.isAuthenticated,a=>{a?v():n.value=null});return _(()=>{(async()=>{try{const a=await t.get("/matches/current/match");a.success&&a.data&&(r.value=a.data,await v())}catch(a){console.error("Erreur lors du chargement du match:",a)}finally{i.value=!1}})(),(async()=>{try{const a=await t.get("/tournaments/featured");a.success&&(l.value=a.data||[])}catch(a){console.error("Erreur lors du chargement des tournois:",a)}finally{d.value=!1}})(),e("update-header",{title:"Pronostics",showBack:!1})}),{currentMatch:r,userPrediction:n,loading:i,submitting:c,showAuthModal:o,prediction:m,canSubmitPrediction:p,authStore:s,featuredTournaments:l,loadingTournaments:d,registering:u,submitPrediction:async()=>{var a;if(p.value&&!c.value){c.value=!0;try{const a={football_match_id:r.value.id,predicted_home_score:m.value.homeScore,predicted_away_score:m.value.awayScore};let e;e=n.value?await t.put(`/v1/predictions/${n.value.id}`,a):await t.post("/v1/predictions",a),e.success&&(n.value=e.data,console.log("Pronostic enregistré avec succès!"))}catch(e){console.error("Erreur lors de l'envoi du pronostic:",e),(null==(a=e.message)?void 0:a.includes("401"))&&(o.value=!0)}finally{c.value=!1}}},registerToTournament:async a=>{var e;if(s.isAuthenticated){u.value=a.id;try{(await t.post(`/tournaments/${a.id}/register`,{})).success&&(a.user_is_participant=!0,a.can_register=!1,a.participants_count+=1,console.log("Inscription réussie au tournoi!"))}catch(r){console.error("Erreur lors de l'inscription:",r),(null==(e=r.message)?void 0:e.includes("401"))&&(o.value=!0)}finally{u.value=null}}else o.value=!0},openTournament:a=>{console.log("Ouverture du tournoi:",a.name)},viewTournamentLeaderboard:a=>{console.log("Classement du tournoi:",a.name)},formatMatchDate:a=>new Date(a).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),formatTournamentDate:a=>{const e=new Date(a),t=new Date,s=Math.ceil((e-t)/864e5);return s<0?"Terminé":0===s?"Aujourd'hui":1===s?"Demain":s<7?`Dans ${s} jours`:e.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},formatPrize:(a,e)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:e||"XOF",minimumFractionDigits:0}).format(a),getPredictedWinnerText:a=>{var e,t,s,n;switch(a){case"home":return(null==(t=null==(e=r.value)?void 0:e.home_team)?void 0:t.name)||"Domicile";case"away":return(null==(n=null==(s=r.value)?void 0:s.away_team)?void 0:n.name)||"Extérieur";case"draw":return"Match nul";default:return"Inconnu"}},handleImageError:a=>{a.target.style.display="none"},handleAuthenticated:()=>{o.value=!1,v()}}}},[["render",function(h,y,g,_,f,w){const k=d("router-link"),M=d("AuthModal");return b(),a("div",S,[e("main",P,[_.loading?(b(),a("div",T,y[7]||(y[7]=[e("div",{class:"md3-circular-progress"},null,-1),e("p",{class:"md3-body-large"},"Chargement des matchs...",-1)]))):(b(),a("div",A,[y[29]||(y[29]=e("div",{class:"predictions-header"},[e("h1",{class:"md3-title-large dinor-text-primary"},"Pronostics"),e("p",{class:"md3-body-medium dinor-text-gray"},"Pariez sur vos matchs favoris et gagnez des points!")],-1)),_.currentMatch?(b(),a("div",x,[y[17]||(y[17]=e("h2",{class:"md3-title-medium dinor-text-primary"},"Match en cours",-1)),e("div",D,[e("div",E,[e("div",C,[e("div",I,[_.currentMatch.home_team.logo_url?(b(),a("img",{key:0,src:_.currentMatch.home_team.logo_url,alt:_.currentMatch.home_team.name,class:"team-logo",onError:y[0]||(y[0]=(...a)=>_.handleImageError&&_.handleImageError(...a))},null,40,V)):(b(),a("div",j,y[8]||(y[8]=[e("i",{class:"material-icons"},"sports_soccer",-1)]))),e("span",z,n(_.currentMatch.home_team.name),1)]),e("div",F,[y[9]||(y[9]=e("span",{class:"vs-text"},"VS",-1)),e("div",q,n(_.formatMatchDate(_.currentMatch.match_date)),1)]),e("div",L,[_.currentMatch.away_team.logo_url?(b(),a("img",{key:0,src:_.currentMatch.away_team.logo_url,alt:_.currentMatch.away_team.name,class:"team-logo",onError:y[1]||(y[1]=(...a)=>_.handleImageError&&_.handleImageError(...a))},null,40,R)):(b(),a("div",$,y[10]||(y[10]=[e("i",{class:"material-icons"},"sports_soccer",-1)]))),e("span",B,n(_.currentMatch.away_team.name),1)])]),_.currentMatch.can_predict?(b(),a("div",U,y[11]||(y[11]=[e("i",{class:"material-icons"},"check_circle",-1),e("span",null,"Prédictions ouvertes",-1)]))):(b(),a("div",G,y[12]||(y[12]=[e("i",{class:"material-icons"},"cancel",-1),e("span",null,"Prédictions fermées",-1)])))]),_.currentMatch.can_predict&&_.authStore.isAuthenticated?(b(),a("div",O,[y[14]||(y[14]=e("h3",{class:"md3-title-small"},"Votre pronostic",-1)),e("div",W,[e("div",J,[e("label",N,n(_.currentMatch.home_team.short_name||_.currentMatch.home_team.name),1),i(e("input",{"onUpdate:modelValue":y[2]||(y[2]=a=>_.prediction.homeScore=a),type:"number",min:"0",max:"20",class:"score-field"},null,512),[[c,_.prediction.homeScore,void 0,{number:!0}]])]),y[13]||(y[13]=e("div",{class:"score-separator"},"-",-1)),e("div",X,[e("label",H,n(_.currentMatch.away_team.short_name||_.currentMatch.away_team.name),1),i(e("input",{"onUpdate:modelValue":y[3]||(y[3]=a=>_.prediction.awayScore=a),type:"number",min:"0",max:"20",class:"score-field"},null,512),[[c,_.prediction.awayScore,void 0,{number:!0}]])])]),e("button",{onClick:y[4]||(y[4]=(...a)=>_.submitPrediction&&_.submitPrediction(...a)),disabled:!_.canSubmitPrediction||_.submitting,class:"btn-primary prediction-submit"},[_.submitting?(b(),a("span",Q,"Envoi...")):(b(),a("span",Y,n(_.userPrediction?"Modifier":"Valider")+" le pronostic",1))],8,K)])):_.currentMatch.can_predict&&!_.authStore.isAuthenticated?(b(),a("div",Z,[y[15]||(y[15]=e("p",{class:"md3-body-medium"},"Connectez-vous pour faire votre pronostic",-1)),e("button",{onClick:y[5]||(y[5]=a=>_.showAuthModal=!0),class:"btn-primary"}," Se connecter ")])):s("",!0),_.userPrediction?(b(),a("div",aa,[y[16]||(y[16]=e("h3",{class:"md3-title-small"},"Votre pronostic actuel",-1)),e("div",ea,[e("span",ta,n(_.userPrediction.predicted_home_score)+" - "+n(_.userPrediction.predicted_away_score),1),e("span",sa," Gagnant prédit: "+n(_.getPredictedWinnerText(_.userPrediction.predicted_winner)),1)])])):s("",!0)])])):s("",!0),e("div",ra,[e("div",na,[y[19]||(y[19]=e("h2",{class:"md3-title-medium dinor-text-primary"},"Tournois en cours",-1)),t(k,{to:"/predictions/tournaments",class:"view-all-link"},{default:o(()=>y[18]||(y[18]=[l(" Voir tout ")])),_:1,__:[18]})]),_.loadingTournaments?(b(),a("div",ia,y[20]||(y[20]=[e("div",{class:"md3-circular-progress"},null,-1),e("p",{class:"md3-body-small"},"Chargement des tournois...",-1)]))):_.featuredTournaments.length>0?(b(),a("div",ca,[(b(!0),a(u,null,m(_.featuredTournaments,t=>(b(),a("div",{key:t.id,class:"tournament-card",onClick:a=>_.openTournament(t)},[e("div",la,[e("h3",da,n(t.name),1),e("span",{class:p(["tournament-status",t.status])},n(t.status_label),3)]),e("p",ua,n(t.description),1),e("div",ma,[e("div",pa,[y[21]||(y[21]=e("i",{class:"material-icons"},"group",-1)),e("span",null,n(t.participants_count)+" participants",1)]),t.prize_pool>0?(b(),a("div",va,[y[22]||(y[22]=e("i",{class:"material-icons"},"emoji_events",-1)),e("span",null,n(_.formatPrize(t.prize_pool,t.currency)),1)])):s("",!0),e("div",ha,[y[23]||(y[23]=e("i",{class:"material-icons"},"schedule",-1)),e("span",null,n(_.formatTournamentDate(t.end_date)),1)])]),e("div",ya,[t.can_register?(b(),a("button",{key:0,onClick:v(a=>_.registerToTournament(t),["stop"]),disabled:_.registering===t.id,class:"btn-primary btn-small"},[_.registering===t.id?(b(),a("span",_a,"Inscription...")):(b(),a("span",ba,"Participer"))],8,ga)):t.user_is_participant?(b(),a("button",{key:1,onClick:v(a=>_.viewTournamentLeaderboard(t),["stop"]),class:"btn-secondary btn-small"}," Mon classement ",8,fa)):(b(),a("span",wa,"Inscriptions fermées"))])],8,oa))),128))])):(b(),a("div",ka,y[24]||(y[24]=[e("i",{class:"material-icons"},"emoji_events",-1),e("p",null,"Aucun tournoi disponible pour le moment",-1)])))]),e("div",Ma,[t(k,{to:"/predictions/tournaments",class:"action-card"},{default:o(()=>y[25]||(y[25]=[e("i",{class:"material-icons"},"emoji_events",-1),e("span",null,"Tous les tournois",-1)])),_:1,__:[25]}),t(k,{to:"/predictions/teams",class:"action-card"},{default:o(()=>y[26]||(y[26]=[e("i",{class:"material-icons"},"groups",-1),e("span",null,"Équipes",-1)])),_:1,__:[26]}),t(k,{to:"/predictions/matches",class:"action-card"},{default:o(()=>y[27]||(y[27]=[e("i",{class:"material-icons"},"sports_soccer",-1),e("span",null,"Matchs",-1)])),_:1,__:[27]}),t(k,{to:"/predictions/leaderboard",class:"action-card"},{default:o(()=>y[28]||(y[28]=[e("i",{class:"material-icons"},"leaderboard",-1),e("span",null,"Classement global",-1)])),_:1,__:[28]})]),y[30]||(y[30]=r('<div class="rules-section" data-v-352512d2><h2 class="md3-title-medium dinor-text-primary" data-v-352512d2>Règles du jeu</h2><div class="rules-grid" data-v-352512d2><div class="rule-item" data-v-352512d2><div class="rule-icon" data-v-352512d2><i class="material-icons" data-v-352512d2>star</i></div><div class="rule-content" data-v-352512d2><h3 class="md3-title-small" data-v-352512d2>Score exact</h3><p class="md3-body-small" data-v-352512d2>3 points pour un score exact</p></div></div><div class="rule-item" data-v-352512d2><div class="rule-icon" data-v-352512d2><i class="material-icons" data-v-352512d2>thumb_up</i></div><div class="rule-content" data-v-352512d2><h3 class="md3-title-small" data-v-352512d2>Bon gagnant</h3><p class="md3-body-small" data-v-352512d2>1 point pour le bon gagnant uniquement</p></div></div><div class="rule-item" data-v-352512d2><div class="rule-icon" data-v-352512d2><i class="material-icons" data-v-352512d2>emoji_events</i></div><div class="rule-content" data-v-352512d2><h3 class="md3-title-small" data-v-352512d2>Score + Gagnant</h3><p class="md3-body-small" data-v-352512d2>3 points au total (même règle)</p></div></div></div></div>',1))]))]),t(M,{modelValue:_.showAuthModal,"onUpdate:modelValue":y[6]||(y[6]=a=>_.showAuthModal=a),onAuthenticated:_.handleAuthenticated},null,8,["modelValue","onAuthenticated"])])}],["__scopeId","data-v-352512d2"]]);export{Sa as default};
