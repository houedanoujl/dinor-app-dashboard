import{h as e,i as t,k as a,j as n,l as o,t as s,z as l,A as r,C as i,F as d,D as c,M as m,r as u,b as v,g as p,p as y,o as h}from"./vendor.h2smxeay.js";import{_ as g,D as f,A as k,S as b,u as C,d as _,e as D}from"./index.BRBqb7Zw.js";import{u as w}from"./useComments.q8Z1xK1C.js";const E={class:"event-detail"},I={class:"md3-main-content"},x={key:0,class:"loading-container"},S={key:1,class:"event-content"},A={key:0,class:"event-hero"},T=["src","alt"],$={class:"event-overlay dinor-gradient-primary"},M={class:"event-badges"},j={key:0,class:"md3-chip event-location"},L={key:1,class:"md3-chip event-category"},R={class:"event-info"},N={class:"event-stats"},V={key:0,class:"stat-item"},F={class:"md3-body-medium"},z={key:1,class:"stat-item"},U={class:"md3-body-medium"},O={key:2,class:"stat-item"},G={class:"md3-body-medium"},H={class:"stat-item"},B={class:"md3-body-medium"},P={class:"stat-item"},q={class:"md3-body-medium"},Y={class:"event-details"},Z={class:"detail-item"},J={class:"md3-body-medium"},K={key:0},Q={key:1},W={key:0},X={key:0,class:"detail-item"},ee={class:"md3-body-medium"},te={class:"calendar-links"},ae={class:"calendar-buttons"},ne={key:0,class:"event-description"},oe=["innerHTML"],se={key:1,class:"event-registration"},le={key:0,class:"registration-info"},re={class:"md3-body-small dinor-text-gray"},ie={class:"comments-section"},de={class:"md3-title-medium dinor-text-primary"},ce={class:"add-comment-form"},me={key:0,class:"auth-prompt"},ue={key:1},ve={class:"authenticated-user"},pe={class:"user-info"},ye=["disabled"],he={key:0,class:"comments-list"},ge={class:"comment-header"},fe={class:"comment-meta"},ke={class:"comment-author md3-body-medium"},be={class:"comment-date md3-body-small dinor-text-gray"},Ce={key:0,class:"comment-actions"},_e=["onClick"],De={class:"comment-content md3-body-medium"},we={key:1,class:"empty-comments"},Ee={key:2,class:"error-state"},Ie={class:"error-actions"};const xe=g({name:"EventDetail",emits:["update-header"],components:{ShareModal:b,AuthModal:k,DinorIcon:f},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=y(),n=C(),o=_(),{showShareModal:s,updateOpenGraphTags:l}=D(),{comments:r,loadComments:i,canDeleteComment:d,deleteComment:c,setContext:m,addComment:h}=w(),g=u(null),f=u(!0),k=u(!1),b=u(!1),E=u(""),I=u(!1),x=v(()=>g.value?{title:g.value.title,text:`Ne manquez pas cet √©v√©nement : ${g.value.title}`,url:window.location.href,image:g.value.image,type:"event",id:g.value.id}:{}),S=async()=>{try{const t=await n.get("/likes/check",{type:"event",id:e.id});k.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la v√©rification du like:",t)}},A=async()=>{try{const t=await n.get("/favorites/check",{type:"event",id:e.id});b.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la v√©rification du favori:",t)}},T=(e,t)=>{if(!e)return"";const a=new Date(e);if(t){const[e,n]=t.split(":");a.setHours(parseInt(e),parseInt(n))}return a.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")};return p(()=>{(async()=>{try{const a=await n.get(`/events/${e.id}`);a.success&&(g.value=a.data,m("Event",e.id),await i(),await S(),await A(),l(x.value),t("update-header",{title:g.value.title||"√âv√©nement",showShare:!0,showFavorite:!0,favoriteType:"event",favoriteItemId:parseInt(e.id),isContentFavorited:b.value,backPath:"/events"}))}catch(a){console.error("Erreur lors du chargement de l'√©v√©nement:",a)}finally{f.value=!1}})()}),{event:g,comments:r,loading:f,userLiked:k,userFavorited:b,newComment:E,toggleLike:async()=>{try{const a=await n.post("/likes/toggle",{likeable_type:"event",likeable_id:e.id});a.success&&(k.value=!k.value,g.value&&(g.value.likes_count=a.data.total_likes),t("update-header",{isLiked:k.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await n.post("/favorites/toggle",{favoritable_type:"event",favoritable_id:e.id});a.success&&(b.value=!b.value,g.value&&(g.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:b.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(E.value.trim())if(o.isAuthenticated)try{console.log("üìù [Comments] Envoi du commentaire pour Event:",e.id),await h("Event",e.id,E.value),console.log("‚úÖ [Comments] Commentaire ajout√© avec succ√®s"),E.value=""}catch(t){console.error("‚ùå [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connect√©"))&&(I.value=!0)}else I.value=!0},canDeleteComment:d,deleteComment:c,goBack:()=>{a.push("/events")},goHome:()=>{a.push("/")},formatEventDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}):"",formatEventDateDetailed:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",formatTime:e=>{if(!e)return"";if(e.match(/^\d{2}:\d{2}$/))return e;try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return e}},formatCommentDate:e=>{if(!e)return"";const t=new Date,a=new Date(e),n=t-a,o=Math.floor(n/864e5),s=Math.floor(n/36e5),l=Math.floor(n/6e4);return l<1?"√Ä l'instant":l<60?`Il y a ${l} min`:s<24?`Il y a ${s} h`:o<7?`Il y a ${o} jour${o>1?"s":""}`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:a.getFullYear()!==t.getFullYear()?"numeric":void 0})},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR"):"",handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>√âtape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",showShareModal:s,shareData:x,authStore:o,showAuthModal:I,addToGoogleCalendar:()=>{if(!g.value)return;const e=encodeURIComponent(g.value.title),t=encodeURIComponent(g.value.content?g.value.content.replace(/<[^>]*>/g,""):""),a=encodeURIComponent(g.value.location||""),n=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${e}&dates=${T(g.value.start_date,g.value.start_time)}/${T(g.value.end_date||g.value.start_date,g.value.end_time||g.value.start_time)}&details=${t}&location=${a}&sf=true&output=xml`;window.open(n,"_blank")},addToIcal:()=>{if(!g.value)return;const e=g.value.title,t=g.value.content?g.value.content.replace(/<[^>]*>/g,""):"",a=g.value.location||"",n=T(g.value.start_date,g.value.start_time),o=T(g.value.end_date||g.value.start_date,g.value.end_time||g.value.start_time),s=`BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Dinor//Event//EN\nBEGIN:VEVENT\nUID:${g.value.id}@dinor.com\nDTSTART:${n}\nDTEND:${o}\nSUMMARY:${e}\nDESCRIPTION:${t}\nLOCATION:${a}\nEND:VEVENT\nEND:VCALENDAR`,l=new Blob([s],{type:"text/calendar;charset=utf-8"}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download=`${e.replace(/[^a-zA-Z0-9]/g,"_")}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}}}},[["render",function(u,v,p,y,g,f){const k=o("DinorIcon"),b=o("ShareModal"),C=o("AuthModal");return h(),e("div",E,[t("main",I,[y.loading?(h(),e("div",x,v[11]||(v[11]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'√©v√©nement...",-1)]))):y.event?(h(),e("div",S,[y.event.featured_image_url?(h(),e("div",A,[t("img",{src:y.event.featured_image_url||"/images/default-recipe.jpg",alt:y.event.title,class:"event-hero-image",onError:v[0]||(v[0]=(...e)=>y.handleImageError&&y.handleImageError(...e))},null,40,T),t("div",$,[t("div",M,[y.event.location?(h(),e("div",j,[a(k,{name:"location_on",size:16}),t("span",null,s(y.event.location),1)])):n("",!0),y.event.category?(h(),e("div",L,[a(k,{name:"tag",size:16}),t("span",null,s(y.event.category.name),1)])):n("",!0)])])])):n("",!0),t("div",R,[t("div",N,[y.event.start_date?(h(),e("div",V,[a(k,{name:"calendar_today",size:16}),t("span",F,s(y.formatEventDate(y.event.start_date)),1)])):n("",!0),y.event.start_time?(h(),e("div",z,[a(k,{name:"schedule",size:16}),t("span",U,s(y.formatTime(y.event.start_time)),1)])):n("",!0),y.event.location?(h(),e("div",O,[a(k,{name:"place",size:16}),t("span",G,s(y.event.location),1)])):n("",!0),t("div",H,[a(k,{name:"favorite",size:16}),t("span",B,s(y.event.likes_count||0),1)]),t("div",P,[a(k,{name:"comment",size:16}),t("span",q,s(y.event.comments_count||0),1)])]),t("div",Y,[t("div",Z,[v[12]||(v[12]=t("h3",{class:"md3-title-small dinor-text-primary"},"Date et Heure",-1)),t("p",J,[l(s(y.formatEventDateDetailed(y.event.start_date))+" ",1),y.event.start_time?(h(),e("span",K," √† "+s(y.formatTime(y.event.start_time)),1)):n("",!0),y.event.end_date&&y.event.end_date!==y.event.start_date?(h(),e("span",Q,[l(" - "+s(y.formatEventDateDetailed(y.event.end_date))+" ",1),y.event.end_time?(h(),e("span",W," √† "+s(y.formatTime(y.event.end_time)),1)):n("",!0)])):n("",!0)])]),y.event.location?(h(),e("div",X,[v[13]||(v[13]=t("h3",{class:"md3-title-small dinor-text-primary"},"Lieu",-1)),t("p",ee,s(y.event.location),1)])):n("",!0)]),t("div",te,[v[16]||(v[16]=t("h3",{class:"md3-title-small dinor-text-primary"},"Ajouter √† votre agenda",-1)),t("div",ae,[t("button",{onClick:v[1]||(v[1]=(...e)=>y.addToGoogleCalendar&&y.addToGoogleCalendar(...e)),class:"calendar-button google-calendar"},v[14]||(v[14]=[t("span",{class:"material-symbols-outlined"},"event",-1),t("span",{class:"emoji-fallback"},"üìÖ",-1),l(" Google Calendar ")])),t("button",{onClick:v[2]||(v[2]=(...e)=>y.addToIcal&&y.addToIcal(...e)),class:"calendar-button ical"},v[15]||(v[15]=[t("span",{class:"material-symbols-outlined"},"calendar_month",-1),t("span",{class:"emoji-fallback"},"üóìÔ∏è",-1),l(" iCal / Outlook ")]))])]),y.event.content?(h(),e("div",ne,[v[17]||(v[17]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:y.formatContent(y.event.content)},null,8,oe)])):n("",!0),y.event.registration_required?(h(),e("div",se,[v[18]||(v[18]=t("h3",{class:"md3-title-small dinor-text-primary"},"Inscription",-1)),v[19]||(v[19]=t("p",{class:"md3-body-medium"},[t("span",{class:"material-symbols-outlined dinor-text-secondary"},"info"),t("span",{class:"emoji-fallback dinor-text-secondary"},"‚ÑπÔ∏è"),l(" Inscription requise pour cet √©v√©nement ")],-1)),y.event.max_attendees?(h(),e("div",le,[t("p",re," Places limit√©es: "+s(y.event.max_attendees)+" personnes maximum ",1)])):n("",!0)])):n("",!0),t("div",ie,[t("h2",de,"Commentaires ("+s(y.comments.length)+")",1),t("div",ce,[y.authStore.isAuthenticated?(h(),e("div",ue,[t("div",ve,[t("span",pe,"Connect√© en tant que "+s(y.authStore.userName),1),t("button",{onClick:v[4]||(v[4]=e=>y.authStore.logout()),class:"btn-logout"},"D√©connexion")]),r(t("textarea",{"onUpdate:modelValue":v[5]||(v[5]=e=>y.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[i,y.newComment]]),t("button",{onClick:v[6]||(v[6]=(...e)=>y.addComment&&y.addComment(...e)),class:"btn-primary",disabled:!y.newComment.trim()}," Publier ",8,ye)])):(h(),e("div",me,[v[20]||(v[20]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:v[3]||(v[3]=e=>y.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),y.comments.length?(h(),e("div",he,[(h(!0),e(d,null,c(y.comments,a=>(h(),e("div",{key:a.id,class:"comment-item"},[t("div",ge,[t("div",fe,[t("span",ke,s(a.author_name),1),t("span",be,s(y.formatDate(a.created_at)),1)]),y.canDeleteComment(a)?(h(),e("div",Ce,[t("button",{onClick:e=>y.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},v[21]||(v[21]=[t("span",{class:"material-symbols-outlined"},"delete",-1),t("span",{class:"emoji-fallback"},"üóëÔ∏è",-1)]),8,_e)])):n("",!0)]),t("p",De,s(a.content),1)]))),128))])):(h(),e("div",we,v[22]||(v[22]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(h(),e("div",Ee,[v[23]||(v[23]=m('<div class="error-icon" data-v-dfd712fa><span class="material-symbols-outlined" data-v-dfd712fa>error</span><span class="emoji-fallback" data-v-dfd712fa>‚ö†Ô∏è</span></div><h2 class="md3-title-large" data-v-dfd712fa>√âv√©nement introuvable</h2><p class="md3-body-large dinor-text-gray" data-v-dfd712fa>L&#39;√©v√©nement demand√© n&#39;existe pas ou a √©t√© supprim√©.</p>',3)),t("div",Ie,[t("button",{onClick:v[7]||(v[7]=(...e)=>y.goBack&&y.goBack(...e)),class:"btn-secondary"},"Retour aux √©v√©nements"),t("button",{onClick:v[8]||(v[8]=(...e)=>y.goHome&&y.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(b,{modelValue:y.showShareModal,"onUpdate:modelValue":v[9]||(v[9]=e=>y.showShareModal=e),"share-data":y.shareData},null,8,["modelValue","share-data"]),a(C,{modelValue:y.showAuthModal,"onUpdate:modelValue":v[10]||(v[10]=e=>y.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-dfd712fa"]]);export{xe as default};
