import{r as e,b as t,w as i,h as a,e as o,g as n,y as l,f as s,t as u,n as d,o as r}from"./vendor.CgTKjNNK.js";import{_ as c,u as v,b as k}from"./index.BVqTe4Wo.js";const p={name:"LikeButton",props:{type:{type:String,required:!0,validator:e=>["recipe","tip","event","dinor_tv"].includes(e)},itemId:{type:[Number,String],required:!0},initialLiked:{type:Boolean,default:!1},initialCount:{type:Number,default:0},showCount:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},variant:{type:String,default:"default",validator:e=>["default","compact","minimal"].includes(e)}},emits:["update:liked","update:count","auth-required"],setup(o,{emit:n}){const l=v(),s=e(!1),u=e(o.initialLiked),d=e(o.initialCount),r=t(()=>l.isAuthenticated),c=async()=>{if(l.isAuthenticated&&o.itemId)try{const e=await k.request(`/likes/check?type=${o.type}&id=${o.itemId}`);e.success&&(u.value=e.is_liked,"number"==typeof e.likes_count&&(d.value=e.likes_count))}catch(e){console.warn("Erreur lors de la vérification du statut like:",e)}else u.value=!1};i(()=>l.isAuthenticated,e=>{e?c():u.value=!1}),i(()=>o.initialLiked,e=>{u.value=e}),i(()=>o.initialCount,e=>{d.value=e});const p=e=>{const{type:t,id:i,liked:a,count:n}=e.detail;t===o.type&&i==o.itemId&&(u.value=a,d.value=n)};return a(()=>{l.isAuthenticated&&c(),window.addEventListener("like-updated",p)}),{loading:s,isLiked:u,likesCount:d,canInteract:r,formatCount:e=>e<1e3?e.toString():e<1e6?`${Math.floor(e/1e3)}k`:`${Math.floor(e/1e6)}M`,handleToggle:async()=>{if(console.log("👍 [LikeButton] Clic détecté sur bouton like",{type:o.type,itemId:o.itemId,isAuthenticated:l.isAuthenticated}),!l.isAuthenticated)return console.log("🔒 [LikeButton] Utilisateur non connecté"),void n("auth-required");if(s.value)return void console.log("⏳ [LikeButton] Déjà en cours de chargement");s.value=!0;const e=u.value,t=d.value;u.value=!u.value,d.value+=u.value?1:-1;try{const e=await k.request("/likes/toggle",{method:"POST",body:{type:o.type,id:o.itemId}});if(!e.success)throw new Error(e.message||"Erreur lors de la mise à jour des likes");u.value="liked"===e.action,"number"==typeof e.likes_count&&(d.value=e.likes_count),n("update:liked",u.value),n("update:count",d.value),window.dispatchEvent(new CustomEvent("like-updated",{detail:{type:o.type,id:o.itemId,liked:u.value,count:d.value,favorited:"favorited"===e.favorite_action,favoritesCount:e.favorites_count||0}})),console.log("👍 [Likes] Toggle réussi:",{type:o.type,id:o.itemId,liked:u.value,count:d.value,favorited:"favorited"===e.favorite_action,favoritesCount:e.favorites_count})}catch(i){console.error("❌ [Likes] Erreur toggle:",i),u.value=e,d.value=t,401!==i.status&&"AUTH_REQUIRED"!==i.type||n("auth-required",{context:"aimer ce contenu",error:i})}finally{s.value=!1}}}}},m=["disabled","title"],f={key:0,class:"loading-spinner"},g={class:"material-symbols-outlined heart-icon"},y={class:"emoji-fallback"},h={key:2,class:"like-count"};const b=c(p,[["render",function(e,t,i,a,c,v){return r(),o("button",{onClick:t[1]||(t[1]=(...e)=>a.handleToggle&&a.handleToggle(...e)),class:d(["like-button",{"is-liked":a.isLiked,"is-loading":a.loading,"is-disabled":!a.canInteract}]),disabled:a.loading||!a.canInteract,title:a.isLiked?"Retirer le like":"Aimer ce contenu"},[a.loading?(r(),o("div",f)):(r(),o("div",{key:1,class:"heart-container",onClick:t[0]||(t[0]=l((...e)=>a.handleToggle&&a.handleToggle(...e),["stop"]))},[s("span",g,u(a.isLiked?"favorite":"favorite_border"),1),s("span",y,u(a.isLiked?"❤️":"🤍"),1)])),i.showCount&&a.likesCount>0?(r(),o("span",h,u(a.formatCount(a.likesCount)),1)):n("",!0)],10,m)}],["__scopeId","data-v-446ff1e2"]]);export{b as L};
