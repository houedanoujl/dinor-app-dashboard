import{e,p as a,g as i,l as s,f as l,t,x as o,F as d,B as n,J as r,v as c,b as u,r as v,h as m,o as p}from"./vendor.DPtJZQQS.js";import{_ as f,A as y,b as h}from"./index.C2Y7xW-Y.js";import{B as b,u as g}from"./BannerSection.DExf2B_4.js";import{F as V}from"./FavoriteButton.CXIRkEVK.js";import"./useApi.C08YzUxl.js";const k={class:"dinor-tv"},w={key:0,class:"loading-state"},_={key:1,class:"error-state"},j={class:"md3-body-large dinor-text-gray"},E={key:2,class:"content"},A={key:0,class:"live-section"},C={class:"live-grid"},T=["onClick"],B={class:"video-thumbnail"},D=["src","alt"],M={class:"video-info"},F={class:"video-title"},I={key:0,class:"video-description"},S={class:"video-meta"},x={key:0,class:"viewers"},R={key:1,class:"scheduled"},$={class:"videos-section"},L={key:0,class:"empty-state"},z={key:1,class:"videos-grid"},U={key:0,class:"featured-video md3-card"},q=["src","alt"],J={class:"video-info"},P={class:"video-title md3-title-medium"},G={key:0,class:"video-description md3-body-medium dinor-text-gray"},H={class:"video-meta"},K={class:"views-count"},N={class:"video-date"},O={class:"regular-videos"},Q=["onClick"],W={class:"video-thumbnail"},X=["src","alt"],Y={class:"video-info"},Z={class:"video-title md3-title-small"},ee={class:"video-meta"},ae={class:"views-count"},ie={class:"video-date"},se={class:"video-player"},le=["src","title"],te={class:"video-details"},oe={key:0};const de=f({name:"DinorTV",components:{FavoriteButton:V,AuthModal:y,BannerSection:b},setup(){const{banners:e,loadBannersForContentType:a}=g(),i=u(()=>e.value),s=v([]),l=v(null),t=v(!1),o=v(null),d=v(!1),n=u(()=>s.value.filter(e=>e.is_live)),r=u(()=>s.value.find(e=>e.is_featured)||s.value[0]||null),c=u(()=>{const e=r.value;return e?s.value.filter(a=>a.id!==e.id):s.value}),p=async()=>{t.value=!0,o.value=null;try{const e=await h.getVideos();if(!e.success)throw new Error(e.message||"Failed to fetch videos");s.value=e.data}catch(e){o.value=e.message,console.error("Error fetching videos:",e)}finally{t.value=!1}};return m(async()=>{await a("videos",!0),p()}),{videos:s,liveVideos:n,featuredVideo:r,regularVideos:c,selectedVideo:l,loading:t,error:o,showAuthModal:d,bannersByType:i,retry:()=>{o.value=null,p()},playVideo:e=>{l.value=e,document.body.style.overflow="hidden"},closeVideo:()=>{l.value=null,document.body.style.overflow="auto"},getVideoThumbnail:e=>{if(!e)return"/images/default-video.jpg";const a=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);return a?`https://img.youtube.com/vi/${a[1]}/maxresdefault.jpg`:"/images/default-video.jpg"},getEmbedUrl:e=>{if(!e)return"";const a=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);return a?`https://www.youtube.com/embed/${a[1]}?autoplay=1`:e},getShortDescription:e=>{if(!e)return"";const a=e.replace(/<[^>]*>/g,"");return a.length>100?a.substring(0,100)+"...":a},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}):"",formatTime:e=>e?new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):"",formatViews:e=>e&&0!==e?1===e?"1 vue":e<1e3?`${e} vues`:e<1e6?`${Math.floor(e/1e3)}k vues`:`${Math.floor(e/1e6)}M vues`:"0 vue",handleImageError:e=>{e.target.src="/images/default-video-thumbnail.jpg"}}}},[["render",function(u,v,m,f,y,h){const b=s("BannerSection"),g=s("FavoriteButton"),V=s("AuthModal");return p(),e("div",k,[a(b,{type:"videos",section:"hero",banners:f.bannersByType},null,8,["banners"]),f.loading?(p(),e("div",w,v[11]||(v[11]=[l("div",{class:"loading-spinner"},null,-1),l("p",null,"Chargement des vid√©os...",-1)]))):f.error?(p(),e("div",_,[v[12]||(v[12]=l("div",{class:"error-icon"},[l("span",{class:"material-symbols-outlined"},"error"),l("span",{class:"emoji-fallback"},"‚ö†Ô∏è")],-1)),v[13]||(v[13]=l("h2",{class:"md3-title-large"},"Erreur de chargement",-1)),l("p",j,t(f.error),1),l("button",{onClick:v[0]||(v[0]=(...e)=>f.retry&&f.retry(...e)),class:"btn-secondary"},"R√©essayer")])):(p(),e("div",E,[f.liveVideos.length?(p(),e("section",A,[v[17]||(v[17]=l("h2",{class:"section-title"},[l("span",{class:"live-indicator"}),o(" En Direct ")],-1)),l("div",C,[(p(!0),e(d,null,n(f.liveVideos,a=>(p(),e("article",{key:a.id,onClick:e=>f.playVideo(a),class:"video-card live-card"},[l("div",B,[l("img",{src:f.getVideoThumbnail(a.video_url),alt:a.title,loading:"lazy"},null,8,D),v[14]||(v[14]=r('<div class="video-overlay" data-v-a5e1f900><div class="play-button" data-v-a5e1f900><span class="material-symbols-outlined" data-v-a5e1f900>play_circle</span><span class="emoji-fallback" data-v-a5e1f900>‚ñ∂Ô∏è</span></div><div class="live-badge" data-v-a5e1f900><span class="live-dot" data-v-a5e1f900></span> LIVE </div></div>',1))]),l("div",M,[l("h3",F,t(a.title),1),a.description?(p(),e("p",I,t(f.getShortDescription(a.description)),1)):i("",!0),l("div",S,[a.viewers_count?(p(),e("span",x,[v[15]||(v[15]=l("span",{class:"material-symbols-outlined"},"visibility",-1)),v[16]||(v[16]=l("span",{class:"emoji-fallback"},"üëÅÔ∏è",-1)),o(" "+t(a.viewers_count)+" spectateurs ",1)])):i("",!0),a.scheduled_at?(p(),e("span",R," Programm√© √† "+t(f.formatTime(a.scheduled_at)),1)):i("",!0)])])],8,T))),128))])])):i("",!0),l("section",$,[v[25]||(v[25]=l("h2",{class:"section-title"},"Toutes les vid√©os",-1)),f.videos.length||f.loading?(p(),e("div",z,[f.featuredVideo?(p(),e("div",U,[l("div",{class:"video-thumbnail",onClick:v[2]||(v[2]=e=>f.playVideo(f.featuredVideo))},[l("img",{src:f.getVideoThumbnail(f.featuredVideo.video_url)||"/images/default-video-thumbnail.jpg",alt:f.featuredVideo.title,onError:v[1]||(v[1]=(...e)=>f.handleImageError&&f.handleImageError(...e))},null,40,q),v[19]||(v[19]=r('<div class="play-overlay" data-v-a5e1f900><div class="play-button" data-v-a5e1f900><span class="material-symbols-outlined" data-v-a5e1f900>play_circle</span><span class="emoji-fallback" data-v-a5e1f900>‚ñ∂Ô∏è</span></div></div><div class="video-badge featured-badge" data-v-a5e1f900><span data-v-a5e1f900>√Ä la une</span></div>',2))]),l("div",J,[l("h2",P,t(f.featuredVideo.title),1),f.featuredVideo.description?(p(),e("p",G,t(f.featuredVideo.description),1)):i("",!0),l("div",H,[l("div",K,[v[20]||(v[20]=l("span",{class:"material-symbols-outlined"},"visibility",-1)),v[21]||(v[21]=l("span",{class:"emoji-fallback"},"üëÅÔ∏è",-1)),l("span",null,t(f.formatViews(f.featuredVideo.view_count)),1)]),l("div",N,[l("span",null,t(f.formatDate(f.featuredVideo.created_at)),1)]),a(g,{type:"dinor_tv","item-id":f.featuredVideo.id,"initial-favorited":!1,"initial-count":f.featuredVideo.favorites_count||0,"show-count":!0,size:"medium",onAuthRequired:v[3]||(v[3]=e=>f.showAuthModal=!0)},null,8,["item-id","initial-count"])])])])):i("",!0),l("div",O,[(p(!0),e(d,null,n(f.regularVideos,i=>(p(),e("div",{key:i.id,class:"video-card md3-card md3-ripple",onClick:e=>f.playVideo(i)},[l("div",W,[l("img",{src:f.getVideoThumbnail(i.video_url)||"/images/default-video-thumbnail.jpg",alt:i.title,onError:v[4]||(v[4]=(...e)=>f.handleImageError&&f.handleImageError(...e))},null,40,X),v[22]||(v[22]=l("div",{class:"play-overlay"},[l("div",{class:"play-button"},[l("span",{class:"material-symbols-outlined"},"play_circle"),l("span",{class:"emoji-fallback"},"‚ñ∂Ô∏è")])],-1))]),l("div",Y,[l("h3",Z,t(i.title),1),l("div",ee,[l("div",ae,[v[23]||(v[23]=l("span",{class:"material-symbols-outlined"},"visibility",-1)),v[24]||(v[24]=l("span",{class:"emoji-fallback"},"üëÅÔ∏è",-1)),l("span",null,t(f.formatViews(i.view_count)),1)]),l("div",ie,[l("span",null,t(f.formatDate(i.created_at)),1)]),a(g,{type:"dinor_tv","item-id":i.id,"initial-favorited":!1,"initial-count":i.favorites_count||0,"show-count":!0,size:"small",variant:"minimal",onAuthRequired:v[5]||(v[5]=e=>f.showAuthModal=!0),onClick:v[6]||(v[6]=c(()=>{},["stop"]))},null,8,["item-id","initial-count"])])])],8,Q))),128))])])):(p(),e("div",L,v[18]||(v[18]=[l("div",{class:"empty-icon"},[l("span",{class:"material-symbols-outlined"},"play_circle")],-1),l("h3",null,"Aucune vid√©o disponible",-1),l("p",null,"Les vid√©os culinaires seront bient√¥t disponibles.",-1)])))])])),f.selectedVideo?(p(),e("div",{key:3,class:"video-modal",onClick:v[9]||(v[9]=(...e)=>f.closeVideo&&f.closeVideo(...e))},[l("div",{class:"modal-content",onClick:v[8]||(v[8]=c(()=>{},["stop"]))},[l("button",{onClick:v[7]||(v[7]=(...e)=>f.closeVideo&&f.closeVideo(...e)),class:"close-button"},v[26]||(v[26]=[l("span",{class:"material-symbols-outlined"},"close",-1),l("span",{class:"emoji-fallback"},"‚úñÔ∏è",-1)])),l("div",se,[l("iframe",{src:f.getEmbedUrl(f.selectedVideo.video_url),title:f.selectedVideo.title,frameborder:"0",allowfullscreen:""},null,8,le)]),l("div",te,[l("h3",null,t(f.selectedVideo.title),1),f.selectedVideo.description?(p(),e("p",oe,t(f.selectedVideo.description),1)):i("",!0)])])])):i("",!0),a(V,{modelValue:f.showAuthModal,"onUpdate:modelValue":v[10]||(v[10]=e=>f.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-a5e1f900"]]);export{de as default};
