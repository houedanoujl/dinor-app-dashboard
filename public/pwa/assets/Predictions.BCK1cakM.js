import{e,f as a,p as s,g as t,t as n,y as i,A as r,q as o,x as l,l as c,F as u,B as d,n as m,v as p,r as h,b as v,w as y,h as g,o as b}from"./vendor.DPtJZQQS.js";import{_,A as f,u as k,d as w}from"./index.C2Y7xW-Y.js";const M={class:"predictions"},A={class:"md3-main-content"},S={key:0,class:"loading-container"},T={key:1,class:"predictions-content"},P={key:0,class:"current-match-section"},x={class:"match-card featured"},C={class:"match-header"},E={class:"match-teams"},z={class:"team home-team"},I=["src","alt"],D={key:1,class:"team-logo-placeholder"},j={class:"team-name"},q={class:"match-vs"},V={class:"match-date"},F={class:"team away-team"},R=["src","alt"],L={key:1,class:"team-logo-placeholder"},$={class:"team-name"},O={key:0,class:"prediction-status can-predict"},U={key:1,class:"prediction-status closed"},N={key:0,class:"prediction-form"},W={class:"score-inputs"},B={class:"score-input"},G={class:"md3-body-small"},H={class:"score-input"},X={class:"md3-body-small"},J=["disabled"],K={key:0},Q={key:1},Y={key:1,class:"auth-required"},Z={key:2,class:"user-prediction"},ee={class:"prediction-display"},ae={class:"prediction-score"},se={class:"prediction-winner"},te={key:1,class:"no-match-section"},ne={class:"no-match-card"},ie={class:"suggestions-grid"},re={class:"tournaments-section"},oe={class:"section-header"},le={key:0,class:"tournaments-loading"},ce={key:1,class:"tournaments-grid"},ue=["onClick"],de={class:"tournament-header"},me={class:"tournament-name"},pe={class:"tournament-description"},he={class:"tournament-info"},ve={class:"info-item"},ye={key:0,class:"info-item"},ge={class:"info-item"},be={class:"tournament-actions"},_e=["onClick","disabled"],fe={key:0},ke={key:1},we=["onClick"],Me={key:2,class:"tournament-closed"},Ae={key:2,class:"no-tournaments-enhanced"},Se={class:"fallback-actions"},Te={class:"fallback-info"},Pe={class:"fallback-list"},xe={key:0},Ce={class:"fallback-cta"},Ee={class:"quick-actions"};const ze=_({name:"Predictions",emits:["update-header"],components:{AuthModal:f},setup(e,{emit:a}){const s=k(),t=w(),n=h(null),i=h(null),r=h(!0),o=h(!1),l=h(!1),c=h([]),u=h(!0),d=h(null),m=h({homeScore:0,awayScore:0}),p=v(()=>null!==m.value.homeScore&&null!==m.value.awayScore&&m.value.homeScore>=0&&m.value.awayScore>=0),b=async()=>{if(t.isAuthenticated&&n.value)try{const e=await s.get(`/predictions/match/${n.value.id}`);e.success&&e.data&&(i.value=e.data,m.value={homeScore:e.data.predicted_home_score,awayScore:e.data.predicted_away_score})}catch(e){console.error("Erreur lors du chargement de la prédiction:",e)}};y(()=>t.isAuthenticated,e=>{e?b():i.value=null});return g(()=>{(async()=>{try{const e=await s.get("/matches/current/match");e.success&&e.data&&(n.value=e.data,await b())}catch(e){console.error("Erreur lors du chargement du match:",e)}finally{r.value=!1}})(),(async()=>{try{const e=await s.get("/tournaments/featured");e.success&&(c.value=e.data||[])}catch(e){console.error("Erreur lors du chargement des tournois:",e)}finally{u.value=!1}})(),a("update-header",{title:"Pronostics",showBack:!1})}),{currentMatch:n,userPrediction:i,loading:r,submitting:o,showAuthModal:l,prediction:m,canSubmitPrediction:p,authStore:t,featuredTournaments:c,loadingTournaments:u,registering:d,submitPrediction:async()=>{var e;if(p.value&&!o.value){o.value=!0;try{const e={football_match_id:n.value.id,predicted_home_score:m.value.homeScore,predicted_away_score:m.value.awayScore};let a;a=i.value?await s.put(`/predictions/${i.value.id}`,e):await s.post("/predictions",e),a.success&&(i.value=a.data,console.log("Pronostic enregistré avec succès!"))}catch(a){console.error("Erreur lors de l'envoi du pronostic:",a),(null==(e=a.message)?void 0:e.includes("401"))&&(l.value=!0)}finally{o.value=!1}}},registerToTournament:async e=>{var a,n,i;if(t.isAuthenticated)if(e.user_is_participant)console.log("Utilisateur déjà inscrit au tournoi");else{d.value=e.id;try{(await s.post(`/tournaments/${e.id}/register`,{})).success&&(e.user_is_participant=!0,e.can_register=!1,e.participants_count+=1,console.log("Inscription réussie au tournoi!"))}catch(r){console.error("Erreur lors de l'inscription:",r),(null==(a=r.message)?void 0:a.includes("Inscription impossible"))||(null==(n=r.message)?void 0:n.includes("REGISTRATION_NOT_ALLOWED"))?(console.log("Utilisateur probablement déjà inscrit, mise à jour de l'état"),e.user_is_participant=!0,e.can_register=!1):(null==(i=r.message)?void 0:i.includes("401"))&&(l.value=!0)}finally{d.value=null}}else l.value=!0},openTournament:e=>{console.log("Ouverture du tournoi:",e.name)},viewTournamentLeaderboard:e=>{console.log("Classement du tournoi:",e.name)},formatMatchDate:e=>new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),formatTournamentDate:e=>{const a=new Date(e),s=new Date,t=Math.ceil((a-s)/864e5);return t<0?"Terminé":0===t?"Aujourd'hui":1===t?"Demain":t<7?`Dans ${t} jours`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},formatPrize:(e,a)=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:a||"XOF",minimumFractionDigits:0}).format(e),getPredictedWinnerText:e=>{var a,s,t,i;switch(e){case"home":return(null==(s=null==(a=n.value)?void 0:a.home_team)?void 0:s.name)||"Domicile";case"away":return(null==(i=null==(t=n.value)?void 0:t.away_team)?void 0:i.name)||"Extérieur";case"draw":return"Match nul";default:return"Inconnu"}},handleImageError:e=>{e.target.style.display="none"},handleAuthenticated:()=>{l.value=!1,b()}}}},[["render",function(h,v,y,g,_,f){const k=c("router-link"),w=c("AuthModal");return b(),e("div",M,[a("main",A,[g.loading?(b(),e("div",S,v[12]||(v[12]=[a("div",{class:"md3-circular-progress"},null,-1),a("p",{class:"md3-body-large"},"Chargement des matchs...",-1)]))):(b(),e("div",T,[v[47]||(v[47]=a("div",{class:"predictions-header"},[a("h1",{class:"md3-title-large dinor-text-primary"},"Pronostics"),a("p",{class:"md3-body-medium dinor-text-gray"},"Pariez sur vos matchs favoris et gagnez des points!")],-1)),g.currentMatch?(b(),e("div",P,[v[22]||(v[22]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Match en cours",-1)),a("div",x,[a("div",C,[a("div",E,[a("div",z,[g.currentMatch.home_team.logo_url?(b(),e("img",{key:0,src:g.currentMatch.home_team.logo_url,alt:g.currentMatch.home_team.name,class:"team-logo",onError:v[0]||(v[0]=(...e)=>g.handleImageError&&g.handleImageError(...e))},null,40,I)):(b(),e("div",D,v[13]||(v[13]=[a("span",{class:"material-symbols-outlined"},"sports_soccer",-1)]))),a("span",j,n(g.currentMatch.home_team.name),1)]),a("div",q,[v[14]||(v[14]=a("span",{class:"vs-text"},"VS",-1)),a("div",V,n(g.formatMatchDate(g.currentMatch.match_date)),1)]),a("div",F,[g.currentMatch.away_team.logo_url?(b(),e("img",{key:0,src:g.currentMatch.away_team.logo_url,alt:g.currentMatch.away_team.name,class:"team-logo",onError:v[1]||(v[1]=(...e)=>g.handleImageError&&g.handleImageError(...e))},null,40,R)):(b(),e("div",L,v[15]||(v[15]=[a("span",{class:"material-symbols-outlined"},"sports_soccer",-1)]))),a("span",$,n(g.currentMatch.away_team.name),1)])]),g.currentMatch.can_predict?(b(),e("div",O,v[16]||(v[16]=[a("span",{class:"material-symbols-outlined"},"check_circle",-1),a("span",null,"Prédictions ouvertes",-1)]))):(b(),e("div",U,v[17]||(v[17]=[a("span",{class:"material-symbols-outlined"},"cancel",-1),a("span",null,"Prédictions fermées",-1)])))]),g.currentMatch.can_predict&&g.authStore.isAuthenticated?(b(),e("div",N,[v[19]||(v[19]=a("h3",{class:"md3-title-small"},"Votre pronostic",-1)),a("div",W,[a("div",B,[a("label",G,n(g.currentMatch.home_team.short_name||g.currentMatch.home_team.name),1),i(a("input",{"onUpdate:modelValue":v[2]||(v[2]=e=>g.prediction.homeScore=e),type:"number",min:"0",max:"20",class:"score-field"},null,512),[[r,g.prediction.homeScore,void 0,{number:!0}]])]),v[18]||(v[18]=a("div",{class:"score-separator"},"-",-1)),a("div",H,[a("label",X,n(g.currentMatch.away_team.short_name||g.currentMatch.away_team.name),1),i(a("input",{"onUpdate:modelValue":v[3]||(v[3]=e=>g.prediction.awayScore=e),type:"number",min:"0",max:"20",class:"score-field"},null,512),[[r,g.prediction.awayScore,void 0,{number:!0}]])])]),a("button",{onClick:v[4]||(v[4]=(...e)=>g.submitPrediction&&g.submitPrediction(...e)),disabled:!g.canSubmitPrediction||g.submitting,class:"btn-primary prediction-submit"},[g.submitting?(b(),e("span",K,"Envoi...")):(b(),e("span",Q,n(g.userPrediction?"Modifier":"Valider")+" le pronostic",1))],8,J)])):g.currentMatch.can_predict&&!g.authStore.isAuthenticated?(b(),e("div",Y,[v[20]||(v[20]=a("p",{class:"md3-body-medium"},"Connectez-vous pour faire votre pronostic",-1)),a("button",{onClick:v[5]||(v[5]=e=>g.showAuthModal=!0),class:"btn-primary"}," Se connecter ")])):t("",!0),g.userPrediction?(b(),e("div",Z,[v[21]||(v[21]=a("h3",{class:"md3-title-small"},"Votre pronostic actuel",-1)),a("div",ee,[a("span",ae,n(g.userPrediction.predicted_home_score)+" - "+n(g.userPrediction.predicted_away_score),1),a("span",se," Gagnant prédit: "+n(g.getPredictedWinnerText(g.userPrediction.predicted_winner)),1)])])):t("",!0)])])):(b(),e("div",te,[a("div",ne,[v[26]||(v[26]=a("div",{class:"no-match-icon"},[a("span",{class:"material-symbols-outlined"},"sports_soccer")],-1)),v[27]||(v[27]=a("h2",{class:"md3-title-medium"},"Aucun match en cours",-1)),v[28]||(v[28]=a("p",{class:"md3-body-medium dinor-text-gray"}," Il n'y a pas de match disponible pour le moment, mais vous pouvez : ",-1)),a("div",ie,[a("div",{class:"suggestion-card",onClick:v[6]||(v[6]=e=>h.$router.push("/predictions/tournaments"))},v[23]||(v[23]=[a("div",{class:"suggestion-icon"},[a("span",{class:"material-symbols-outlined"},"emoji_events")],-1),a("h3",{class:"suggestion-title"},"Explorer les tournois",-1),a("p",{class:"suggestion-desc"},"Rejoignez des tournois et participez aux compétitions",-1)])),a("div",{class:"suggestion-card",onClick:v[7]||(v[7]=e=>h.$router.push("/predictions/leaderboard"))},v[24]||(v[24]=[a("div",{class:"suggestion-icon"},[a("span",{class:"material-symbols-outlined"},"leaderboard")],-1),a("h3",{class:"suggestion-title"},"Voir le classement",-1),a("p",{class:"suggestion-desc"},"Consultez les performances des autres joueurs",-1)])),a("div",{class:"suggestion-card",onClick:v[8]||(v[8]=e=>h.$router.push("/predictions/my-predictions"))},v[25]||(v[25]=[a("div",{class:"suggestion-icon"},[a("span",{class:"material-symbols-outlined"},"history")],-1),a("h3",{class:"suggestion-title"},"Historique",-1),a("p",{class:"suggestion-desc"},"Revoyez vos anciens pronostics et statistiques",-1)]))])])])),a("div",re,[a("div",oe,[v[30]||(v[30]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Tournois en cours",-1)),s(k,{to:"/predictions/tournaments",class:"view-all-link"},{default:o(()=>v[29]||(v[29]=[l(" Voir tout ")])),_:1,__:[29]})]),g.loadingTournaments?(b(),e("div",le,v[31]||(v[31]=[a("div",{class:"md3-circular-progress"},null,-1),a("p",{class:"md3-body-small"},"Chargement des tournois...",-1)]))):g.featuredTournaments.length>0?(b(),e("div",ce,[(b(!0),e(u,null,d(g.featuredTournaments,s=>(b(),e("div",{key:s.id,class:"tournament-card",onClick:e=>g.openTournament(s)},[a("div",de,[a("h3",me,n(s.name),1),a("span",{class:m(["tournament-status",s.status])},n(s.status_label),3)]),a("p",pe,n(s.description),1),a("div",he,[a("div",ve,[v[32]||(v[32]=a("span",{class:"material-symbols-outlined"},"group",-1)),a("span",null,n(s.participants_count)+" participants",1)]),s.prize_pool>0?(b(),e("div",ye,[v[33]||(v[33]=a("span",{class:"material-symbols-outlined"},"emoji_events",-1)),a("span",null,n(g.formatPrize(s.prize_pool,s.currency)),1)])):t("",!0),a("div",ge,[v[34]||(v[34]=a("span",{class:"material-symbols-outlined"},"schedule",-1)),a("span",null,n(g.formatTournamentDate(s.end_date)),1)])]),a("div",be,[s.can_register&&!s.user_is_participant?(b(),e("button",{key:0,onClick:p(e=>g.registerToTournament(s),["stop"]),disabled:g.registering===s.id,class:"btn-primary btn-small"},[g.registering===s.id?(b(),e("span",fe,"Inscription...")):(b(),e("span",ke,"Participer"))],8,_e)):s.user_is_participant?(b(),e("button",{key:1,onClick:p(e=>g.viewTournamentLeaderboard(s),["stop"]),class:"btn-secondary btn-small"},v[35]||(v[35]=[a("span",{class:"material-symbols-outlined"},"check_circle",-1),l(" Mon classement ")]),8,we)):(b(),e("span",Me,"Inscriptions fermées"))])],8,ue))),128))])):(b(),e("div",Ae,[v[42]||(v[42]=a("div",{class:"no-tournaments-icon"},[a("span",{class:"material-symbols-outlined"},"emoji_events")],-1)),v[43]||(v[43]=a("h3",{class:"md3-title-medium"},"Aucun tournoi disponible",-1)),v[44]||(v[44]=a("p",{class:"md3-body-medium dinor-text-gray"}," Les tournois apparaîtront ici dès qu'ils seront disponibles. ",-1)),a("div",Se,[a("div",Te,[v[39]||(v[39]=a("h4",{class:"md3-title-small"},"En attendant :",-1)),a("ul",Pe,[v[37]||(v[37]=a("li",null,[a("span",{class:"material-symbols-outlined"},"notifications"),a("span",null,"Activez les notifications pour être prévenu des nouveaux tournois")],-1)),v[38]||(v[38]=a("li",null,[a("span",{class:"material-symbols-outlined"},"schedule"),a("span",null,"Revenez régulièrement pour ne manquer aucune compétition")],-1)),g.authStore.isAuthenticated?t("",!0):(b(),e("li",xe,v[36]||(v[36]=[a("span",{class:"material-symbols-outlined"},"person",-1),a("span",null,"Créez un compte pour participer aux prochains tournois",-1)])))])]),a("div",Ce,[g.authStore.isAuthenticated?(b(),e("button",{key:1,onClick:v[10]||(v[10]=(...e)=>h.loadFeaturedTournaments&&h.loadFeaturedTournaments(...e)),class:"btn-secondary"},v[41]||(v[41]=[a("span",{class:"material-symbols-outlined"},"refresh",-1),a("span",null,"Actualiser",-1)]))):(b(),e("button",{key:0,onClick:v[9]||(v[9]=e=>g.showAuthModal=!0),class:"btn-primary"},v[40]||(v[40]=[a("span",{class:"material-symbols-outlined"},"person_add",-1),a("span",null,"Créer un compte",-1)])))])])]))]),a("div",Ee,[s(k,{to:"/predictions/leaderboard",class:"quick-action-card"},{default:o(()=>v[45]||(v[45]=[a("span",{class:"material-symbols-outlined"},"leaderboard",-1),a("div",{class:"action-text"},[a("h3",{class:"md3-title-small"},"Classement"),a("p",{class:"md3-body-small"},"Voir les meilleurs pronostiqueurs")],-1)])),_:1,__:[45]}),s(k,{to:"/predictions/my-predictions",class:"quick-action-card"},{default:o(()=>v[46]||(v[46]=[a("span",{class:"material-symbols-outlined"},"history",-1),a("div",{class:"action-text"},[a("h3",{class:"md3-title-small"},"Mes prédictions"),a("p",{class:"md3-body-small"},"Historique et statistiques")],-1)])),_:1,__:[46]})])]))]),s(w,{modelValue:g.showAuthModal,"onUpdate:modelValue":v[11]||(v[11]=e=>g.showAuthModal=e),onAuthenticated:g.handleAuthenticated},null,8,["modelValue","onAuthenticated"])])}],["__scopeId","data-v-f9229b69"]]);export{ze as default};
