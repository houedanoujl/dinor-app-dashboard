import{e,f as t,v as a,g as n,t as s,z as o,B as l,D as r,F as i,m as d,J as c,l as m,r as u,b as v,h as p,k as y,o as h}from"./vendor.CgTKjNNK.js";import{_ as g,A as f,S as b,a as k,u as _,d as C}from"./index.BVqTe4Wo.js";import{u as D}from"./useComments.zh3_vmNZ.js";const w={class:"event-detail"},E={class:"md3-main-content"},x={key:0,class:"loading-container"},I={key:1,class:"event-content"},S={key:0,class:"event-hero"},j=["src","alt"],T={class:"event-overlay dinor-gradient-primary"},A={class:"event-badges"},$={key:0,class:"md3-chip event-location"},L={key:1,class:"md3-chip event-category"},M={class:"event-info"},R={class:"event-stats"},N={key:0,class:"stat-item"},V={class:"md3-body-medium"},F={key:1,class:"stat-item"},U={class:"md3-body-medium"},O={key:2,class:"stat-item"},B={class:"md3-body-medium"},G={class:"stat-item"},H={class:"md3-body-medium"},P={class:"stat-item"},q={class:"md3-body-medium"},z={class:"event-details"},Y={class:"detail-item"},J={class:"md3-body-medium"},Z={key:0},K={key:1},Q={key:0},W={key:0,class:"detail-item"},X={class:"md3-body-medium"},ee={class:"calendar-links"},te={class:"calendar-buttons"},ae={key:0,class:"event-description"},ne=["innerHTML"],se={key:1,class:"event-registration"},oe={key:0,class:"registration-info"},le={class:"md3-body-small dinor-text-gray"},re={class:"comments-section"},ie={class:"md3-title-medium dinor-text-primary"},de={class:"add-comment-form"},ce={key:0,class:"auth-prompt"},me={key:1},ue={class:"authenticated-user"},ve={class:"user-info"},pe=["disabled"],ye={key:0,class:"comments-list"},he={class:"comment-header"},ge={class:"comment-meta"},fe={class:"comment-author md3-body-medium"},be={class:"comment-date md3-body-small dinor-text-gray"},ke={key:0,class:"comment-actions"},_e=["onClick"],Ce={class:"comment-content md3-body-medium"},De={key:1,class:"empty-comments"},we={key:2,class:"error-state"},Ee={class:"error-actions"};const xe=g({name:"EventDetail",emits:["update-header"],components:{ShareModal:b,AuthModal:f},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=y(),n=k(),s=_(),{showShareModal:o,updateOpenGraphTags:l}=C(),{comments:r,loadComments:i,canDeleteComment:d,deleteComment:c,setContext:m,addComment:h}=D(),g=u(null),f=u(!0),b=u(!1),w=u(!1),E=u(""),x=u(!1),I=v(()=>g.value?{title:g.value.title,text:`Ne manquez pas cet √©v√©nement : ${g.value.title}`,url:window.location.href,image:g.value.image,type:"event",id:g.value.id}:{}),S=async()=>{try{const t=await n.get("/likes/check",{type:"event",id:e.id});b.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la v√©rification du like:",t)}},j=async()=>{try{const t=await n.get("/favorites/check",{type:"event",id:e.id});w.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la v√©rification du favori:",t)}},T=(e,t)=>{if(!e)return"";const a=new Date(e);if(t){const[e,n]=t.split(":");a.setHours(parseInt(e),parseInt(n))}return a.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")};return p(()=>{(async()=>{try{const a=await n.get(`/events/${e.id}`);a.success&&(g.value=a.data,m("Event",e.id),await i(),await S(),await j(),l(I.value),t("update-header",{title:g.value.title||"√âv√©nement",showShare:!0,showFavorite:!0,favoriteType:"event",favoriteItemId:parseInt(e.id),isContentFavorited:w.value,backPath:"/events"}))}catch(a){console.error("Erreur lors du chargement de l'√©v√©nement:",a)}finally{f.value=!1}})()}),{event:g,comments:r,loading:f,userLiked:b,userFavorited:w,newComment:E,toggleLike:async()=>{try{const a=await n.post("/likes/toggle",{likeable_type:"event",likeable_id:e.id});a.success&&(b.value=!b.value,g.value&&(g.value.likes_count=a.data.total_likes),t("update-header",{isLiked:b.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await n.post("/favorites/toggle",{favoritable_type:"event",favoritable_id:e.id});a.success&&(w.value=!w.value,g.value&&(g.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:w.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(E.value.trim())if(s.isAuthenticated)try{console.log("üìù [Comments] Envoi du commentaire pour Event:",e.id),await h("Event",e.id,E.value),console.log("‚úÖ [Comments] Commentaire ajout√© avec succ√®s"),E.value=""}catch(t){console.error("‚ùå [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connect√©"))&&(x.value=!0)}else x.value=!0},canDeleteComment:d,deleteComment:c,goBack:()=>{a.push("/events")},goHome:()=>{a.push("/")},formatEventDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}):"",formatEventDateDetailed:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",formatTime:e=>{if(!e)return"";if(e.match(/^\d{2}:\d{2}$/))return e;try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return e}},formatCommentDate:e=>{if(!e)return"";const t=new Date,a=new Date(e),n=t-a,s=Math.floor(n/864e5),o=Math.floor(n/36e5),l=Math.floor(n/6e4);return l<1?"√Ä l'instant":l<60?`Il y a ${l} min`:o<24?`Il y a ${o} h`:s<7?`Il y a ${s} jour${s>1?"s":""}`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:a.getFullYear()!==t.getFullYear()?"numeric":void 0})},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR"):"",handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>√âtape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",showShareModal:o,shareData:I,authStore:s,showAuthModal:x,addToGoogleCalendar:()=>{if(!g.value)return;const e=encodeURIComponent(g.value.title),t=encodeURIComponent(g.value.content?g.value.content.replace(/<[^>]*>/g,""):""),a=encodeURIComponent(g.value.location||""),n=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${e}&dates=${T(g.value.start_date,g.value.start_time)}/${T(g.value.end_date||g.value.start_date,g.value.end_time||g.value.start_time)}&details=${t}&location=${a}&sf=true&output=xml`;window.open(n,"_blank")},addToIcal:()=>{if(!g.value)return;const e=g.value.title,t=g.value.content?g.value.content.replace(/<[^>]*>/g,""):"",a=g.value.location||"",n=T(g.value.start_date,g.value.start_time),s=T(g.value.end_date||g.value.start_date,g.value.end_time||g.value.start_time),o=`BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Dinor//Event//EN\nBEGIN:VEVENT\nUID:${g.value.id}@dinor.com\nDTSTART:${n}\nDTEND:${s}\nSUMMARY:${e}\nDESCRIPTION:${t}\nLOCATION:${a}\nEND:VEVENT\nEND:VCALENDAR`,l=new Blob([o],{type:"text/calendar;charset=utf-8"}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download=`${e.replace(/[^a-zA-Z0-9]/g,"_")}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}}}},[["render",function(u,v,p,y,g,f){const b=m("ShareModal"),k=m("AuthModal");return h(),e("div",w,[t("main",E,[y.loading?(h(),e("div",x,v[11]||(v[11]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'√©v√©nement...",-1)]))):y.event?(h(),e("div",I,[y.event.featured_image_url?(h(),e("div",S,[t("img",{src:y.event.featured_image_url||"/images/default-recipe.jpg",alt:y.event.title,class:"event-hero-image",onError:v[0]||(v[0]=(...e)=>y.handleImageError&&y.handleImageError(...e))},null,40,j),t("div",T,[t("div",A,[y.event.location?(h(),e("div",$,[v[12]||(v[12]=t("span",{class:"material-symbols-outlined"},"location_on",-1)),v[13]||(v[13]=t("span",{class:"emoji-fallback"},"üìç",-1)),t("span",null,s(y.event.location),1)])):n("",!0),y.event.category?(h(),e("div",L,[v[14]||(v[14]=t("span",{class:"material-symbols-outlined"},"tag",-1)),v[15]||(v[15]=t("span",{class:"emoji-fallback"},"üè∑Ô∏è",-1)),t("span",null,s(y.event.category.name),1)])):n("",!0)])])])):n("",!0),t("div",M,[t("div",R,[y.event.start_date?(h(),e("div",N,[v[16]||(v[16]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"calendar_today",-1)),v[17]||(v[17]=t("span",{class:"emoji-fallback"},"üìÖ",-1)),t("span",V,s(y.formatEventDate(y.event.start_date)),1)])):n("",!0),y.event.start_time?(h(),e("div",F,[v[18]||(v[18]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"schedule",-1)),v[19]||(v[19]=t("span",{class:"emoji-fallback"},"‚è∞",-1)),t("span",U,s(y.formatTime(y.event.start_time)),1)])):n("",!0),y.event.location?(h(),e("div",O,[v[20]||(v[20]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"place",-1)),v[21]||(v[21]=t("span",{class:"emoji-fallback"},"üìç",-1)),t("span",B,s(y.event.location),1)])):n("",!0),t("div",G,[v[22]||(v[22]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"favorite",-1)),v[23]||(v[23]=t("span",{class:"emoji-fallback"},"‚ù§Ô∏è",-1)),t("span",H,s(y.event.likes_count||0),1)]),t("div",P,[v[24]||(v[24]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"comment",-1)),v[25]||(v[25]=t("span",{class:"emoji-fallback"},"üí¨",-1)),t("span",q,s(y.event.comments_count||0),1)])]),t("div",z,[t("div",Y,[v[26]||(v[26]=t("h3",{class:"md3-title-small dinor-text-primary"},"Date et Heure",-1)),t("p",J,[o(s(y.formatEventDateDetailed(y.event.start_date))+" ",1),y.event.start_time?(h(),e("span",Z," √† "+s(y.formatTime(y.event.start_time)),1)):n("",!0),y.event.end_date&&y.event.end_date!==y.event.start_date?(h(),e("span",K,[o(" - "+s(y.formatEventDateDetailed(y.event.end_date))+" ",1),y.event.end_time?(h(),e("span",Q," √† "+s(y.formatTime(y.event.end_time)),1)):n("",!0)])):n("",!0)])]),y.event.location?(h(),e("div",W,[v[27]||(v[27]=t("h3",{class:"md3-title-small dinor-text-primary"},"Lieu",-1)),t("p",X,s(y.event.location),1)])):n("",!0)]),t("div",ee,[v[30]||(v[30]=t("h3",{class:"md3-title-small dinor-text-primary"},"Ajouter √† votre agenda",-1)),t("div",te,[t("button",{onClick:v[1]||(v[1]=(...e)=>y.addToGoogleCalendar&&y.addToGoogleCalendar(...e)),class:"calendar-button google-calendar"},v[28]||(v[28]=[t("span",{class:"material-symbols-outlined"},"event",-1),t("span",{class:"emoji-fallback"},"üìÖ",-1),o(" Google Calendar ")])),t("button",{onClick:v[2]||(v[2]=(...e)=>y.addToIcal&&y.addToIcal(...e)),class:"calendar-button ical"},v[29]||(v[29]=[t("span",{class:"material-symbols-outlined"},"calendar_month",-1),t("span",{class:"emoji-fallback"},"üóìÔ∏è",-1),o(" iCal / Outlook ")]))])]),y.event.content?(h(),e("div",ae,[v[31]||(v[31]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:y.formatContent(y.event.content)},null,8,ne)])):n("",!0),y.event.registration_required?(h(),e("div",se,[v[32]||(v[32]=t("h3",{class:"md3-title-small dinor-text-primary"},"Inscription",-1)),v[33]||(v[33]=t("p",{class:"md3-body-medium"},[t("span",{class:"material-symbols-outlined dinor-text-secondary"},"info"),t("span",{class:"emoji-fallback dinor-text-secondary"},"‚ÑπÔ∏è"),o(" Inscription requise pour cet √©v√©nement ")],-1)),y.event.max_attendees?(h(),e("div",oe,[t("p",le," Places limit√©es: "+s(y.event.max_attendees)+" personnes maximum ",1)])):n("",!0)])):n("",!0),t("div",re,[t("h2",ie,"Commentaires ("+s(y.comments.length)+")",1),t("div",de,[y.authStore.isAuthenticated?(h(),e("div",me,[t("div",ue,[t("span",ve,"Connect√© en tant que "+s(y.authStore.userName),1),t("button",{onClick:v[4]||(v[4]=e=>y.authStore.logout()),class:"btn-logout"},"D√©connexion")]),l(t("textarea",{"onUpdate:modelValue":v[5]||(v[5]=e=>y.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[r,y.newComment]]),t("button",{onClick:v[6]||(v[6]=(...e)=>y.addComment&&y.addComment(...e)),class:"btn-primary",disabled:!y.newComment.trim()}," Publier ",8,pe)])):(h(),e("div",ce,[v[34]||(v[34]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:v[3]||(v[3]=e=>y.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),y.comments.length?(h(),e("div",ye,[(h(!0),e(i,null,d(y.comments,a=>(h(),e("div",{key:a.id,class:"comment-item"},[t("div",he,[t("div",ge,[t("span",fe,s(a.author_name),1),t("span",be,s(y.formatDate(a.created_at)),1)]),y.canDeleteComment(a)?(h(),e("div",ke,[t("button",{onClick:e=>y.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},v[35]||(v[35]=[t("span",{class:"material-symbols-outlined"},"delete",-1),t("span",{class:"emoji-fallback"},"üóëÔ∏è",-1)]),8,_e)])):n("",!0)]),t("p",Ce,s(a.content),1)]))),128))])):(h(),e("div",De,v[36]||(v[36]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(h(),e("div",we,[v[37]||(v[37]=c('<div class="error-icon" data-v-223341f8><span class="material-symbols-outlined" data-v-223341f8>error</span><span class="emoji-fallback" data-v-223341f8>‚ö†Ô∏è</span></div><h2 class="md3-title-large" data-v-223341f8>√âv√©nement introuvable</h2><p class="md3-body-large dinor-text-gray" data-v-223341f8>L&#39;√©v√©nement demand√© n&#39;existe pas ou a √©t√© supprim√©.</p>',3)),t("div",Ee,[t("button",{onClick:v[7]||(v[7]=(...e)=>y.goBack&&y.goBack(...e)),class:"btn-secondary"},"Retour aux √©v√©nements"),t("button",{onClick:v[8]||(v[8]=(...e)=>y.goHome&&y.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(b,{modelValue:y.showShareModal,"onUpdate:modelValue":v[9]||(v[9]=e=>y.showShareModal=e),"share-data":y.shareData},null,8,["modelValue","share-data"]),a(k,{modelValue:y.showAuthModal,"onUpdate:modelValue":v[10]||(v[10]=e=>y.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-223341f8"]]);export{xe as default};
