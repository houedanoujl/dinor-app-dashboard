import{d as e,e as t,v as a,f as s,t as o,z as n,E as r,G as i,F as l,i as m,D as c,j as d,r as u,b as v,m as p,h as y,o as h}from"./vendor.BeqKZlTx.js";import{u as g,a as f}from"./api.DeptcIQc.js";import{_ as k,S as b,a as C}from"./index.C1mfdDgG.js";import{A as _}from"./AuthModal.CAYITUsz.js";const w={class:"event-detail"},D={class:"md3-main-content"},x={key:0,class:"loading-container"},E={key:1,class:"event-content"},S={key:0,class:"event-hero"},M=["src","alt"],A={class:"event-overlay dinor-gradient-primary"},j={class:"event-badges"},L={key:0,class:"md3-chip event-location"},I={key:1,class:"md3-chip event-category"},F={class:"event-info"},$={class:"event-stats"},R={key:0,class:"stat-item"},T={class:"md3-body-medium"},V={key:1,class:"stat-item"},q={class:"md3-body-medium"},H={key:2,class:"stat-item"},z={class:"md3-body-medium"},B={class:"stat-item"},P={class:"md3-body-medium"},U={class:"stat-item"},G={class:"md3-body-medium"},N={class:"event-details"},Y={class:"detail-item"},O={class:"md3-body-medium"},J={key:0},K={key:1},Q={key:0},W={key:0,class:"detail-item"},X={class:"md3-body-medium"},Z={key:0,class:"event-description"},ee=["innerHTML"],te={key:1,class:"event-registration"},ae={key:0,class:"registration-info"},se={class:"md3-body-small dinor-text-gray"},oe={class:"comments-section"},ne={class:"md3-title-medium dinor-text-primary"},re={class:"add-comment-form"},ie={key:0,class:"auth-prompt"},le={key:1},me={class:"authenticated-user"},ce={class:"user-info"},de=["disabled"],ue={key:0,class:"comments-list"},ve={class:"comment-header"},pe={class:"comment-meta"},ye={class:"comment-author md3-body-medium"},he={class:"comment-date md3-body-small dinor-text-gray"},ge={key:0,class:"comment-actions"},fe=["onClick"],ke={class:"comment-content md3-body-medium"},be={key:1,class:"empty-comments"},Ce={key:2,class:"error-state"},_e={class:"error-actions"};const we=k({name:"EventDetail",emits:["update-header"],components:{ShareModal:b,AuthModal:_},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=y(),s=g(),o=f(),{showShareModal:n,updateOpenGraphTags:r}=C(),i=u(null),l=u([]),m=u(!0),c=u(!1),d=u(!1),h=u(""),k=u(!1),b=v(()=>i.value?{title:i.value.title,text:`Ne manquez pas cet √©v√©nement : ${i.value.title}`,url:window.location.href,image:i.value.image,type:"event",id:i.value.id}:{}),_=async()=>{try{console.log("üîÑ [Comments] Chargement des commentaires pour event ID:",e.id);const t=await s.get("/comments",{commentable_type:"App\\Models\\Event",commentable_id:e.id});console.log("üì• [Comments] R√©ponse re√ßue:",t),t.success&&(l.value=t.data,console.log("‚úÖ [Comments] Commentaires charg√©s:",l.value.length,"commentaires"))}catch(t){console.error("‚ùå [Comments] Erreur lors du chargement des commentaires:",t)}},w=async()=>{try{console.log("üîÑ [Comments] Rechargement FRAIS des commentaires pour event ID:",e.id);const t=await s.getFresh("/comments",{commentable_type:"App\\Models\\Event",commentable_id:e.id});console.log("üì• [Comments] R√©ponse fra√Æche re√ßue:",t),t.success&&(l.value=t.data,console.log("‚úÖ [Comments] Commentaires frais charg√©s:",l.value.length,"commentaires"))}catch(t){console.error("‚ùå [Comments] Erreur lors du rechargement frais des commentaires:",t)}},D=async()=>{try{const t=await s.get("/likes/check",{type:"event",id:e.id});c.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la v√©rification du like:",t)}},x=async()=>{try{const t=await s.get("/favorites/check",{type:"event",id:e.id});d.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la v√©rification du favori:",t)}};return p(()=>{(async()=>{try{const a=await s.get(`/events/${e.id}`);a.success&&(i.value=a.data,await _(),await D(),await x(),r(b.value),t("update-header",{title:i.value.title||"√âv√©nement",showShare:!0,showLike:!0,isLiked:c.value,backPath:"/events"}))}catch(a){console.error("Erreur lors du chargement de l'√©v√©nement:",a)}finally{m.value=!1}})()}),{event:i,comments:l,loading:m,userLiked:c,userFavorited:d,newComment:h,toggleLike:async()=>{try{const a=await s.post("/likes/toggle",{likeable_type:"event",likeable_id:e.id});a.success&&(c.value=!c.value,i.value&&(i.value.likes_count=a.data.total_likes),t("update-header",{isLiked:c.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await s.post("/favorites/toggle",{favoritable_type:"event",favoritable_id:e.id});a.success&&(d.value=!d.value,i.value&&(i.value.favorites_count=a.data.total_favorites),t("update-header",{isFavorited:d.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(h.value.trim())if(o.isAuthenticated)try{const t={commentable_type:"App\\Models\\Event",commentable_id:parseInt(e.id),content:h.value};console.log("üìù [Comments] Envoi du commentaire:",t);(await s.post("/comments",t)).success&&(console.log("‚úÖ [Comments] Commentaire ajout√© avec succ√®s"),await w(),h.value="")}catch(t){console.error("‚ùå [Comments] Erreur lors de l'ajout du commentaire:",t),t.message.includes("401")&&(k.value=!0)}else k.value=!0},canDeleteComment:e=>{var t;return!!o.isAuthenticated&&!(!e.user_id||e.user_id!==(null==(t=o.user)?void 0:t.id))},deleteComment:async e=>{if(confirm("√ätes-vous s√ªr de vouloir supprimer ce commentaire ?"))try{console.log("üóëÔ∏è [Comments] Suppression du commentaire ID:",e);(await s.request(`/comments/${e}`,{method:"DELETE"})).success&&(console.log("‚úÖ [Comments] Commentaire supprim√© avec succ√®s"),await w())}catch(t){console.error("‚ùå [Comments] Erreur lors de la suppression du commentaire:",t),alert("Erreur lors de la suppression du commentaire")}},goBack:()=>{a.push("/events")},goHome:()=>{a.push("/")},formatEventDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}):"",formatEventDateDetailed:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",formatTime:e=>{if(!e)return"";if(e.match(/^\d{2}:\d{2}$/))return e;try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return e}},formatCommentDate:e=>{if(!e)return"";const t=new Date,a=new Date(e),s=t-a,o=Math.floor(s/864e5),n=Math.floor(s/36e5),r=Math.floor(s/6e4);return r<1?"√Ä l'instant":r<60?`Il y a ${r} min`:n<24?`Il y a ${n} h`:o<7?`Il y a ${o} jour${o>1?"s":""}`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:a.getFullYear()!==t.getFullYear()?"numeric":void 0})},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR"):"",handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>√âtape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",showShareModal:n,shareData:b,authStore:o,showAuthModal:k}}},[["render",function(u,v,p,y,g,f){const k=d("ShareModal"),b=d("AuthModal");return h(),e("div",w,[t("main",D,[y.loading?(h(),e("div",x,v[9]||(v[9]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'√©v√©nement...",-1)]))):y.event?(h(),e("div",E,[y.event.image?(h(),e("div",S,[t("img",{src:y.event.image||"/images/default-recipe.jpg",alt:y.event.title,class:"event-hero-image",onError:v[0]||(v[0]=(...e)=>y.handleImageError&&y.handleImageError(...e))},null,40,M),t("div",A,[t("div",j,[y.event.location?(h(),e("div",L,[v[10]||(v[10]=t("span",{class:"material-symbols-outlined"},"location_on",-1)),v[11]||(v[11]=t("span",{class:"emoji-fallback"},"üìç",-1)),t("span",null,o(y.event.location),1)])):s("",!0),y.event.category?(h(),e("div",I,[v[12]||(v[12]=t("span",{class:"material-symbols-outlined"},"tag",-1)),v[13]||(v[13]=t("span",{class:"emoji-fallback"},"üè∑Ô∏è",-1)),t("span",null,o(y.event.category.name),1)])):s("",!0)])])])):s("",!0),t("div",F,[t("div",$,[y.event.start_date?(h(),e("div",R,[v[14]||(v[14]=t("i",{class:"material-icons dinor-text-secondary"},"event",-1)),t("span",T,o(y.formatEventDate(y.event.start_date)),1)])):s("",!0),y.event.start_time?(h(),e("div",V,[v[15]||(v[15]=t("i",{class:"material-icons dinor-text-secondary"},"schedule",-1)),t("span",q,o(y.formatTime(y.event.start_time)),1)])):s("",!0),y.event.location?(h(),e("div",H,[v[16]||(v[16]=t("i",{class:"material-icons dinor-text-secondary"},"place",-1)),t("span",z,o(y.event.location),1)])):s("",!0),t("div",B,[v[17]||(v[17]=t("i",{class:"material-icons dinor-text-secondary"},"favorite",-1)),t("span",P,o(y.event.likes_count||0),1)]),t("div",U,[v[18]||(v[18]=t("i",{class:"material-icons dinor-text-secondary"},"comment",-1)),t("span",G,o(y.event.comments_count||0),1)])]),t("div",N,[t("div",Y,[v[19]||(v[19]=t("h3",{class:"md3-title-small dinor-text-primary"},"Date et Heure",-1)),t("p",O,[n(o(y.formatEventDateDetailed(y.event.start_date))+" ",1),y.event.start_time?(h(),e("span",J," √† "+o(y.formatTime(y.event.start_time)),1)):s("",!0),y.event.end_date&&y.event.end_date!==y.event.start_date?(h(),e("span",K,[n(" - "+o(y.formatEventDateDetailed(y.event.end_date))+" ",1),y.event.end_time?(h(),e("span",Q," √† "+o(y.formatTime(y.event.end_time)),1)):s("",!0)])):s("",!0)])]),y.event.location?(h(),e("div",W,[v[20]||(v[20]=t("h3",{class:"md3-title-small dinor-text-primary"},"Lieu",-1)),t("p",X,o(y.event.location),1)])):s("",!0)]),y.event.content?(h(),e("div",Z,[v[21]||(v[21]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:y.formatContent(y.event.content)},null,8,ee)])):s("",!0),y.event.registration_required?(h(),e("div",te,[v[22]||(v[22]=t("h3",{class:"md3-title-small dinor-text-primary"},"Inscription",-1)),v[23]||(v[23]=t("p",{class:"md3-body-medium"},[t("span",{class:"material-symbols-outlined dinor-text-secondary"},"info"),t("span",{class:"emoji-fallback dinor-text-secondary"},"‚ÑπÔ∏è"),n(" Inscription requise pour cet √©v√©nement ")],-1)),y.event.max_attendees?(h(),e("div",ae,[t("p",se," Places limit√©es: "+o(y.event.max_attendees)+" personnes maximum ",1)])):s("",!0)])):s("",!0),t("div",oe,[t("h2",ne,"Commentaires ("+o(y.comments.length)+")",1),t("div",re,[y.authStore.isAuthenticated?(h(),e("div",le,[t("div",me,[t("span",ce,"Connect√© en tant que "+o(y.authStore.userName),1),t("button",{onClick:v[2]||(v[2]=e=>y.authStore.logout()),class:"btn-logout"},"D√©connexion")]),r(t("textarea",{"onUpdate:modelValue":v[3]||(v[3]=e=>y.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[i,y.newComment]]),t("button",{onClick:v[4]||(v[4]=(...e)=>y.addComment&&y.addComment(...e)),class:"btn-primary",disabled:!y.newComment.trim()}," Publier ",8,de)])):(h(),e("div",ie,[v[24]||(v[24]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:v[1]||(v[1]=e=>y.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),y.comments.length?(h(),e("div",ue,[(h(!0),e(l,null,m(y.comments,a=>(h(),e("div",{key:a.id,class:"comment-item"},[t("div",ve,[t("div",pe,[t("span",ye,o(a.author_name),1),t("span",he,o(y.formatDate(a.created_at)),1)]),y.canDeleteComment(a)?(h(),e("div",ge,[t("button",{onClick:e=>y.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},v[25]||(v[25]=[t("i",{class:"material-icons"},"delete",-1)]),8,fe)])):s("",!0)]),t("p",ke,o(a.content),1)]))),128))])):(h(),e("div",be,v[26]||(v[26]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(h(),e("div",Ce,[v[27]||(v[27]=c('<div class="error-icon" data-v-67726850><span class="material-symbols-outlined" data-v-67726850>error_outline</span><span class="emoji-fallback" data-v-67726850>‚ö†Ô∏è</span></div><h2 class="md3-title-large" data-v-67726850>√âv√©nement introuvable</h2><p class="md3-body-large dinor-text-gray" data-v-67726850>L&#39;√©v√©nement demand√© n&#39;existe pas ou a √©t√© supprim√©.</p>',3)),t("div",_e,[t("button",{onClick:v[5]||(v[5]=(...e)=>y.goBack&&y.goBack(...e)),class:"btn-secondary"},"Retour aux √©v√©nements"),t("button",{onClick:v[6]||(v[6]=(...e)=>y.goHome&&y.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(k,{modelValue:y.showShareModal,"onUpdate:modelValue":v[7]||(v[7]=e=>y.showShareModal=e),"share-data":y.shareData},null,8,["modelValue","share-data"]),a(b,{modelValue:y.showAuthModal,"onUpdate:modelValue":v[8]||(v[8]=e=>y.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-67726850"]]);export{we as default};
