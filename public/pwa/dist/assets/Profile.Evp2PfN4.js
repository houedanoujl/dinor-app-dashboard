import{d as e,v as s,e as a,f as t,t as o,F as r,i,n as l,z as n,y as c,w as u,j as d,E as m,G as v,D as p,H as f,r as g,b as y,s as b,m as h,h as w,o as k}from"./vendor.BeqKZlTx.js";import{a as F,u as _}from"./api.DeptcIQc.js";import{A as S}from"./AuthModal.BDSOLoMC.js";import{_ as D}from"./index.W0j3SMuK.js";const P={class:"profile"},C={key:0,class:"loading-state"},E={key:1,class:"auth-required"},j={key:2,class:"profile-content"},A={class:"user-info-section"},q={class:"user-details"},M={class:"user-name"},z={class:"user-email"},V={key:0,class:"member-since"},T={class:"profile-navigation"},x=["onClick"],U={class:"material-icons"},N={class:"profile-sections"},I={key:0,class:"section-content"},L={class:"section-header"},R={class:"filter-tabs"},$=["onClick"],G={class:"material-icons"},H={key:0,class:"favorites-list"},J=["onClick"],O={class:"favorite-image"},B=["src","alt"],K={class:"favorite-type-badge"},Q={class:"material-icons"},W={class:"favorite-info"},X={class:"favorite-title"},Y={class:"favorite-description"},Z={class:"favorite-meta"},ee={class:"favorite-date"},se={class:"favorite-stats"},ae={class:"stat"},te={class:"stat"},oe=["onClick"],re={key:1,class:"empty-favorites"},ie={key:1,class:"section-content"},le={class:"form-section"},ne={class:"form-field"},ce={class:"form-actions"},ue=["disabled"],de={key:0},me={key:1},ve={key:2,class:"section-content"},pe={class:"form-section"},fe={class:"form-field"},ge={class:"form-field"},ye={class:"form-field"},be={class:"form-actions"},he=["disabled"],we={key:0},ke={key:1},Fe={key:3,class:"section-content"},_e={class:"form-section danger-section"},Se={class:"form-field"},De={class:"form-field"},Pe={class:"checkbox-label"},Ce={class:"form-actions"},Ee=["disabled"],je={key:0},Ae={key:1},qe={class:"form-section"};const Me=D({name:"Profile",components:{AuthModal:S},setup(){const e=w(),s=F(),a=_(),t=g(!1),o=g(!1),r=g([]),i=g("all"),l=g("favorites"),n=g({name:"",loading:!1,message:"",success:!1}),c=g({currentPassword:"",newPassword:"",confirmPassword:"",loading:!1,message:"",success:!1}),u=g({reason:"",confirm:!1,loading:!1,message:"",success:!1}),d=g([{key:"favorites",label:"Favoris",icon:"favorite"},{key:"account",label:"Compte",icon:"person"},{key:"security",label:"Sécurité",icon:"security"},{key:"legal",label:"Légal",icon:"gavel"}]),m=g([{key:"all",label:"Tout",icon:"apps"},{key:"recipe",label:"Recettes",icon:"restaurant"},{key:"tip",label:"Astuces",icon:"lightbulb"},{key:"event",label:"Événements",icon:"event"},{key:"dinor_tv",label:"Vidéos",icon:"play_circle"}]),v=y(()=>r.value.length),p=y(()=>{const e={};return r.value.forEach(s=>{const a="dinor_tv"===s.type?"videos":`${s.type}s`;e[a]=(e[a]||0)+1}),e}),f=y(()=>"all"===i.value?r.value:r.value.filter(e=>e.type===i.value)),k=async()=>{if(s.isAuthenticated){t.value=!0;try{const e=await a.get("/favorites");e.success&&(r.value=e.data)}catch(e){console.error("Erreur lors du chargement des favoris:",e)}finally{t.value=!1}}};return b(()=>s.isAuthenticated,e=>{e?k():r.value=[]},{immediate:!0}),h(()=>{var e,a;s.isAuthenticated&&(k(),n.value.name=(null==(e=s.user)?void 0:e.name)||"",console.log("🔍 [Profile] Données utilisateur:",s.user),console.log("🔍 [Profile] Date création:",null==(a=s.user)?void 0:a.created_at))}),{loading:t,showAuthModal:o,favorites:r,selectedFilter:i,activeSection:l,profileSections:d,filterTabs:m,totalFavorites:v,favoritesStats:p,filteredFavorites:f,authStore:s,usernameForm:n,passwordForm:c,deletionForm:u,removeFavorite:async e=>{if(confirm("Êtes-vous sûr de vouloir retirer cet élément de vos favoris ?"))try{(await a.request(`/favorites/${e.id}`,{method:"DELETE"})).success&&(r.value=r.value.filter(s=>s.id!==e.id))}catch(s){console.error("Erreur lors de la suppression du favori:",s),alert("Erreur lors de la suppression du favori")}},goToContent:s=>{const a={recipe:`/recipe/${s.content.id}`,tip:`/tip/${s.content.id}`,event:`/event/${s.content.id}`,dinor_tv:"/dinor-tv"}[s.type];a&&e.push(a)},getTypeIcon:e=>({recipe:"restaurant",tip:"lightbulb",event:"event",dinor_tv:"play_circle"}[e]||"star"),getDefaultImage:e=>({recipe:"/images/default-recipe.jpg",tip:"/images/default-tip.jpg",event:"/images/default-event.jpg",dinor_tv:"/images/default-video.jpg"}[e]||"/images/default-content.jpg"),getShortDescription:e=>e?e.length>100?e.substring(0,100)+"...":e:"",getEmptyMessage:()=>({all:"Aucun favori pour le moment",recipe:"Aucune recette favorite",tip:"Aucune astuce favorite",event:"Aucun événement favori",dinor_tv:"Aucune vidéo favorite"}[i.value]||"Aucun favori"),getEmptyDescription:()=>({all:"Ajoutez du contenu à vos favoris en cliquant sur l'icône cœur",recipe:"Parcourez les recettes et ajoutez vos préférées à vos favoris",tip:"Découvrez des astuces utiles et sauvegardez-les",event:"Trouvez des événements intéressants et ajoutez-les à vos favoris",dinor_tv:"Regardez des vidéos et ajoutez vos préférées à vos favoris"}[i.value]||""),getExploreLink:()=>({all:"/",recipe:"/recipes",tip:"/tips",event:"/events",dinor_tv:"/dinor-tv"}[i.value]||"/"),formatDate:e=>{if(!e)return"";try{const s=new Date(e);return isNaN(s.getTime())?"":s.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}catch(s){return console.warn("Erreur lors du formatage de la date:",s),""}},formatMemberSince:e=>{if(!e)return"Date inconnue";try{const s=new Date(e);return isNaN(s.getTime())?"Date inconnue":s.toLocaleDateString("fr-FR",{year:"numeric",month:"long"})}catch(s){return console.warn("Erreur lors du formatage de la date membre:",s),"Date inconnue"}},handleImageError:e=>{e.target.src="/images/default-content.jpg"},updateUsername:async()=>{var e,t;n.value.loading=!0,n.value.message="";try{const e=await a.request("/profile/name",{method:"PUT",body:{name:n.value.name}});e.success&&(n.value.success=!0,n.value.message="Nom d'utilisateur mis à jour avec succès",s.user.name=e.data.name,n.value.name="")}catch(o){n.value.success=!1,n.value.message=(null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.message)||"Erreur lors de la mise à jour"}finally{n.value.loading=!1}},updatePassword:async()=>{var e,s;if(c.value.newPassword!==c.value.confirmPassword)return c.value.success=!1,void(c.value.message="Les mots de passe ne correspondent pas");c.value.loading=!0,c.value.message="";try{(await a.request("/profile/password",{method:"PUT",body:{current_password:c.value.currentPassword,new_password:c.value.newPassword,new_password_confirmation:c.value.confirmPassword}})).success&&(c.value.success=!0,c.value.message="Mot de passe mis à jour avec succès",c.value.currentPassword="",c.value.newPassword="",c.value.confirmPassword="")}catch(t){c.value.success=!1,c.value.message=(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la mise à jour"}finally{c.value.loading=!1}},requestDataDeletion:async()=>{var e,s;if(confirm("Êtes-vous absolument sûr de vouloir demander la suppression de toutes vos données ? Cette action est irréversible.")){u.value.loading=!0,u.value.message="";try{const e=await a.request("/profile/request-deletion",{method:"POST",body:{reason:u.value.reason,confirm:u.value.confirm}});e.success&&(u.value.success=!0,u.value.message=e.message,u.value.reason="",u.value.confirm=!1)}catch(t){u.value.success=!1,u.value.message=(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la demande"}finally{u.value.loading=!1}}}}}},[["render",function(g,y,b,h,w,F){var _,S;const D=d("router-link"),Me=d("AuthModal");return k(),e("div",P,[h.loading?(k(),e("div",C,y[13]||(y[13]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Chargement du profil...",-1)]))):h.authStore.isAuthenticated?(k(),e("div",j,[a("div",A,[y[17]||(y[17]=a("div",{class:"user-avatar"},[a("i",{class:"material-icons"},"person")],-1)),a("div",q,[a("h1",M,o(h.authStore.userName),1),a("p",z,o(null==(_=h.authStore.user)?void 0:_.email),1),(null==(S=h.authStore.user)?void 0:S.created_at)?(k(),e("p",V,"Membre depuis "+o(h.formatMemberSince(h.authStore.user.created_at)),1)):t("",!0)])]),a("div",T,[(k(!0),e(r,null,i(h.profileSections,s=>(k(),e("button",{key:s.key,onClick:e=>h.activeSection=s.key,class:l(["nav-button",{active:h.activeSection===s.key}])},[a("i",U,o(s.icon),1),a("span",null,o(s.label),1)],10,x))),128))]),a("div",N,["favorites"===h.activeSection?(k(),e("div",I,[a("div",L,[y[18]||(y[18]=a("h2",{class:"section-title"},"Mes Favoris",-1)),a("div",R,[(k(!0),e(r,null,i(h.filterTabs,s=>(k(),e("button",{key:s.key,onClick:e=>h.selectedFilter=s.key,class:l(["filter-tab",{active:h.selectedFilter===s.key}])},[a("i",G,o(s.icon),1),a("span",null,o(s.label),1)],10,$))),128))])]),h.filteredFavorites.length?(k(),e("div",H,[(k(!0),e(r,null,i(h.filteredFavorites,s=>(k(),e("div",{key:s.id,onClick:e=>h.goToContent(s),class:"favorite-item"},[a("div",O,[a("img",{src:s.content.image||h.getDefaultImage(s.type),alt:s.content.title,onError:y[1]||(y[1]=(...e)=>h.handleImageError&&h.handleImageError(...e))},null,40,B),a("div",K,[a("i",Q,o(h.getTypeIcon(s.type)),1)])]),a("div",W,[a("h3",X,o(s.content.title),1),a("p",Y,o(h.getShortDescription(s.content.description)),1),a("div",Z,[a("span",ee," Ajouté "+o(h.formatDate(s.favorited_at)),1),a("div",se,[a("span",ae,[y[19]||(y[19]=a("i",{class:"material-icons"},"favorite",-1)),n(" "+o(s.content.likes_count||0),1)]),a("span",te,[y[20]||(y[20]=a("i",{class:"material-icons"},"comment",-1)),n(" "+o(s.content.comments_count||0),1)])])])]),a("button",{onClick:c(e=>h.removeFavorite(s),["stop"]),class:"remove-favorite",title:"Retirer des favoris"},y[21]||(y[21]=[a("i",{class:"material-icons"},"close",-1)]),8,oe)],8,J))),128))])):(k(),e("div",re,[y[23]||(y[23]=a("div",{class:"empty-icon"},[a("i",{class:"material-icons"},"favorite_border")],-1)),a("h3",null,o(h.getEmptyMessage()),1),a("p",null,o(h.getEmptyDescription()),1),s(D,{to:h.getExploreLink(),class:"btn-secondary"},{default:u(()=>y[22]||(y[22]=[n(" Découvrir du contenu ")])),_:1,__:[22]},8,["to"])]))])):t("",!0),"account"===h.activeSection?(k(),e("div",ie,[y[26]||(y[26]=a("h2",{class:"section-title"},"Mon Compte",-1)),a("div",le,[y[25]||(y[25]=a("h3",{class:"form-title"},"Nom d'utilisateur",-1)),a("form",{onSubmit:y[3]||(y[3]=c((...e)=>h.updateUsername&&h.updateUsername(...e),["prevent"])),class:"update-form"},[a("div",ne,[y[24]||(y[24]=a("label",{class:"form-label"},"Nouveau nom d'utilisateur",-1)),m(a("input",{"onUpdate:modelValue":y[2]||(y[2]=e=>h.usernameForm.name=e),type:"text",class:"form-input",placeholder:"Votre nom d'utilisateur",required:"",minlength:"2",maxlength:"255"},null,512),[[v,h.usernameForm.name]])]),a("div",ce,[a("button",{type:"submit",class:"btn-primary",disabled:h.usernameForm.loading},[h.usernameForm.loading?(k(),e("span",de,"Mise à jour...")):(k(),e("span",me,"Mettre à jour"))],8,ue)]),h.usernameForm.message?(k(),e("div",{key:0,class:l(["form-message",h.usernameForm.success?"success":"error"])},o(h.usernameForm.message),3)):t("",!0)],32)])])):t("",!0),"security"===h.activeSection?(k(),e("div",ve,[y[32]||(y[32]=a("h2",{class:"section-title"},"Sécurité",-1)),a("div",pe,[y[31]||(y[31]=a("h3",{class:"form-title"},"Changer le mot de passe",-1)),a("form",{onSubmit:y[7]||(y[7]=c((...e)=>h.updatePassword&&h.updatePassword(...e),["prevent"])),class:"update-form"},[a("div",fe,[y[27]||(y[27]=a("label",{class:"form-label"},"Mot de passe actuel",-1)),m(a("input",{"onUpdate:modelValue":y[4]||(y[4]=e=>h.passwordForm.currentPassword=e),type:"password",class:"form-input",placeholder:"Votre mot de passe actuel",required:""},null,512),[[v,h.passwordForm.currentPassword]])]),a("div",ge,[y[28]||(y[28]=a("label",{class:"form-label"},"Nouveau mot de passe",-1)),m(a("input",{"onUpdate:modelValue":y[5]||(y[5]=e=>h.passwordForm.newPassword=e),type:"password",class:"form-input",placeholder:"Votre nouveau mot de passe",required:"",minlength:"8"},null,512),[[v,h.passwordForm.newPassword]]),y[29]||(y[29]=a("small",{class:"form-hint"},"Au moins 8 caractères avec lettres et chiffres",-1))]),a("div",ye,[y[30]||(y[30]=a("label",{class:"form-label"},"Confirmer le nouveau mot de passe",-1)),m(a("input",{"onUpdate:modelValue":y[6]||(y[6]=e=>h.passwordForm.confirmPassword=e),type:"password",class:"form-input",placeholder:"Confirmer votre nouveau mot de passe",required:"",minlength:"8"},null,512),[[v,h.passwordForm.confirmPassword]])]),a("div",be,[a("button",{type:"submit",class:"btn-primary",disabled:h.passwordForm.loading},[h.passwordForm.loading?(k(),e("span",we,"Mise à jour...")):(k(),e("span",ke,"Changer le mot de passe"))],8,he)]),h.passwordForm.message?(k(),e("div",{key:0,class:l(["form-message",h.passwordForm.success?"success":"error"])},o(h.passwordForm.message),3)):t("",!0)],32)])])):t("",!0),"legal"===h.activeSection?(k(),e("div",Fe,[y[40]||(y[40]=p('<h2 class="section-title" data-v-64b5af64>Légal &amp; Confidentialité</h2><div class="legal-section" data-v-64b5af64><h3 class="form-title" data-v-64b5af64>Conditions d&#39;utilisation</h3><div class="legal-links" data-v-64b5af64><a href="/terms" class="legal-link" data-v-64b5af64><i class="material-icons" data-v-64b5af64>description</i><span data-v-64b5af64>Conditions générales d&#39;utilisation</span><i class="material-icons" data-v-64b5af64>arrow_forward_ios</i></a><a href="/privacy" class="legal-link" data-v-64b5af64><i class="material-icons" data-v-64b5af64>privacy_tip</i><span data-v-64b5af64>Politique de confidentialité</span><i class="material-icons" data-v-64b5af64>arrow_forward_ios</i></a><a href="/cookies" class="legal-link" data-v-64b5af64><i class="material-icons" data-v-64b5af64>cookie</i><span data-v-64b5af64>Politique des cookies</span><i class="material-icons" data-v-64b5af64>arrow_forward_ios</i></a></div></div>',2)),a("div",_e,[y[35]||(y[35]=a("h3",{class:"form-title danger-title"},"Suppression des données",-1)),y[36]||(y[36]=a("p",{class:"danger-description"}," Vous pouvez demander la suppression de toutes vos données personnelles conformément au RGPD. Cette action est irréversible. ",-1)),a("form",{onSubmit:y[10]||(y[10]=c((...e)=>h.requestDataDeletion&&h.requestDataDeletion(...e),["prevent"])),class:"update-form"},[a("div",Se,[y[33]||(y[33]=a("label",{class:"form-label"},"Raison de la suppression (optionnel)",-1)),m(a("textarea",{"onUpdate:modelValue":y[8]||(y[8]=e=>h.deletionForm.reason=e),class:"form-textarea",placeholder:"Expliquez pourquoi vous souhaitez supprimer vos données...",rows:"3",maxlength:"500"},null,512),[[v,h.deletionForm.reason]])]),a("div",De,[a("label",Pe,[m(a("input",{"onUpdate:modelValue":y[9]||(y[9]=e=>h.deletionForm.confirm=e),type:"checkbox",required:""},null,512),[[f,h.deletionForm.confirm]]),y[34]||(y[34]=n(" Je confirme vouloir supprimer définitivement toutes mes données "))])]),a("div",Ce,[a("button",{type:"submit",class:"btn-danger",disabled:h.deletionForm.loading||!h.deletionForm.confirm},[h.deletionForm.loading?(k(),e("span",je,"Demande en cours...")):(k(),e("span",Ae,"Demander la suppression"))],8,Ee)]),h.deletionForm.message?(k(),e("div",{key:0,class:l(["form-message",h.deletionForm.success?"success":"error"])},o(h.deletionForm.message),3)):t("",!0)],32)]),a("div",qe,[y[38]||(y[38]=a("h3",{class:"form-title"},"Déconnexion",-1)),y[39]||(y[39]=a("p",{class:"form-description"}," Vous serez déconnecté de votre compte sur cet appareil. ",-1)),a("button",{onClick:y[11]||(y[11]=e=>h.authStore.logout()),class:"btn-logout-main"},y[37]||(y[37]=[a("i",{class:"material-icons"},"logout",-1),a("span",null,"Se déconnecter",-1)]))])])):t("",!0)])])):(k(),e("div",E,[y[14]||(y[14]=a("div",{class:"auth-icon"},[a("i",{class:"material-icons"},"person")],-1)),y[15]||(y[15]=a("h2",{class:"md3-title-large"},"Profil utilisateur",-1)),y[16]||(y[16]=a("p",{class:"md3-body-large"},"Connectez-vous pour voir votre profil et vos favoris",-1)),a("button",{onClick:y[0]||(y[0]=e=>h.showAuthModal=!0),class:"btn-primary"}," Se connecter ")])),s(Me,{modelValue:h.showAuthModal,"onUpdate:modelValue":y[12]||(y[12]=e=>h.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-64b5af64"]]);export{Me as default};
