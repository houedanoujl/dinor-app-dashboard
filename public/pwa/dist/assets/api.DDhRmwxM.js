import{k as e,f as t}from"./vendor.CHp--hJi.js";const n=e("cache",()=>{const e=t(new Map),n=t(new Map),a=t(3e5);function o(t){const a=n.value.get(t);return!a||Date.now()>a?(e.value.delete(t),n.value.delete(t),null):e.value.get(t)}function r(){const t=Date.now();for(const[a,o]of n.value.entries())t>o&&(e.value.delete(a),n.value.delete(a))}return setInterval(r,3e4),{defaultTTL:a,set:function(t,o,r=a.value){e.value.set(t,o),n.value.set(t,Date.now()+r)},get:o,has:function(e){return null!==o(e)},remove:function(t){e.value.delete(t),n.value.delete(t)},clear:function(){e.value.clear(),n.value.clear()},clearExpired:r,getCacheInfo:function(){return{size:e.value.size,keys:Array.from(e.value.keys()),expired:Array.from(n.value.entries()).filter(([,e])=>Date.now()>e).map(([e])=>e)}}}}),a=e("api",()=>{const e=t(new Set),a=t(new Map),o=t(`${window.location.origin}/api/v1`),r=n();function c(t,n){n?e.value.add(t):e.value.delete(t)}function s(e,t){t?a.value.set(e,t):a.value.delete(e)}async function i(e,t={}){const n=`${e}_${JSON.stringify(t)}`;if(!t.method||"GET"===t.method){const n=await async function(e,t={}){try{const n=u(e);if(!n)return null;const a=l(t),o=await fetch("/api/pwa/cache/get",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:n,params:a})});if(o.ok){const e=await o.json();if(e.success)return e.data}}catch(n){console.warn("Erreur cache PWA get:",n)}return null}(e,t);if(n)return n}c(n,!0),s(n,null);try{const n=`${o.value}${e}`,a={headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...t.headers},...t},r=await fetch(n,a);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();return t.method&&"GET"!==t.method||await async function(e,t,n={}){try{const a=u(e);if(!a)return;const o=l(n);await fetch("/api/pwa/cache/set",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:a,data:t,params:o})})}catch(a){console.warn("Erreur cache PWA set:",a)}}(e,c,t),c}catch(a){throw s(n,a.message),a}finally{c(n,!1)}}function u(e){return e.includes("/recipes")?"recipes":e.includes("/tips")?"tips":e.includes("/events")?"events":e.includes("/dinor-tv")?"videos":e.includes("/categories")?"categories":null}function l(e){const t=new URL(`http://example.com${e.url||""}`),n={};for(const[a,o]of t.searchParams)n[a]=o;return n}async function d(e,t={},n={}){const a=new URLSearchParams(t).toString();return i(a?`${e}?${a}`:e,{...n,method:"GET"})}return{loading:e,errors:a,baseURL:o,isLoading:function(t){return e.value.has(t)},getError:function(e){return a.value.get(e)},setLoading:c,setError:s,clearError:function(e){a.value.delete(e)},request:i,get:d,post:async function(e,t,n={}){return i(e,{...n,method:"POST",body:JSON.stringify(t)})},put:async function(e,t,n={}){return i(e,{...n,method:"PUT",body:JSON.stringify(t)})},del:async function(e,t={}){return i(e,{...t,method:"DELETE"})},invalidateCache:function(e){r.getCacheInfo().keys.filter(t=>t.includes(e)||new RegExp(e).test(t)).forEach(e=>r.remove(e))},preload:async function(e){const t=e.map(({endpoint:e,params:t,options:n})=>d(e,t,{...n,priority:"low"}).catch(()=>null));return Promise.allSettled(t)}}});export{a as u};
