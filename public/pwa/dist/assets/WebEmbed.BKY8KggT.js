import{b as e,p as a,d as r,w as o,i as s,t as n,f as t,m as l,h as c,u as i,o as u}from"./vendor.CHp--hJi.js";import{a as d}from"./useApi.Dk2EtGCI.js";import{_ as m,A as g}from"./index.B8aG9rpS.js";import"./api.DDhRmwxM.js";const v={class:"web-embed"},p={class:"md3-main-content"},b={key:0,class:"loading-container"},f={key:1,class:"error-state"},w={class:"md3-body-large dinor-text-gray"},h={class:"error-actions"},y={key:2,class:"iframe-container"},k=["src"];const I=m({name:"WebEmbed",components:{AppHeader:g},setup(){const e=i(),a=c(),{request:r}=d(),o=t(null),s=t(!0),n=t(!1),u=t(""),m=t("Page Web"),g=t(null),v=t(""),p=async()=>{try{s.value=!0,n.value=!1;const e=await r("/pages/latest");if(!e.success||!e.data)throw new Error(e.message||"Aucune page disponible");{g.value=e.data,m.value=e.data.title||"Page Web";const a=e.data.embed_url||e.data.url;if(!a)throw new Error("Aucune URL disponible pour cette page");v.value=a}}catch(e){n.value=!0,u.value=e.message||"Erreur lors du chargement de la page",s.value=!1}},b=()=>{o.value&&v.value?(s.value=!0,n.value=!1,o.value.src=v.value):p()};return l(async()=>{const e=(()=>{const e=a.query.url;if(!e)return"";try{return new URL(decodeURIComponent(e)),decodeURIComponent(e)}catch(r){return n.value=!0,u.value="URL invalide fournie",""}})();e?(v.value=e,m.value="Page Web"):await p(),setTimeout(()=>{s.value&&(s.value=!1,n.value=!0,u.value="Délai de chargement dépassé")},15e3)}),{webFrame:o,loading:s,error:n,errorMessage:u,pageTitle:m,embedUrl:v,currentPage:g,onIframeLoad:()=>{s.value=!1,n.value=!1;try{if(o.value&&o.value.contentDocument){const e=o.value.contentDocument.title;e&&(m.value=e)}}catch(e){console.log("Impossible de récupérer le titre (CORS):",e.message)}},onIframeError:()=>{s.value=!1,n.value=!0,u.value="Impossible de charger la page demandée. Vérifiez que l'URL est correcte et accessible."},refreshPage:b,retryLoad:()=>{b()},openInNewTab:()=>{v.value&&window.open(v.value,"_blank","noopener,noreferrer")},goBack:()=>{e.go(-1)},loadLatestPage:p}}},[["render",function(t,l,c,i,d,m){const g=s("AppHeader");return u(),e("div",v,[a(g,{title:i.pageTitle,"show-like":!1,"show-share":!1,onBack:i.goBack},{actions:o(()=>[r("button",{onClick:l[0]||(l[0]=(...e)=>i.refreshPage&&i.refreshPage(...e)),class:"md3-icon-button"},l[6]||(l[6]=[r("i",{class:"material-icons"},"refresh",-1)])),r("button",{onClick:l[1]||(l[1]=(...e)=>i.openInNewTab&&i.openInNewTab(...e)),class:"md3-icon-button"},l[7]||(l[7]=[r("i",{class:"material-icons"},"open_in_new",-1)]))]),_:1},8,["title","onBack"]),r("main",p,[i.loading?(u(),e("div",b,l[8]||(l[8]=[r("div",{class:"md3-circular-progress"},null,-1),r("p",{class:"md3-body-large"},"Chargement de la page...",-1)]))):i.error?(u(),e("div",f,[l[9]||(l[9]=r("div",{class:"error-icon"},[r("i",{class:"material-icons"},"error_outline")],-1)),l[10]||(l[10]=r("h2",{class:"md3-title-large"},"Erreur de chargement",-1)),r("p",w,n(i.errorMessage),1),r("div",h,[r("button",{onClick:l[2]||(l[2]=(...e)=>i.retryLoad&&i.retryLoad(...e)),class:"btn-primary"},"Réessayer"),r("button",{onClick:l[3]||(l[3]=(...e)=>i.goBack&&i.goBack(...e)),class:"btn-secondary"},"Retour")])])):(u(),e("div",y,[r("iframe",{ref:"webFrame",src:i.embedUrl,class:"web-iframe",title:"Page Web Intégrée",frameborder:"0",allowfullscreen:"",onLoad:l[4]||(l[4]=(...e)=>i.onIframeLoad&&i.onIframeLoad(...e)),onError:l[5]||(l[5]=(...e)=>i.onIframeError&&i.onIframeError(...e))},null,40,k)]))])])}],["__scopeId","data-v-4199b89b"]]);export{I as default};
