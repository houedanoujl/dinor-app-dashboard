import{k as e,f as s,l as t,b as a,p as l,d as r,i,t as c,e as n,y as o,F as u,g as d,m as p,z as y,u as v,o as f}from"./vendor.CHp--hJi.js";import{a as g}from"./api.XOCQ1Ma4.js";import{_ as h,u as m}from"./index.B8aG9rpS.js";import{B as k,u as b}from"./BannerSection.BD0Jy8Nq.js";import{S as _}from"./SearchAndFilters.CjayWb-X.js";import"./useApi.Dk2EtGCI.js";import"./api.DDhRmwxM.js";const C=e("recipes",()=>{const e=s([]),a=s(null),l=s(!1),r=s(null),i=s(""),c=s(null),n=s({current_page:1,last_page:1,per_page:12,total:0}),o=t(()=>{let s=e.value;if(i.value){const e=i.value.toLowerCase();s=s.filter(s=>{var t,a;return s.title.toLowerCase().includes(e)||(null==(t=s.short_description)?void 0:t.toLowerCase().includes(e))||(null==(a=s.tags)?void 0:a.some(s=>s.toLowerCase().includes(e)))})}return c.value&&(s=s.filter(e=>e.category_id===c.value)),s}),u=t(()=>e.value.filter(e=>e.is_featured));return{recipes:e,currentRecipe:a,loading:l,error:r,searchQuery:i,selectedCategory:c,pagination:n,filteredRecipes:o,featuredRecipes:u,fetchRecipes:async function(s={}){l.value=!0,r.value=null;try{const t=await g.getRecipes(s);if(!t.success)throw new Error(t.message||"Failed to fetch recipes");e.value=t.data,t.meta&&(n.value=t.meta)}catch(t){r.value=t.message,console.error("Error fetching recipes:",t)}finally{l.value=!1}},fetchRecipe:async function(e){l.value=!0,r.value=null;try{const s=await g.getRecipe(e);if(!s.success)throw new Error(s.message||"Failed to fetch recipe");a.value=s.data}catch(s){r.value=s.message,console.error("Error fetching recipe:",s)}finally{l.value=!1}},toggleLike:async function(s){try{const t=await g.toggleLike("recipes",s);if(t.success){const l=e.value.find(e=>e.id===s);return l&&(l.is_liked=t.data.is_liked,l.likes_count=t.data.likes_count),a.value&&a.value.id===s&&(a.value.is_liked=t.data.is_liked,a.value.likes_count=t.data.likes_count),t.data}}catch(t){return console.error("Error toggling like:",t),{success:!1}}},setSearchQuery:function(e){i.value=e},setSelectedCategory:function(e){c.value=e},clearFilters:function(){i.value="",c.value=null},clearCurrentRecipe:function(){a.value=null},clearError:function(){r.value=null}}}),F={class:"recipes-list"},R={key:0,class:"loading-state"},A={key:1,class:"error-state"},Q={key:2,class:"content"},w={key:0,class:"results-info"},L={key:0},S={key:1,class:"empty-state"},E={key:0},j={key:1},B={key:2,class:"recipes-grid"},T=["onClick"],z={class:"recipe-image"},D=["src","alt"],U={class:"recipe-overlay"},x={class:"recipe-meta"},M={key:0,class:"time"},q={key:1,class:"difficulty"},I={class:"recipe-content"},N={class:"recipe-title"},O={key:0,class:"recipe-description"},P={class:"recipe-stats"},W={class:"stat"},$={key:0,class:"stat"};const G=h({name:"RecipesList",components:{BannerSection:k,SearchAndFilters:_},setup(){const e=v(),a=C(),l=m(),{loadBannersByType:r}=b(),i=s([]),c=t({get:()=>a.searchQuery,set:e=>a.setSearchQuery(e)}),n=t({get:()=>a.selectedCategory,set:e=>a.setSelectedCategory(e)}),o=t(()=>a.loading),u=t(()=>a.error),d=t(()=>a.filteredRecipes),f=t(()=>[]),g=s({}),h=t(()=>Object.values(g.value).some(e=>null!==e)),k=async()=>{await a.fetchRecipes()};return p(()=>{k(),(async()=>{try{const e=await r("recipes");i.value=e}catch(e){console.error("Error loading banners:",e)}})(),l.initializePWAListeners(),l.initializeNetworkListeners()}),y(c,e=>{}),{searchQuery:c,selectedCategory:n,loading:o,error:u,filteredRecipes:d,categories:f,bannersByType:i,selectedFilters:g,recipeFilters:[{key:"difficulty",label:"Difficulté",icon:"star",allLabel:"Tous niveaux",options:[{value:"easy",label:"Facile"},{value:"medium",label:"Moyen"},{value:"hard",label:"Difficile"}]},{key:"prep_time",label:"Temps de préparation",icon:"schedule",allLabel:"Tous temps",options:[{value:"quick",label:"< 30 min"},{value:"medium",label:"30-60 min"},{value:"long",label:"> 60 min"}]}],hasActiveFilters:h,goToRecipe:s=>{e.push(`/recipe/${s}`)},clearSearch:()=>{c.value=""},setSelectedCategory:e=>{n.value=e},updateAdditionalFilter:({key:e,value:s})=>{g.value[e]=s},clearAllFilters:()=>{c.value="",n.value=null,g.value={}},retry:()=>{a.clearError(),k()},getDifficultyLabel:e=>({easy:"Facile",medium:"Moyen",hard:"Difficile"}[e]||e)}}},[["render",function(e,s,t,p,y,v){const g=i("BannerSection"),h=i("SearchAndFilters");return f(),a("div",F,[l(g,{type:"recipes",section:"hero",banners:p.bannersByType},null,8,["banners"]),s[10]||(s[10]=r("header",{class:"page-header"},[r("div",{class:"header-content"},[r("h1",null,"Recettes"),r("p",{class:"subtitle"},"Découvrez nos délicieuses recettes")])],-1)),l(h,{searchQuery:p.searchQuery,"onUpdate:searchQuery":s[0]||(s[0]=e=>p.searchQuery=e),selectedCategory:p.selectedCategory,"onUpdate:selectedCategory":s[1]||(s[1]=e=>p.selectedCategory=e),"search-placeholder":"Rechercher une recette...",categories:p.categories,"additional-filters":p.recipeFilters,"selected-filters":p.selectedFilters,"results-count":p.filteredRecipes.length,"item-type":"recette","onUpdate:additionalFilter":p.updateAdditionalFilter},null,8,["searchQuery","selectedCategory","categories","additional-filters","selected-filters","results-count","onUpdate:additionalFilter"]),p.loading?(f(),a("div",R,s[4]||(s[4]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Chargement des recettes...",-1)]))):p.error?(f(),a("div",A,[s[5]||(s[5]=r("div",{class:"error-icon"},[r("span",{class:"material-symbols-outlined"},"error")],-1)),r("p",null,c(p.error),1),r("button",{onClick:s[2]||(s[2]=(...e)=>p.retry&&p.retry(...e)),class:"retry-btn"}," Réessayer ")])):(f(),a("div",Q,[p.filteredRecipes.length?(f(),a("div",w,[o(c(p.filteredRecipes.length)+" recette"+c(p.filteredRecipes.length>1?"s":"")+" ",1),p.searchQuery?(f(),a("span",L,' pour "'+c(p.searchQuery)+'"',1)):n("",!0)])):n("",!0),p.filteredRecipes.length||p.loading?(f(),a("div",B,[(f(!0),a(u,null,d(p.filteredRecipes,e=>(f(),a("article",{key:e.id,onClick:s=>p.goToRecipe(e.id),class:"recipe-card"},[r("div",z,[r("img",{src:e.featured_image_url||"/images/default-recipe.jpg",alt:e.title,loading:"lazy"},null,8,D),r("div",U,[r("div",x,[e.preparation_time?(f(),a("span",M,[s[7]||(s[7]=r("span",{class:"material-symbols-outlined"},"schedule",-1)),o(" "+c(e.preparation_time)+"min ",1)])):n("",!0),e.difficulty?(f(),a("span",q,c(p.getDifficultyLabel(e.difficulty)),1)):n("",!0)])])]),r("div",I,[r("h3",N,c(e.title),1),e.short_description?(f(),a("p",O,c(e.short_description),1)):n("",!0),r("div",P,[r("div",W,[s[8]||(s[8]=r("span",{class:"material-symbols-outlined"},"favorite",-1)),r("span",null,c(e.likes_count||0),1)]),e.servings?(f(),a("div",$,[s[9]||(s[9]=r("span",{class:"material-symbols-outlined"},"group",-1)),r("span",null,c(e.servings),1)])):n("",!0)])])],8,T))),128))])):(f(),a("div",S,[s[6]||(s[6]=r("div",{class:"empty-icon"},[r("span",{class:"material-symbols-outlined"},"restaurant")],-1)),r("h3",null,c(p.searchQuery||p.selectedCategory||p.hasActiveFilters?"Aucune recette trouvée":"Aucune recette disponible"),1),p.searchQuery||p.selectedCategory||p.hasActiveFilters?(f(),a("p",E," Essayez de modifier vos critères de recherche. ")):(f(),a("p",j," Les recettes seront bientôt disponibles. ")),p.searchQuery||p.selectedCategory||p.hasActiveFilters?(f(),a("button",{key:2,onClick:s[3]||(s[3]=(...e)=>p.clearAllFilters&&p.clearAllFilters(...e)),class:"clear-filters-btn"}," Effacer tous les filtres ")):n("",!0)]))]))])}],["__scopeId","data-v-ccbb0ca3"]]);export{G as default};
