import{b as e,p as t,d as a,i as s,e as i,j as o,t as n,F as r,g as l,D as c,E as d,f as m,m as p,u,h as g,o as y}from"./vendor.CHp--hJi.js";import{u as v}from"./api.DDhRmwxM.js";import{_ as h,A as k}from"./index.B8aG9rpS.js";import{B as b}from"./Badge.BDl1NHcF.js";const f={class:"tip-detail"},x={class:"md3-main-content"},w={key:0,class:"loading-container"},_={key:1,class:"tip-content"},C={key:0,class:"tip-hero"},L=["src","alt"],j={class:"tip-overlay dinor-gradient-primary"},A={class:"tip-badges"},B={class:"tip-info"},D={class:"tip-stats"},E={class:"stat-item"},H={class:"md3-body-medium"},T={class:"stat-item"},I={class:"md3-body-medium"},S={class:"stat-item"},$={class:"md3-body-medium"},z={class:"tip-content-text"},F=["innerHTML"],M={key:0,class:"tip-tags"},R={class:"tags-container"},U={class:"comments-section"},q={class:"md3-title-medium dinor-text-primary"},P={class:"add-comment-form"},V=["disabled"],G={key:0,class:"comments-list"},J={class:"comment-header"},K={class:"comment-author md3-body-medium"},N={class:"comment-date md3-body-small dinor-text-gray"},O={class:"comment-content md3-body-medium"},Q={key:1,class:"empty-comments"},W={key:2,class:"error-state"},X={class:"error-actions"};const Y=h({name:"TipDetail",components:{AppHeader:k,Badge:b},props:{id:{type:String,required:!0}},setup(e){const t=u();g();const a=v(),s=m(null),i=m([]),o=m(!0),n=m(!1),r=m(""),l=async()=>{try{const t=await a.get("/comments",{type:"tip",id:e.id});t.success&&(i.value=t.data)}catch(t){console.error("Erreur lors du chargement des commentaires:",t)}},c=async()=>{try{const t=await a.get("/likes/check",{type:"tip",id:e.id});n.value=t.success&&t.data.liked}catch(t){console.error("Erreur lors de la vérification du like:",t)}};return p(()=>{(async()=>{try{const t=await a.get(`/tips/${e.id}`);t.success&&(s.value=t.data,await l(),await c())}catch(t){console.error("Erreur lors du chargement de l'astuce:",t)}finally{o.value=!1}})()}),{tip:s,comments:i,loading:o,userLiked:n,newComment:r,toggleLike:async()=>{try{const t=await a.post("/likes/toggle",{likeable_type:"tip",likeable_id:e.id});t.success&&(n.value=!n.value,s.value&&(s.value.likes_count=t.data.total_likes))}catch(t){console.error("Erreur lors du toggle like:",t)}},addComment:async()=>{if(r.value.trim())try{(await a.post("/comments",{type:"tip",id:e.id,content:r.value,author_name:"Utilisateur"})).success&&(await l(),r.value="")}catch(t){console.error("Erreur lors de l'ajout du commentaire:",t)}},shareTip:()=>{navigator.share&&s.value?navigator.share({title:s.value.title,text:s.value.content,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert("Lien copié dans le presse-papiers!"))},goBack:()=>{t.push("/tips")},goHome:()=>{t.push("/")},getDifficultyLabel:e=>({beginner:"Débutant",intermediate:"Intermédiaire",advanced:"Avancé"}[e]||"Débutant"),formatDate:e=>new Date(e).toLocaleDateString("fr-FR"),handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():""}}},[["render",function(m,p,u,g,v,h){var k;const b=s("AppHeader"),Y=s("Badge");return y(),e("div",f,[t(b,{title:(null==(k=g.tip)?void 0:k.title)||"Astuce","show-like":!0,"show-share":!0,"is-liked":g.userLiked,"back-path":"/tips",onLike:g.toggleLike,onShare:g.shareTip,onBack:g.goBack},null,8,["title","is-liked","onLike","onShare","onBack"]),a("main",x,[g.loading?(y(),e("div",w,p[5]||(p[5]=[a("div",{class:"md3-circular-progress"},null,-1),a("p",{class:"md3-body-large"},"Chargement de l'astuce...",-1)]))):g.tip?(y(),e("div",_,[g.tip.image?(y(),e("div",C,[a("img",{src:g.tip.image||"/images/default-recipe.jpg",alt:g.tip.title,class:"tip-hero-image",onError:p[0]||(p[0]=(...e)=>g.handleImageError&&g.handleImageError(...e))},null,40,L),a("div",j,[a("div",A,[g.tip.difficulty_level?(y(),o(Y,{key:0,text:g.getDifficultyLabel(g.tip.difficulty_level),icon:"lightbulb",variant:"secondary",size:"medium"},null,8,["text"])):i("",!0),g.tip.category?(y(),o(Y,{key:1,text:g.tip.category.name,icon:"tag",variant:"neutral",size:"medium"},null,8,["text"])):i("",!0)])])])):i("",!0),a("div",B,[a("div",D,[a("div",E,[p[6]||(p[6]=a("i",{class:"material-icons dinor-text-secondary"},"schedule",-1)),a("span",H,n(g.tip.estimated_time)+"min",1)]),a("div",T,[p[7]||(p[7]=a("i",{class:"material-icons dinor-text-secondary"},"favorite",-1)),a("span",I,n(g.tip.likes_count||0),1)]),a("div",S,[p[8]||(p[8]=a("i",{class:"material-icons dinor-text-secondary"},"comment",-1)),a("span",$,n(g.tip.comments_count||0),1)])]),a("div",z,[p[9]||(p[9]=a("h2",{class:"md3-title-medium dinor-text-primary"},"Astuce",-1)),a("div",{class:"md3-body-large dinor-text-gray",innerHTML:g.formatContent(g.tip.content)},null,8,F)]),g.tip.tags&&g.tip.tags.length?(y(),e("div",M,[p[10]||(p[10]=a("h3",{class:"md3-title-small dinor-text-primary"},"Tags",-1)),a("div",R,[(y(!0),e(r,null,l(g.tip.tags,t=>(y(),e("span",{key:t,class:"md3-chip"},n(t),1))),128))])])):i("",!0),a("div",U,[a("h2",q,"Commentaires ("+n(g.comments.length)+")",1),a("div",P,[c(a("textarea",{"onUpdate:modelValue":p[1]||(p[1]=e=>g.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"              ",512),[[d,g.newComment]]),a("button",{onClick:p[2]||(p[2]=(...e)=>g.addComment&&g.addComment(...e)),class:"btn-primary",disabled:!g.newComment.trim()}," Publier ",8,V)]),g.comments.length?(y(),e("div",G,[(y(!0),e(r,null,l(g.comments,t=>(y(),e("div",{key:t.id,class:"comment-item"},[a("div",J,[a("span",K,n(t.author_name),1),a("span",N,n(g.formatDate(t.created_at)),1)]),a("p",O,n(t.content),1)]))),128))])):(y(),e("div",Q,p[11]||(p[11]=[a("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(y(),e("div",W,[p[12]||(p[12]=a("div",{class:"error-icon"},[a("i",{class:"material-icons"},"error_outline")],-1)),p[13]||(p[13]=a("h2",{class:"md3-title-large"},"Astuce introuvable",-1)),p[14]||(p[14]=a("p",{class:"md3-body-large dinor-text-gray"},"L'astuce demandée n'existe pas ou a été supprimée.",-1)),a("div",X,[a("button",{onClick:p[3]||(p[3]=(...e)=>g.goBack&&g.goBack(...e)),class:"btn-secondary"},"Retour aux astuces"),a("button",{onClick:p[4]||(p[4]=(...e)=>g.goHome&&g.goHome(...e)),class:"btn-primary"},"Accueil")])]))])])}],["__scopeId","data-v-d792f358"]]);export{Y as default};
