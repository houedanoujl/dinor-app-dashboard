import{l as e,r as a,b as s,d as l,v as t,j as i,e as r,t as c,f as n,z as o,F as u,i as d,m as p,s as y,h as v,o as f}from"./vendor.BeqKZlTx.js";import{a as g}from"./api.70uutYeQ.js";import{_ as m,u as h}from"./index.W0j3SMuK.js";import{B as k,u as b}from"./BannerSection.L2GxXlpZ.js";import{S as _}from"./SearchAndFilters.CqR4qwHj.js";import"./useApi.XzjE-Aek.js";import"./api.DeptcIQc.js";const C=e("recipes",()=>{const e=a([]),l=a(null),t=a(!1),i=a(null),r=a(""),c=a(null),n=a({current_page:1,last_page:1,per_page:12,total:0}),o=s(()=>{let a=e.value;if(r.value){const e=r.value.toLowerCase();a=a.filter(a=>{var s,l;return a.title.toLowerCase().includes(e)||(null==(s=a.short_description)?void 0:s.toLowerCase().includes(e))||(null==(l=a.tags)?void 0:l.some(a=>a.toLowerCase().includes(e)))})}return c.value&&(a=a.filter(e=>e.category_id===c.value)),a}),u=s(()=>e.value.filter(e=>e.is_featured));return{recipes:e,currentRecipe:l,loading:t,error:i,searchQuery:r,selectedCategory:c,pagination:n,filteredRecipes:o,featuredRecipes:u,fetchRecipes:async function(a={}){t.value=!0,i.value=null;try{const s=await g.getRecipes(a);if(!s.success)throw new Error(s.message||"Failed to fetch recipes");e.value=s.data,s.meta&&(n.value=s.meta)}catch(s){i.value=s.message,console.error("Error fetching recipes:",s)}finally{t.value=!1}},fetchRecipe:async function(e){t.value=!0,i.value=null;try{const a=await g.getRecipe(e);if(!a.success)throw new Error(a.message||"Failed to fetch recipe");l.value=a.data}catch(a){i.value=a.message,console.error("Error fetching recipe:",a)}finally{t.value=!1}},toggleLike:async function(a){try{const s=await g.toggleLike("recipes",a);if(s.success){const t=e.value.find(e=>e.id===a);return t&&(t.is_liked=s.data.is_liked,t.likes_count=s.data.likes_count),l.value&&l.value.id===a&&(l.value.is_liked=s.data.is_liked,l.value.likes_count=s.data.likes_count),s.data}}catch(s){return console.error("Error toggling like:",s),{success:!1}}},setSearchQuery:function(e){r.value=e},setSelectedCategory:function(e){c.value=e},clearFilters:function(){r.value="",c.value=null},clearCurrentRecipe:function(){l.value=null},clearError:function(){i.value=null}}}),F={class:"recipes-list"},R={key:0,class:"loading-state"},w={key:1,class:"error-state"},L={key:2,class:"content"},j={key:0,class:"results-info"},A={key:0},Q={key:1,class:"empty-state"},T={key:0},S={key:1},E={key:2,class:"recipes-grid"},q=["onClick"],B={class:"recipe-image"},z=["src","alt"],D={class:"recipe-overlay"},U={class:"recipe-meta"},x={key:0,class:"time"},M={key:1,class:"difficulty"},I={class:"recipe-content"},N={class:"recipe-title"},O={key:0,class:"recipe-description"},P={class:"recipe-stats"},W={class:"stat"},$={key:0,class:"stat"},G={key:1,class:"stat equipment"};const H=m({name:"RecipesList",components:{BannerSection:k,SearchAndFilters:_},setup(){const e=v(),l=C(),t=h(),{loadBannersByType:i}=b(),r=a([]),c=a([]),n=s({get:()=>l.searchQuery,set:e=>l.setSearchQuery(e)}),o=s({get:()=>l.selectedCategory,set:e=>l.setSelectedCategory(e)}),u=s(()=>l.loading),d=s(()=>l.error),f=a({}),m=s(()=>{var e;let a=l.recipes;if(null==(e=n.value)?void 0:e.trim()){const e=n.value.toLowerCase();a=a.filter(a=>{var s,l,t;return(null==(s=a.title)?void 0:s.toLowerCase().includes(e))||(null==(l=a.short_description)?void 0:l.toLowerCase().includes(e))||(null==(t=a.tags)?void 0:t.some(a=>a.toLowerCase().includes(e)))})}if(o.value&&(a=a.filter(e=>e.category_id===o.value)),f.value.difficulty&&(a=a.filter(e=>e.difficulty===f.value.difficulty)),f.value.prep_time){const e=f.value.prep_time;a=a.filter(a=>{const s=a.preparation_time||0;return"quick"===e?s<30:"medium"===e?s>=30&&s<=60:"long"!==e||s>60})}return a}),k=s(()=>Object.values(f.value).some(e=>null!==e)),_=async()=>{await l.fetchRecipes()};return p(()=>{_(),(async()=>{try{const e=await i("recipes");r.value=e}catch(e){console.error("Error loading banners:",e)}})(),(async()=>{try{const e=await g.getRecipeCategories();e.success&&(c.value=e.data)}catch(e){console.error("Error loading categories:",e)}})(),t.initializePWAListeners(),t.initializeNetworkListeners()}),y(n,e=>{}),{searchQuery:n,selectedCategory:o,loading:u,error:d,filteredRecipes:m,categories:c,bannersByType:r,selectedFilters:f,recipeFilters:[{key:"difficulty",label:"Difficult√©",icon:"star",allLabel:"Tous niveaux",options:[{value:"easy",label:"Facile"},{value:"medium",label:"Moyen"},{value:"hard",label:"Difficile"}]},{key:"prep_time",label:"Temps de pr√©paration",icon:"schedule",allLabel:"Tous temps",options:[{value:"quick",label:"< 30 min"},{value:"medium",label:"30-60 min"},{value:"long",label:"> 60 min"}]}],hasActiveFilters:k,goToRecipe:a=>{e.push(`/recipe/${a}`)},clearSearch:()=>{n.value=""},setSelectedCategory:e=>{o.value=e},updateAdditionalFilter:({key:e,value:a})=>{f.value[e]=a},clearAllFilters:()=>{n.value="",o.value=null,f.value={}},retry:()=>{l.clearError(),_()},getDifficultyLabel:e=>({easy:"Facile",medium:"Moyen",hard:"Difficile"}[e]||e),getTotalTime:e=>(e.preparation_time||0)+(e.cooking_time||0)+(e.resting_time||0)}}},[["render",function(e,a,s,p,y,v){const g=i("BannerSection"),m=i("SearchAndFilters");return f(),l("div",F,[t(g,{type:"recipes",section:"hero",banners:p.bannersByType},null,8,["banners"]),t(m,{searchQuery:p.searchQuery,"onUpdate:searchQuery":a[0]||(a[0]=e=>p.searchQuery=e),selectedCategory:p.selectedCategory,"onUpdate:selectedCategory":a[1]||(a[1]=e=>p.selectedCategory=e),"search-placeholder":"Rechercher une recette...",categories:p.categories,"additional-filters":p.recipeFilters,"selected-filters":p.selectedFilters,"results-count":p.filteredRecipes.length,"item-type":"recette","onUpdate:additionalFilter":p.updateAdditionalFilter},null,8,["searchQuery","selectedCategory","categories","additional-filters","selected-filters","results-count","onUpdate:additionalFilter"]),p.loading?(f(),l("div",R,a[4]||(a[4]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Chargement des recettes...",-1)]))):p.error?(f(),l("div",w,[a[5]||(a[5]=r("div",{class:"error-icon"},[r("span",{class:"material-symbols-outlined"},"error"),r("span",{class:"emoji-fallback"},"‚ùå")],-1)),r("p",null,c(p.error),1),r("button",{onClick:a[2]||(a[2]=(...e)=>p.retry&&p.retry(...e)),class:"retry-btn"}," R√©essayer ")])):(f(),l("div",L,[p.filteredRecipes.length?(f(),l("div",j,[o(c(p.filteredRecipes.length)+" recette"+c(p.filteredRecipes.length>1?"s":"")+" ",1),p.searchQuery?(f(),l("span",A,' pour "'+c(p.searchQuery)+'"',1)):n("",!0)])):n("",!0),p.filteredRecipes.length||p.loading?(f(),l("div",E,[(f(!0),l(u,null,d(p.filteredRecipes,e=>{var s;return f(),l("article",{key:e.id,onClick:a=>p.goToRecipe(e.id),class:"recipe-card"},[r("div",B,[r("img",{src:e.featured_image_url||"/images/default-recipe.jpg",alt:e.title,loading:"lazy"},null,8,z),r("div",D,[r("div",U,[p.getTotalTime(e)?(f(),l("span",x,[a[7]||(a[7]=r("span",{class:"material-symbols-outlined"},"schedule",-1)),a[8]||(a[8]=r("span",{class:"emoji-fallback"},"‚è±Ô∏è",-1)),o(" "+c(p.getTotalTime(e))+"min ",1)])):n("",!0),e.difficulty?(f(),l("span",M,c(p.getDifficultyLabel(e.difficulty)),1)):n("",!0)])])]),r("div",I,[r("h3",N,c(e.title),1),e.short_description?(f(),l("p",O,c(e.short_description),1)):n("",!0),r("div",P,[r("div",W,[a[9]||(a[9]=r("span",{class:"material-symbols-outlined"},"favorite",-1)),a[10]||(a[10]=r("span",{class:"emoji-fallback"},"‚ù§Ô∏è",-1)),r("span",null,c(e.likes_count||0),1)]),e.servings?(f(),l("div",$,[a[11]||(a[11]=r("span",{class:"material-symbols-outlined"},"group",-1)),a[12]||(a[12]=r("span",{class:"emoji-fallback"},"üë•",-1)),r("span",null,c(e.servings),1)])):n("",!0),(null==(s=e.required_equipment)?void 0:s.length)?(f(),l("div",G,[a[13]||(a[13]=r("span",{class:"material-symbols-outlined"},"kitchen",-1)),a[14]||(a[14]=r("span",{class:"emoji-fallback"},"üç≥",-1)),r("span",null,c(e.required_equipment.length)+" √©quipement"+c(e.required_equipment.length>1?"s":""),1)])):n("",!0)])])],8,q)}),128))])):(f(),l("div",Q,[a[6]||(a[6]=r("div",{class:"empty-icon"},[r("span",{class:"material-symbols-outlined"},"restaurant"),r("span",{class:"emoji-fallback"},"üçΩÔ∏è")],-1)),r("h3",null,c(p.searchQuery||p.selectedCategory||p.hasActiveFilters?"Aucune recette trouv√©e":"Aucune recette disponible"),1),p.searchQuery||p.selectedCategory||p.hasActiveFilters?(f(),l("p",T," Essayez de modifier vos crit√®res de recherche. ")):(f(),l("p",S," Les recettes seront bient√¥t disponibles. ")),p.searchQuery||p.selectedCategory||p.hasActiveFilters?(f(),l("button",{key:2,onClick:a[3]||(a[3]=(...e)=>p.clearAllFilters&&p.clearAllFilters(...e)),class:"clear-filters-btn"}," Effacer tous les filtres ")):n("",!0)]))]))])}],["__scopeId","data-v-2fa39308"]]);export{H as default};
