import{d as e,e as t,v as a,k as s,f as i,j as r,t as o,F as n,i as c,E as l,G as m,r as d,b as u,m as p,h as v,o as h}from"./vendor.BeqKZlTx.js";import{u as g,a as y}from"./api.DeptcIQc.js";import{_ as f,S as b,a as k}from"./index.C1mfdDgG.js";import{B as C}from"./Badge.QpPmjZQE.js";import{A as w}from"./AuthModal.CAYITUsz.js";import{F as _}from"./FavoriteButton.D768M--O.js";import"./api.70uutYeQ.js";const x={class:"recipe-detail"},A={class:"md3-main-content"},E={key:0,class:"loading-container"},D={key:1,class:"recipe-content"},M={class:"recipe-hero"},S=["src","alt"],j={class:"recipe-overlay dinor-gradient-primary"},I={class:"recipe-badges"},L={class:"recipe-info"},R={class:"recipe-stats"},$={class:"stat-item"},F={class:"md3-body-medium"},B={class:"stat-item"},T={class:"md3-body-medium"},V={class:"stat-item"},q={class:"md3-body-medium"},z={class:"stat-item"},U={class:"md3-body-medium"},H={key:0,class:"recipe-summary-video"},P={class:"video-container"},G=["src","title"],O={key:1,class:"recipe-description"},N=["innerHTML"],J={key:2,class:"recipe-ingredients"},K={class:"ingredients-list"},Q={class:"md3-body-medium"},W={key:3,class:"recipe-instructions"},X=["innerHTML"],Y={class:"comments-section"},Z={class:"md3-title-medium dinor-text-primary"},ee={class:"add-comment-form"},te={key:0,class:"auth-prompt"},ae={key:1},se={class:"authenticated-user"},ie={class:"user-info"},re=["disabled"],oe={key:0,class:"comments-list"},ne={class:"comment-header"},ce={class:"comment-meta"},le={class:"comment-author md3-body-medium"},me={class:"comment-date md3-body-small dinor-text-gray"},de={key:0,class:"comment-actions"},ue=["onClick"],pe={class:"comment-content md3-body-medium"},ve={key:1,class:"empty-comments"},he={key:2,class:"error-state"};const ge=f({name:"RecipeDetail",emits:["update-header"],components:{Badge:C,ShareModal:b,AuthModal:w,FavoriteButton:_},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=v(),s=g(),i=y(),{showShareModal:r,updateOpenGraphTags:o}=k(),n=d(null),c=d([]),l=d(!0),m=d(!1),h=d(!1),f=d(""),b=d(!1),C=u(()=>n.value?{title:n.value.title,text:n.value.description||`Découvrez cette délicieuse recette : ${n.value.title}`,url:window.location.href,image:n.value.image,type:"recipe",id:n.value.id}:{}),w=async()=>{try{console.log("🔄 [Comments] Chargement des commentaires pour recipe ID:",e.id);const t=await s.get("/comments",{commentable_type:"App\\Models\\Recipe",commentable_id:e.id});console.log("📥 [Comments] Réponse reçue:",t),t.success&&(c.value=t.data,console.log("✅ [Comments] Commentaires chargés:",c.value.length,"commentaires"))}catch(t){console.error("❌ [Comments] Erreur lors du chargement des commentaires:",t)}},_=async()=>{try{console.log("🔄 [Comments] Rechargement FRAIS des commentaires pour recipe ID:",e.id);const t=await s.getFresh("/comments",{commentable_type:"App\\Models\\Recipe",commentable_id:e.id});console.log("📥 [Comments] Réponse fraîche reçue:",t),t.success&&(c.value=t.data,console.log("✅ [Comments] Commentaires frais chargés:",c.value.length,"commentaires"))}catch(t){console.error("❌ [Comments] Erreur lors du rechargement frais des commentaires:",t)}},x=async()=>{try{const t=await s.get("/likes/check",{type:"recipe",id:e.id});m.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la vérification du like:",t)}},A=async()=>{try{const t=await s.get("/favorites/check",{type:"recipe",id:e.id});h.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la vérification du favori:",t)}},E=async()=>{if(f.value.trim())if(i.isAuthenticated)try{const t={commentable_type:"App\\Models\\Recipe",commentable_id:parseInt(e.id),content:f.value};console.log("📝 [Comments] Envoi du commentaire:",t);(await s.post("/comments",t)).success&&(console.log("✅ [Comments] Commentaire ajouté avec succès"),await _(),f.value="")}catch(t){console.error("❌ [Comments] Erreur lors de l'ajout du commentaire:",t),t.message.includes("401")&&(b.value=!0)}else b.value=!0};return p(()=>{(async()=>{try{const a=await s.get(`/recipes/${e.id}`);a.success&&(n.value=a.data,await w(),await x(),await A(),o(C.value),t("update-header",{title:n.value.title||"Recette",showShare:!0,showLike:!0,isLiked:m.value,backPath:"/recipes"}))}catch(a){console.error("Erreur lors du chargement de la recette:",a)}finally{l.value=!1}})()}),{recipe:n,comments:c,loading:l,userLiked:m,userFavorited:h,newComment:f,authStore:i,showAuthModal:b,toggleLike:async()=>{try{const a=await s.request("/likes/toggle",{method:"POST",body:{likeable_type:"recipe",likeable_id:e.id}});a.success&&(m.value=!m.value,n.value&&(n.value.likes_count=a.data.total_likes),t("update-header",{isLiked:m.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await s.post("/favorites/toggle",{favoritable_type:"recipe",favoritable_id:e.id});a.success&&(h.value=!h.value,n.value&&(n.value.favorites_count=a.data.total_favorites),t("update-header",{isFavorited:h.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:E,canDeleteComment:e=>{var t;return!!i.isAuthenticated&&!(!e.user_id||e.user_id!==(null==(t=i.user)?void 0:t.id))},deleteComment:async e=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce commentaire ?"))try{console.log("🗑️ [Comments] Suppression du commentaire ID:",e);(await s.request(`/comments/${e}`,{method:"DELETE"})).success&&(console.log("✅ [Comments] Commentaire supprimé avec succès"),await _())}catch(t){console.error("❌ [Comments] Erreur lors de la suppression du commentaire:",t),alert("Erreur lors de la suppression du commentaire")}},handleAuthenticated:()=>{b.value=!1,f.value.trim()&&E()},goBack:()=>{a.push("/recipes")},getDifficultyLabel:e=>({beginner:"Débutant",intermediate:"Intermédiaire",advanced:"Avancé"}[e]||"Débutant"),formatDate:e=>new Date(e).toLocaleDateString("fr-FR"),handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatInstructions:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="instruction-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="instruction-step">\n              <h4>Étape ${t+1}</h4>\n              <p>${e}</p>\n            </div>`:`<div class="instruction-step"><p>${e}</p></div>`).join(""):e.toString():"",getEmbedUrl:e=>{if(!e)return"";const t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);if(t)return`https://www.youtube.com/embed/${t[1]}?rel=0&modestbranding=1`;const a=e.match(/vimeo\.com\/(\d+)/);return a?`https://player.vimeo.com/video/${a[1]}`:e},showShareModal:r,shareData:C}}},[["render",function(d,u,p,v,g,y){const f=r("Badge"),b=r("ShareModal"),k=r("AuthModal");return h(),e("div",x,[t("main",A,[v.loading?(h(),e("div",E,u[8]||(u[8]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de la recette...",-1)]))):v.recipe?(h(),e("div",D,[t("div",M,[t("img",{src:v.recipe.image||"/images/default-recipe.jpg",alt:v.recipe.title,class:"recipe-hero-image",onError:u[0]||(u[0]=(...e)=>v.handleImageError&&v.handleImageError(...e))},null,40,S),t("div",j,[t("div",I,[v.recipe.difficulty_level?(h(),s(f,{key:0,text:v.getDifficultyLabel(v.recipe.difficulty_level),icon:"restaurant",variant:"secondary",size:"medium"},null,8,["text"])):i("",!0),v.recipe.category?(h(),s(f,{key:1,text:v.recipe.category.name,icon:"tag",variant:"neutral",size:"medium"},null,8,["text"])):i("",!0)])])]),t("div",L,[t("div",R,[t("div",$,[u[9]||(u[9]=t("i",{class:"material-icons dinor-text-secondary"},"schedule",-1)),t("span",F,o(v.recipe.cooking_time)+"min",1)]),t("div",B,[u[10]||(u[10]=t("i",{class:"material-icons dinor-text-secondary"},"people",-1)),t("span",T,o(v.recipe.servings)+" pers.",1)]),t("div",V,[u[11]||(u[11]=t("i",{class:"material-icons dinor-text-secondary"},"favorite",-1)),t("span",q,o(v.recipe.likes_count||0),1)]),t("div",z,[u[12]||(u[12]=t("i",{class:"material-icons dinor-text-secondary"},"comment",-1)),t("span",U,o(v.recipe.comments_count||0),1)])]),v.recipe.summary_video_url?(h(),e("div",H,[u[13]||(u[13]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Résumé en vidéo",-1)),t("div",P,[t("iframe",{src:v.getEmbedUrl(v.recipe.summary_video_url),title:`Résumé vidéo : ${v.recipe.title}`,frameborder:"0",allowfullscreen:"",class:"summary-video-iframe"},null,8,G)])])):i("",!0),v.recipe.description?(h(),e("div",O,[u[14]||(u[14]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),t("p",{class:"md3-body-large dinor-text-gray",innerHTML:v.recipe.description},null,8,N)])):i("",!0),v.recipe.ingredients&&v.recipe.ingredients.length?(h(),e("div",J,[u[15]||(u[15]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Ingrédients",-1)),t("ul",K,[(h(!0),e(n,null,c(v.recipe.ingredients,a=>(h(),e("li",{key:a.id,class:"ingredient-item"},[t("span",Q,o(a.quantity)+" "+o(a.unit)+" "+o(a.name),1)]))),128))])])):i("",!0),v.recipe.instructions?(h(),e("div",W,[u[16]||(u[16]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Instructions",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:v.formatInstructions(v.recipe.instructions)},null,8,X)])):i("",!0),t("div",Y,[t("h2",Z,"Commentaires ("+o(v.comments.length)+")",1),t("div",ee,[v.authStore.isAuthenticated?(h(),e("div",ae,[t("div",se,[t("span",ie,"Connecté en tant que "+o(v.authStore.userName),1),t("button",{onClick:u[2]||(u[2]=e=>v.authStore.logout()),class:"btn-logout"},"Déconnexion")]),l(t("textarea",{"onUpdate:modelValue":u[3]||(u[3]=e=>v.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[m,v.newComment]]),t("button",{onClick:u[4]||(u[4]=(...e)=>v.addComment&&v.addComment(...e)),class:"btn-primary",disabled:!v.newComment.trim()}," Publier ",8,re)])):(h(),e("div",te,[u[17]||(u[17]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:u[1]||(u[1]=e=>v.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),v.comments.length?(h(),e("div",oe,[(h(!0),e(n,null,c(v.comments,a=>(h(),e("div",{key:a.id,class:"comment-item"},[t("div",ne,[t("div",ce,[t("span",le,o(a.author_name),1),t("span",me,o(v.formatDate(a.created_at)),1)]),v.canDeleteComment(a)?(h(),e("div",de,[t("button",{onClick:e=>v.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},u[18]||(u[18]=[t("i",{class:"material-icons"},"delete",-1)]),8,ue)])):i("",!0)]),t("p",pe,o(a.content),1)]))),128))])):(h(),e("div",ve,u[19]||(u[19]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(h(),e("div",he,[u[20]||(u[20]=t("div",{class:"error-icon"},[t("i",{class:"material-icons"},"error_outline")],-1)),u[21]||(u[21]=t("h2",{class:"md3-title-large"},"Recette introuvable",-1)),u[22]||(u[22]=t("p",{class:"md3-body-large dinor-text-gray"},"La recette demandée n'existe pas ou a été supprimée.",-1)),t("button",{onClick:u[5]||(u[5]=(...e)=>v.goBack&&v.goBack(...e)),class:"btn-primary"},"Retour")]))]),a(b,{modelValue:v.showShareModal,"onUpdate:modelValue":u[6]||(u[6]=e=>v.showShareModal=e),"share-data":v.shareData},null,8,["modelValue","share-data"]),a(k,{modelValue:v.showAuthModal,"onUpdate:modelValue":u[7]||(u[7]=e=>v.showAuthModal=e),onAuthenticated:v.handleAuthenticated},null,8,["modelValue","onAuthenticated"])])}],["__scopeId","data-v-3618b47e"]]);export{ge as default};
