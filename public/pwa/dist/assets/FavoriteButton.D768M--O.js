import{r as e,b as t,s as a,m as i,d as o,f as r,y as s,e as n,t as l,n as u,o as d}from"./vendor.BeqKZlTx.js";import{a as v}from"./api.DeptcIQc.js";import{a as c}from"./api.70uutYeQ.js";import{_ as f}from"./index.C1mfdDgG.js";const m={name:"FavoriteButton",props:{type:{type:String,required:!0,validator:e=>["recipe","tip","event","dinor_tv"].includes(e)},itemId:{type:[Number,String],required:!0},initialFavorited:{type:Boolean,default:!1},initialCount:{type:Number,default:0},showCount:{type:Boolean,default:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)},variant:{type:String,default:"default",validator:e=>["default","compact","minimal"].includes(e)}},emits:["update:favorited","update:count","auth-required"],setup(o,{emit:r}){const s=v(),n=e(!1),l=e(o.initialFavorited),u=e(o.initialCount),d=t(()=>s.isAuthenticated),f=async()=>{if(s.isAuthenticated)try{const e=await c.checkFavorite(o.type,o.itemId);e.success&&(l.value=e.is_favorited)}catch(e){console.warn("Erreur lors de la vérification du statut favori:",e)}else l.value=!1};return a(()=>s.isAuthenticated,e=>{e?f():l.value=!1}),a(()=>o.initialFavorited,e=>{l.value=e}),a(()=>o.initialCount,e=>{u.value=e}),i(()=>{s.isAuthenticated&&f()}),{loading:n,isFavorited:l,favoritesCount:u,canInteract:d,formatCount:e=>e<1e3?e.toString():e<1e6?`${Math.floor(e/1e3)}k`:`${Math.floor(e/1e6)}M`,handleToggle:async()=>{if(console.log("🌟 [FavoriteButton] Clic détecté sur bouton favori",{type:o.type,itemId:o.itemId,isAuthenticated:s.isAuthenticated}),!s.isAuthenticated)return console.log("🔒 [FavoriteButton] Utilisateur non connecté"),void r("auth-required");if(n.value)return void console.log("⏳ [FavoriteButton] Déjà en cours de chargement");n.value=!0;const e=l.value,t=u.value;l.value=!l.value,u.value+=l.value?1:-1;try{const e=await c.toggleFavorite(o.type,o.itemId);if(!e.success)throw new Error(e.message||"Erreur lors de la mise à jour des favoris");l.value=e.is_favorited,e.data&&"number"==typeof e.data.total_favorites&&(u.value=e.data.total_favorites),r("update:favorited",l.value),r("update:count",u.value),console.log("🌟 [Favorites] Toggle réussi:",{type:o.type,id:o.itemId,favorited:l.value,count:u.value})}catch(a){console.error("❌ [Favorites] Erreur toggle:",a),l.value=e,u.value=t,a.message.includes("401")&&r("auth-required")}finally{n.value=!1}}}}},p=["disabled","title"],g={key:0,class:"loading-spinner"},h={class:"material-symbols-outlined heart-icon"},y={class:"emoji-fallback"},F={key:2,class:"favorite-count"};const b=f(m,[["render",function(e,t,a,i,v,c){return d(),o("button",{onClick:t[1]||(t[1]=(...e)=>i.handleToggle&&i.handleToggle(...e)),class:u(["favorite-button",{"is-favorited":i.isFavorited,"is-loading":i.loading,"is-disabled":!i.canInteract}]),disabled:i.loading||!i.canInteract,title:i.isFavorited?"Retirer des favoris":"Ajouter aux favoris"},[i.loading?(d(),o("div",g)):(d(),o("div",{key:1,class:"heart-container",onClick:t[0]||(t[0]=s((...e)=>i.handleToggle&&i.handleToggle(...e),["stop"]))},[n("span",h,l(i.isFavorited?"favorite":"favorite_border"),1),n("span",y,l(i.isFavorited?"❤️":"🤍"),1)])),a.showCount&&i.favoritesCount>0?(d(),o("span",F,l(i.formatCount(i.favoritesCount)),1)):r("",!0)],10,p)}],["__scopeId","data-v-9640679c"]]);export{b as F};
